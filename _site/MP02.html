<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Shubh Goyal">
<meta name="dcterms.date" content="2025-03-26">

<title>ğŸ† The GTA IV Green Transit Awards 2025 ğŸ† â€“ STA 9750 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-ddd961a2510921635943dfbbd19534c4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 Submission Material</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Mp01.qmd"> 
<span class="menu-text">Payroll</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./MP02.html" aria-current="page"> 
<span class="menu-text">Transit Awards</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-2025-clean-transit-awards" id="toc-the-2025-clean-transit-awards" class="nav-link active" data-scroll-target="#the-2025-clean-transit-awards"><span class="header-section-number">1</span> ğŸš The 2025 Clean Transit Awards</a>
  <ul class="collapse">
  <li><a href="#greenest-transit-agency-the-mvp-most-valuable-pollution-reducer-award" id="toc-greenest-transit-agency-the-mvp-most-valuable-pollution-reducer-award" class="nav-link" data-scroll-target="#greenest-transit-agency-the-mvp-most-valuable-pollution-reducer-award"><span class="header-section-number">1.1</span> ğŸ† Greenest Transit Agency â€“ The MVP (Most Valuable Pollution-Reducer) Award ğŸŒğŸ’¨</a></li>
  <li><a href="#most-emissions-avoided-the-carbon-buster-award" id="toc-most-emissions-avoided-the-carbon-buster-award" class="nav-link" data-scroll-target="#most-emissions-avoided-the-carbon-buster-award"><span class="header-section-number">1.2</span> ğŸŒ Most Emissions Avoided â€“ The â€œCarbon Busterâ€ Award ğŸš«ğŸ’¨</a></li>
  <li><a href="#most-improved-green-agency-the-comeback-kid-award" id="toc-most-improved-green-agency-the-comeback-kid-award" class="nav-link" data-scroll-target="#most-improved-green-agency-the-comeback-kid-award"><span class="header-section-number">1.3</span> Most Improved Green Agency â€“ The â€œComeback Kidâ€ Award ğŸ”„ğŸ’š</a></li>
  <li><a href="#biggest-gas-guzzler-the-oh-no-fix-that-award" id="toc-biggest-gas-guzzler-the-oh-no-fix-that-award" class="nav-link" data-scroll-target="#biggest-gas-guzzler-the-oh-no-fix-that-award"><span class="header-section-number">1.4</span> â›½ Biggest Gas Guzzler â€“ The â€œOh No, Fix That!â€ AwardğŸ’€</a></li>
  </ul></li>
  <li><a href="#appendix---methodology-and-analysis" id="toc-appendix---methodology-and-analysis" class="nav-link" data-scroll-target="#appendix---methodology-and-analysis"><span class="header-section-number">2</span> APPENDIX - METHODOLOGY AND ANALYSIS</a>
  <ul class="collapse">
  <li><a href="#data-import" id="toc-data-import" class="nav-link" data-scroll-target="#data-import"><span class="header-section-number">2.1</span> ğŸ“Š Data Import</a></li>
  <li><a href="#initial-analysis-of-sep-data" id="toc-initial-analysis-of-sep-data" class="nav-link" data-scroll-target="#initial-analysis-of-sep-data"><span class="header-section-number">2.2</span> ğŸ” Initial Analysis of SEP Data âš–ï¸</a>
  <ul class="collapse">
  <li><a href="#which-state-has-the-most-expensive-retail-electricity" id="toc-which-state-has-the-most-expensive-retail-electricity" class="nav-link" data-scroll-target="#which-state-has-the-most-expensive-retail-electricity"><span class="header-section-number">2.2.1</span> 1. Which state has the most expensive retail electricity? ğŸ’°âš¡</a></li>
  <li><a href="#which-state-has-the-dirtiest-electricity-mix" id="toc-which-state-has-the-dirtiest-electricity-mix" class="nav-link" data-scroll-target="#which-state-has-the-dirtiest-electricity-mix"><span class="header-section-number">2.2.2</span> 2. Which state has the â€˜dirtiestâ€™ electricity mix? â˜ ï¸ğŸŒ«ï¸</a></li>
  <li><a href="#on-average-how-many-pounds-of-co2-are-emitted-per-mwh-of-electricity-produced-in-the-us" id="toc-on-average-how-many-pounds-of-co2-are-emitted-per-mwh-of-electricity-produced-in-the-us" class="nav-link" data-scroll-target="#on-average-how-many-pounds-of-co2-are-emitted-per-mwh-of-electricity-produced-in-the-us"><span class="header-section-number">2.2.3</span> 3. On average, how many pounds of CO2 are emitted per MWh of electricity produced in the US?ğŸ­</a></li>
  <li><a href="#what-is-the-rarest-primary-energy-source-in-the-us-what-is-the-associated-cost-of-electricity-and-where-is-it-used" id="toc-what-is-the-rarest-primary-energy-source-in-the-us-what-is-the-associated-cost-of-electricity-and-where-is-it-used" class="nav-link" data-scroll-target="#what-is-the-rarest-primary-energy-source-in-the-us-what-is-the-associated-cost-of-electricity-and-where-is-it-used"><span class="header-section-number">2.2.4</span> 4. ğŸ¦„ What is the rarest primary energy source in the US? What is the associated cost of electricity and where is it used?ğŸ§</a></li>
  <li><a href="#my-home-state-texas-has-a-reputation-as-being-the-home-of-dirty-fossil-fuels-while-ny-has-a-reputation-as-a-leader-in-clean-energy.-how-many-times-cleaner-is-nys-energy-mix-than-that-of-texas" id="toc-my-home-state-texas-has-a-reputation-as-being-the-home-of-dirty-fossil-fuels-while-ny-has-a-reputation-as-a-leader-in-clean-energy.-how-many-times-cleaner-is-nys-energy-mix-than-that-of-texas" class="nav-link" data-scroll-target="#my-home-state-texas-has-a-reputation-as-being-the-home-of-dirty-fossil-fuels-while-ny-has-a-reputation-as-a-leader-in-clean-energy.-how-many-times-cleaner-is-nys-energy-mix-than-that-of-texas"><span class="header-section-number">2.2.5</span> 5. My home state, Texas, has a reputation as being the home of â€œdirty fossil fuelsâ€ while NY has a reputation as a leader in clean energy. How many times cleaner is NYâ€™s energy mix than that of Texas?ğŸŒ±ğŸ”¥</a></li>
  </ul></li>
  <li><a href="#importing-2023-annual-database-energy-consumption-report" id="toc-importing-2023-annual-database-energy-consumption-report" class="nav-link" data-scroll-target="#importing-2023-annual-database-energy-consumption-report"><span class="header-section-number">2.3</span> Importing 2023 Annual Database Energy Consumption Report âš¡ğŸ“Š</a>
  <ul class="collapse">
  <li><a href="#the-wheel-of-randomness" id="toc-the-wheel-of-randomness" class="nav-link" data-scroll-target="#the-wheel-of-randomness"><span class="header-section-number">2.3.1</span> <strong>ğŸ² The Wheel of Randomness! ğŸ°</strong></a></li>
  </ul></li>
  <li><a href="#recoding-transit-modes" id="toc-recoding-transit-modes" class="nav-link" data-scroll-target="#recoding-transit-modes"><span class="header-section-number">2.4</span> ğŸš‡ Recoding Transit Modes ğŸš‹ğŸ­</a>
  <ul class="collapse">
  <li><a href="#time-for-a-makeover" id="toc-time-for-a-makeover" class="nav-link" data-scroll-target="#time-for-a-makeover"><span class="header-section-number">2.4.1</span> ğŸ—ï¸ Time for a Makeover! ğŸ–Œï¸</a></li>
  </ul></li>
  <li><a href="#annual-database-service-by-agency" id="toc-annual-database-service-by-agency" class="nav-link" data-scroll-target="#annual-database-service-by-agency"><span class="header-section-number">2.5</span> 2023 Annual Database Service by Agency ğŸ“ŠğŸš‡</a></li>
  <li><a href="#clean-up-time" id="toc-clean-up-time" class="nav-link" data-scroll-target="#clean-up-time"><span class="header-section-number">2.6</span> Clean-Up Time! ğŸ§¹âœ¨</a></li>
  <li><a href="#exploring-ntd-service-data---lets-dive-in" id="toc-exploring-ntd-service-data---lets-dive-in" class="nav-link" data-scroll-target="#exploring-ntd-service-data---lets-dive-in"><span class="header-section-number">2.7</span> ğŸ›¥ï¸ Exploring NTD Service Data - Letâ€™s Dive In!</a>
  <ul class="collapse">
  <li><a href="#which-transit-service-has-the-most-upt-annually" id="toc-which-transit-service-has-the-most-upt-annually" class="nav-link" data-scroll-target="#which-transit-service-has-the-most-upt-annually"><span class="header-section-number">2.7.1</span> 1. Which transit service has the most UPT annually? ğŸ†</a></li>
  <li><a href="#what-is-the-average-trip-length-of-a-trip-on-mta-nyc" id="toc-what-is-the-average-trip-length-of-a-trip-on-mta-nyc" class="nav-link" data-scroll-target="#what-is-the-average-trip-length-of-a-trip-on-mta-nyc"><span class="header-section-number">2.7.2</span> 2. What is the average trip length of a trip on MTA NYC? ğŸ—½</a></li>
  <li><a href="#which-transit-service-in-nyc-has-the-longest-average-trip-length" id="toc-which-transit-service-in-nyc-has-the-longest-average-trip-length" class="nav-link" data-scroll-target="#which-transit-service-in-nyc-has-the-longest-average-trip-length"><span class="header-section-number">2.7.3</span> 3. Which transit service in NYC has the longest average trip length? ğŸš‹</a></li>
  <li><a href="#which-state-has-the-fewest-total-miles-travelled-by-public-transit" id="toc-which-state-has-the-fewest-total-miles-travelled-by-public-transit" class="nav-link" data-scroll-target="#which-state-has-the-fewest-total-miles-travelled-by-public-transit"><span class="header-section-number">2.7.4</span> 4. Which state has the fewest total miles travelled by public transit? ğŸ¢</a></li>
  <li><a href="#are-all-states-represented-in-this-data-if-no-which-ones-are-missing-the-state.name-and-state.abb-objects-we-used-above-may-be-useful-here." id="toc-are-all-states-represented-in-this-data-if-no-which-ones-are-missing-the-state.name-and-state.abb-objects-we-used-above-may-be-useful-here." class="nav-link" data-scroll-target="#are-all-states-represented-in-this-data-if-no-which-ones-are-missing-the-state.name-and-state.abb-objects-we-used-above-may-be-useful-here."><span class="header-section-number">2.7.5</span> 5. Are all states represented in this data? If no, which ones are missing? The state.name and state.abb objects we used above may be useful here.ğŸšğŸ—ºï¸</a></li>
  </ul></li>
  <li><a href="#calculate-emissions-lets-crunch-some-carbon" id="toc-calculate-emissions-lets-crunch-some-carbon" class="nav-link" data-scroll-target="#calculate-emissions-lets-crunch-some-carbon"><span class="header-section-number">2.8</span> ğŸŒ Calculate Emissions â€“ Letâ€™s Crunch Some Carbon! ğŸ’¨</a>
  <ul class="collapse">
  <li><a href="#join-the-three-tables-the-ultimate-data-party" id="toc-join-the-three-tables-the-ultimate-data-party" class="nav-link" data-scroll-target="#join-the-three-tables-the-ultimate-data-party"><span class="header-section-number">2.8.1</span> Join the Three Tables â€“ The Ultimate Data Party ğŸ‰</a></li>
  <li><a href="#the-ultimate-emissions-table" id="toc-the-ultimate-emissions-table" class="nav-link" data-scroll-target="#the-ultimate-emissions-table"><span class="header-section-number">2.8.2</span> The Ultimate Emissions Table ğŸ§®</a></li>
  <li><a href="#the-formula-its-math-but-make-it-eco" id="toc-the-formula-its-math-but-make-it-eco" class="nav-link" data-scroll-target="#the-formula-its-math-but-make-it-eco"><span class="header-section-number">2.8.3</span> The Formula â€“ Itâ€™s Math, But Make It Eco! ğŸ§‘â€ğŸ«</a></li>
  </ul></li>
  <li><a href="#normalize-emissions-to-transit-usage" id="toc-normalize-emissions-to-transit-usage" class="nav-link" data-scroll-target="#normalize-emissions-to-transit-usage"><span class="header-section-number">2.9</span> Normalize Emissions to Transit Usage ğŸš†</a>
  <ul class="collapse">
  <li><a href="#normalize-emissions-leveling-the-playing-field" id="toc-normalize-emissions-leveling-the-playing-field" class="nav-link" data-scroll-target="#normalize-emissions-leveling-the-playing-field"><span class="header-section-number">2.9.1</span> Normalize Emissions â€“ Leveling the Playing Field! ğŸ¯</a></li>
  </ul></li>
  <li><a href="#the-greenest-transit-agency-gta-iv-award-1" id="toc-the-greenest-transit-agency-gta-iv-award-1" class="nav-link" data-scroll-target="#the-greenest-transit-agency-gta-iv-award-1"><span class="header-section-number">2.10</span> <strong>ğŸ¥‡ The Greenest Transit Agency (GTA IV Award #1) ğŸŒ±ğŸš†</strong></a>
  <ul class="collapse">
  <li><a href="#find-the-greenest-transit-agency-by-lowest-emissions-per-upt" id="toc-find-the-greenest-transit-agency-by-lowest-emissions-per-upt" class="nav-link" data-scroll-target="#find-the-greenest-transit-agency-by-lowest-emissions-per-upt"><span class="header-section-number">2.10.1</span> Find the greenest transit agency by lowest emissions per UPT</a></li>
  <li><a href="#find-the-greenest-transit-agency-by-lowest-emissions-per-passenger-mile" id="toc-find-the-greenest-transit-agency-by-lowest-emissions-per-passenger-mile" class="nav-link" data-scroll-target="#find-the-greenest-transit-agency-by-lowest-emissions-per-passenger-mile"><span class="header-section-number">2.10.2</span> Find the greenest transit agency by lowest emissions per Passenger Mile</a></li>
  </ul></li>
  <li><a href="#total-emissions-avoided-gta-iv-award-2" id="toc-total-emissions-avoided-gta-iv-award-2" class="nav-link" data-scroll-target="#total-emissions-avoided-gta-iv-award-2"><span class="header-section-number">2.11</span> <strong>Total Emissions Avoided (GTA IV Award #2) ğŸŒ±ğŸš†</strong></a>
  <ul class="collapse">
  <li><a href="#find-agency-with-most-emissions-avoided" id="toc-find-agency-with-most-emissions-avoided" class="nav-link" data-scroll-target="#find-agency-with-most-emissions-avoided"><span class="header-section-number">2.11.1</span> Find agency with most emissions avoided ğŸ†</a></li>
  <li><a href="#most-improved-green-agency-gta-iv-award-3" id="toc-most-improved-green-agency-gta-iv-award-3" class="nav-link" data-scroll-target="#most-improved-green-agency-gta-iv-award-3"><span class="header-section-number">2.11.2</span> ğŸ†Most Improved Green Agency <strong>(GTA IV Award #3) ğŸš†</strong> ğŸ†</a></li>
  <li><a href="#biggest-gas-guzzler-gta-iv-award-4" id="toc-biggest-gas-guzzler-gta-iv-award-4" class="nav-link" data-scroll-target="#biggest-gas-guzzler-gta-iv-award-4"><span class="header-section-number">2.11.3</span> ğŸ’€Biggest Gas Guzzlerâ›½ <strong>(GTA IV Award #4) ğŸŒ±ğŸš†</strong></a></li>
  </ul></li>
  <li><a href="#visualizations" id="toc-visualizations" class="nav-link" data-scroll-target="#visualizations"><span class="header-section-number">2.12</span> ğŸ“ˆ Visualizations ğŸ¨</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">2.13</span> ğŸ“¢ Conclusion</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">2.14</span> ğŸ“š References</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">ğŸ† The GTA IV Green Transit Awards 2025 ğŸ†</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Shubh Goyal </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 26, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="the-2025-clean-transit-awards" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> ğŸš The 2025 Clean Transit Awards</h1>
<p><strong>Honoring the Green, the Lean, and the Gas-Guzzling Machines! ğŸŒ±ğŸ”¥</strong></p>
<p>New York, NY â€“ Public transit plays a crucial role in reducing carbon footprints, but not all agencies are created equal. Some transit systems have become champions of eco-efficiency, while othersâ€¦ well, letâ€™s just say they have room for improvement.</p>
<p>After analyzing emissions data from transit agencies nationwide, we proudly present the 2025 Clean Transit Awards, recognizing the best (and worst) in sustainable transit. These awards highlight Small, Medium, and Large agencies that have made a measurable impact on their carbon footprintâ€”or left tire marks on the environment.</p>
<p>So, without further ado, letâ€™s reveal the greenest, the most improved, and, of course, the biggest gas guzzlers!</p>
<section id="greenest-transit-agency-the-mvp-most-valuable-pollution-reducer-award" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="greenest-transit-agency-the-mvp-most-valuable-pollution-reducer-award"><span class="header-section-number">1.1</span> ğŸ† Greenest Transit Agency â€“ The MVP (Most Valuable Pollution-Reducer) Award ğŸŒğŸ’¨</h2>
<p>This prestigious award goes to the transit agencies that produce the least emissions per passenger trip and per mile traveled. In other words, these winners are basically the Tesla Model S of busesâ€”except way more affordable and accessible.</p>
<p><strong>By Passenger Trips:</strong></p>
<p>ğŸ¥‡<strong>Large Agency Winner:</strong> New Jersey Transit Corporation</p>
<p>ğŸ¥‡<strong>Medium Agency Winner:</strong> King County, dba: King County Metro</p>
<p>ğŸ¥‡<strong>Small Agency Winner</strong>: Small Altoona Metro Transit, dba: AMTRAN</p>
<p><strong>By Passenger Mile:</strong></p>
<p>ğŸ¥‡<strong>Large Agency Winner</strong>:ğŸš†New Jersey Transit Corporation,</p>
<p>ğŸ¥‡<strong>Medium Agency Winner:</strong> King County, dba: King County Metro<strong>,</strong></p>
<p>ğŸ¥‡<strong>Small Agency Winner:</strong> Small Altoona Metro Transit, dba: AMTRA<strong>,</strong></p>
</section>
<section id="most-emissions-avoided-the-carbon-buster-award" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="most-emissions-avoided-the-carbon-buster-award"><span class="header-section-number">1.2</span> ğŸŒ Most Emissions Avoided â€“ The â€œCarbon Busterâ€ Award ğŸš«ğŸ’¨</h2>
<p>â€œIf pollution had an arch-nemesis, it would be these guys.â€</p>
<p>Imagine a world where all transit riders suddenly switched to single-passenger cars. ğŸš—ğŸš—ğŸš— Yikes! The traffic jams would be longer than your uncleâ€™s conspiracy theories at Thanksgiving, and emissions would skyrocket.</p>
<p>This award goes to the transit agencies that saved us from the most pollution by preventing countless solo car trips.</p>
<p>ğŸ¥‡ <strong>Large Agency Winner</strong>: MTA New York City Transit 3441010874 avoided</p>
<p>ğŸ¥‡ <strong>Medium Agency Winner</strong>: Metro-North Commuter Railroad Company, dba: MTA Metro-North Railroad 413801729 avoided</p>
<p>ğŸ¥‡ <strong>Small Agency Winner</strong>: Hampton Jitney, Inc.&nbsp;1333301 avoided</p>
</section>
<section id="most-improved-green-agency-the-comeback-kid-award" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="most-improved-green-agency-the-comeback-kid-award"><span class="header-section-number">1.3</span> Most Improved Green Agency â€“ The â€œComeback Kidâ€ Award ğŸ”„ğŸ’š</h2>
<p>â€œFrom gas-guzzler to eco-hustler!â€</p>
<p>This award goes to the agency that has made the biggest leap toward sustainabilityâ€”not by comparing to past-year data, but by seeing who improved the most compared to their peers.</p>
<p>ğŸ¥‡ <strong>Large Agency Winner</strong>: New Jersey Transit Corporation Reduced from 0.1260740 to 0.0002060647 per mile</p>
<p>ğŸ¥‡ <strong>Medium Agency Winner</strong>: King County, dba: King County Metro Reduced from 0.2200267 to 0.0001889437 per mile</p>
<p>ğŸ¥‡ <strong>Small Agency Winner</strong>: Altoona Metro Transit, dba: AMTRAN â€“ Reduced from 0.3648839 to 0.0015635784 per mile</p>
</section>
<section id="biggest-gas-guzzler-the-oh-no-fix-that-award" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="biggest-gas-guzzler-the-oh-no-fix-that-award"><span class="header-section-number">1.4</span> â›½ Biggest Gas Guzzler â€“ The â€œOh No, Fix That!â€ AwardğŸ’€</h2>
<p>â€œNot all heroes wear capesâ€¦ and not all transit agencies are heroes.â€Not every agency can be a green machine. This award â€œhonorsâ€ those transit agencies that burn through fuel like itâ€™s going out of style, producing the highest emissions per passenger mile. (Spoiler alert: This is NOT the award you want to win.)</p>
<p>ğŸ¥‡ <strong>Large Agency Winner</strong>: Chicago Transit Authority 162.6084 kg COâ‚‚ per mile</p>
<p>ğŸ¥‡ <strong>Medium Agency Winner</strong>: West Virginia University, dba: Personal Rapid Transit 645.1318 kg COâ‚‚ per mile</p>
<p>ğŸ¥‡ <strong>Small Agency Winner</strong>: Pennsylvania Department of Transportation 273.8586 COâ‚‚ per mile</p>
<p>While some agencies are already champions of green transit, others have some serious catching up to do. The 2025 Clean Transit Awards highlight the best in eco-friendly transportation while also shining a spotlight on areas that need improvement. ğŸš† The takeaway? Cities that invest in sustainable transit are making a real impact on emissions. Meanwhile, gas guzzlers (weâ€™re looking at you, WVU!) still have some work to do. For a full breakdown of the data, check out the Appendix in our official report. Spoiler alert: numbers donâ€™t lie, and neither do emissions reductions!</p>
</section>
</section>
<section id="appendix---methodology-and-analysis" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> APPENDIX - METHODOLOGY AND ANALYSIS</h1>
<section id="data-import" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="data-import"><span class="header-section-number">2.1</span> ğŸ“Š Data Import</h2>
<p>We started by acquiring data from EIA State Electricity Profiles, which we will use to estimate the environmental impact of the electricity used to run certain transit systems. ğŸš—</p>
<section id="state-electricity-profiles" class="level4" data-number="2.1.0.1">
<h4 data-number="2.1.0.1" class="anchored" data-anchor-id="state-electricity-profiles"><span class="header-section-number">2.1.0.1</span> State Electricity Profiles ğŸ›ï¸</h4>
<p>For purposes of this analysis, we will assume that all electricity generation in a state is fungible. That is, we will assign the average generation emissions to all-electric transit in a state, even if the transit authority officially has a â€œgreen supplyâ€ agreement in place.</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr) <span class="co"># Needed for str_replace_all()</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr) <span class="co"># Needed for map2()</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quarto) <span class="co"># Ensures Quarto execution works</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load libraries</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>ensure_package <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg){</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    pkg <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(pkg))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>)) <span class="fu">install.packages</span>(pkg)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(stringr)  <span class="co"># Ensure it's installed</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(dplyr)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(httr2)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(rvest)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(datasets)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(purrr)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(DT)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>get_eia_sep <span class="ot">&lt;-</span> <span class="cf">function</span>(state, abbr){</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    state_formatted <span class="ot">&lt;-</span> <span class="fu">str_to_lower</span>(state) <span class="sc">|&gt;</span> <span class="fu">str_replace_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>, <span class="st">""</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    dir_name <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    file_name <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_name, state_formatted)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(dir_name, <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(file_name)){</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>        BASE_URL <span class="ot">&lt;-</span> <span class="st">"https://www.eia.gov"</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>        REQUEST <span class="ot">&lt;-</span> <span class="fu">request</span>(BASE_URL) <span class="sc">|&gt;</span> </span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_url_path</span>(<span class="st">"electricity"</span>, <span class="st">"state"</span>, state_formatted)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>        RESPONSE <span class="ot">&lt;-</span> <span class="fu">req_perform</span>(REQUEST)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resp_check_status</span>(RESPONSE)</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>        <span class="fu">writeLines</span>(<span class="fu">resp_body_string</span>(RESPONSE), file_name)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    TABLE <span class="ot">&lt;-</span> <span class="fu">read_html</span>(file_name) <span class="sc">|&gt;</span> </span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">html_element</span>(<span class="st">"table"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">html_table</span>() <span class="sc">|&gt;</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">Item =</span> <span class="fu">str_to_lower</span>(Item))</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="st">"U.S. rank"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(TABLE)){</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>        TABLE <span class="ot">&lt;-</span> TABLE <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">Rank =</span> <span class="st">`</span><span class="at">U.S. rank</span><span class="st">`</span>)</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    CO2_MWh <span class="ot">&lt;-</span> TABLE <span class="sc">|&gt;</span> </span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(Item <span class="sc">==</span> <span class="st">"carbon dioxide (lbs/mwh)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(Value) <span class="sc">|&gt;</span> </span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_replace_all</span>(<span class="st">","</span>, <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.numeric</span>()</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    PRIMARY <span class="ot">&lt;-</span> TABLE <span class="sc">|&gt;</span> </span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(Item <span class="sc">==</span> <span class="st">"primary energy source"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(Rank)</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    RATE <span class="ot">&lt;-</span> TABLE <span class="sc">|&gt;</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(Item <span class="sc">==</span> <span class="st">"average retail price (cents/kwh)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(Value) <span class="sc">|&gt;</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.numeric</span>()</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    GENERATION_MWh <span class="ot">&lt;-</span> TABLE <span class="sc">|&gt;</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(Item <span class="sc">==</span> <span class="st">"net generation (megawatthours)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(Value) <span class="sc">|&gt;</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_replace_all</span>(<span class="st">","</span>, <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.numeric</span>()</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">CO2_MWh               =</span> CO2_MWh, </span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>               <span class="at">primary_source        =</span> PRIMARY,</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>               <span class="at">electricity_price_MWh =</span> RATE <span class="sc">*</span> <span class="dv">10</span>, <span class="co"># / 100 cents to dollars &amp;</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>               <span class="co"># * 1000 kWh to MWH </span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>               <span class="at">generation_MWh        =</span> GENERATION_MWh, </span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>               <span class="at">state                 =</span> state, </span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>               <span class="at">abbreviation          =</span> abbr</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>EIA_SEP_REPORT <span class="ot">&lt;-</span> <span class="fu">map2</span>(state.name, state.abb, get_eia_sep) <span class="sc">|&gt;</span> <span class="fu">list_rbind</span>()</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(scales)</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(DT)</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>EIA_SEP_REPORT <span class="sc">|&gt;</span> </span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>abbreviation) <span class="sc">|&gt;</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(CO2_MWh)) <span class="sc">|&gt;</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">CO2_MWh =</span> scales<span class="sc">::</span><span class="fu">number</span>(CO2_MWh, <span class="at">big.mark=</span><span class="st">","</span>), </span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>           <span class="at">electricity_price_MWh =</span> scales<span class="sc">::</span><span class="fu">dollar</span>(electricity_price_MWh), </span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>           <span class="at">generation_MWh =</span> scales<span class="sc">::</span><span class="fu">number</span>(generation_MWh, <span class="at">big.mark=</span><span class="st">","</span>)) <span class="sc">|&gt;</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">`</span><span class="at">Pounds of CO2 Emitted per MWh of Electricity Produced</span><span class="st">`</span><span class="ot">=</span>CO2_MWh, </span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Primary Source of Electricity Generation</span><span class="st">`</span><span class="ot">=</span>primary_source, </span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Average Retail Price for 1000 kWh</span><span class="st">`</span><span class="ot">=</span>electricity_price_MWh, </span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Total Generation Capacity (MWh)</span><span class="st">`</span><span class="ot">=</span> generation_MWh, </span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>           <span class="at">State=</span>state) <span class="sc">|&gt;</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"EIA State Electricity Profile Report"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>EIA State Electricity Profile Report</caption>
<colgroup>
<col style="width: 30%">
<col style="width: 23%">
<col style="width: 19%">
<col style="width: 18%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Pounds of CO2 Emitted per MWh of Electricity Produced</th>
<th style="text-align: left;">Primary Source of Electricity Generation</th>
<th style="text-align: left;">Average Retail Price for 1000 kWh</th>
<th style="text-align: left;">Total Generation Capacity (MWh)</th>
<th style="text-align: left;">State</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1,925</td>
<td style="text-align: left;">Coal</td>
<td style="text-align: left;">$102.60</td>
<td style="text-align: left;">52,286,784</td>
<td style="text-align: left;">West Virginia</td>
</tr>
<tr class="even">
<td style="text-align: left;">1,864</td>
<td style="text-align: left;">Coal</td>
<td style="text-align: left;">$83.90</td>
<td style="text-align: left;">43,181,420</td>
<td style="text-align: left;">Wyoming</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1,741</td>
<td style="text-align: left;">Coal</td>
<td style="text-align: left;">$99.60</td>
<td style="text-align: left;">63,217,080</td>
<td style="text-align: left;">Kentucky</td>
</tr>
<tr class="even">
<td style="text-align: left;">1,514</td>
<td style="text-align: left;">Coal</td>
<td style="text-align: left;">$108.70</td>
<td style="text-align: left;">66,703,285</td>
<td style="text-align: left;">Missouri</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1,497</td>
<td style="text-align: left;">Coal</td>
<td style="text-align: left;">$114.90</td>
<td style="text-align: left;">90,046,880</td>
<td style="text-align: left;">Indiana</td>
</tr>
<tr class="even">
<td style="text-align: left;">1,444</td>
<td style="text-align: left;">Petroleum</td>
<td style="text-align: left;">$386.00</td>
<td style="text-align: left;">9,194,164</td>
<td style="text-align: left;">Hawaii</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1,414</td>
<td style="text-align: left;">Coal</td>
<td style="text-align: left;">$80.30</td>
<td style="text-align: left;">42,068,807</td>
<td style="text-align: left;">North Dakota</td>
</tr>
<tr class="even">
<td style="text-align: left;">1,354</td>
<td style="text-align: left;">Coal</td>
<td style="text-align: left;">$90.30</td>
<td style="text-align: left;">33,496,554</td>
<td style="text-align: left;">Utah</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1,180</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$214.10</td>
<td style="text-align: left;">6,717,825</td>
<td style="text-align: left;">Alaska</td>
</tr>
<tr class="even">
<td style="text-align: left;">1,148</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$127.20</td>
<td style="text-align: left;">62,548,705</td>
<td style="text-align: left;">Wisconsin</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1,127</td>
<td style="text-align: left;">Coal</td>
<td style="text-align: left;">$109.70</td>
<td style="text-align: left;">26,895,758</td>
<td style="text-align: left;">Montana</td>
</tr>
<tr class="even">
<td style="text-align: left;">1,103</td>
<td style="text-align: left;">Coal</td>
<td style="text-align: left;">$91.40</td>
<td style="text-align: left;">39,445,955</td>
<td style="text-align: left;">Nebraska</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1,095</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$128.50</td>
<td style="text-align: left;">4,772,059</td>
<td style="text-align: left;">Delaware</td>
</tr>
<tr class="even">
<td style="text-align: left;">1,054</td>
<td style="text-align: left;">Coal</td>
<td style="text-align: left;">$117.60</td>
<td style="text-align: left;">57,541,720</td>
<td style="text-align: left;">Colorado</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1,044</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$110.40</td>
<td style="text-align: left;">133,223,464</td>
<td style="text-align: left;">Ohio</td>
</tr>
<tr class="even">
<td style="text-align: left;">987</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$97.30</td>
<td style="text-align: left;">63,195,647</td>
<td style="text-align: left;">Arkansas</td>
</tr>
<tr class="odd">
<td style="text-align: left;">966</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$89.10</td>
<td style="text-align: left;">97,784,565</td>
<td style="text-align: left;">Louisiana</td>
</tr>
<tr class="even">
<td style="text-align: left;">923</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$232.10</td>
<td style="text-align: left;">19,695,884</td>
<td style="text-align: left;">Massachusetts</td>
</tr>
<tr class="odd">
<td style="text-align: left;">912</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$136.80</td>
<td style="text-align: left;">120,656,625</td>
<td style="text-align: left;">Michigan</td>
</tr>
<tr class="even">
<td style="text-align: left;">855</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$100.40</td>
<td style="text-align: left;">547,294,552</td>
<td style="text-align: left;">Texas</td>
</tr>
<tr class="odd">
<td style="text-align: left;">847</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$216.20</td>
<td style="text-align: left;">10,430,846</td>
<td style="text-align: left;">Rhode Island</td>
</tr>
<tr class="even">
<td style="text-align: left;">817</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$109.50</td>
<td style="text-align: left;">72,933,440</td>
<td style="text-align: left;">Mississippi</td>
</tr>
<tr class="odd">
<td style="text-align: left;">801</td>
<td style="text-align: left;">Wind</td>
<td style="text-align: left;">$122.10</td>
<td style="text-align: left;">57,276,862</td>
<td style="text-align: left;">Minnesota</td>
</tr>
<tr class="even">
<td style="text-align: left;">794</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$135.30</td>
<td style="text-align: left;">259,798,479</td>
<td style="text-align: left;">Florida</td>
</tr>
<tr class="odd">
<td style="text-align: left;">775</td>
<td style="text-align: left;">Wind</td>
<td style="text-align: left;">$94.20</td>
<td style="text-align: left;">69,836,973</td>
<td style="text-align: left;">Iowa</td>
</tr>
<tr class="even">
<td style="text-align: left;">763</td>
<td style="text-align: left;">Wind</td>
<td style="text-align: left;">$108.00</td>
<td style="text-align: left;">58,456,598</td>
<td style="text-align: left;">Kansas</td>
</tr>
<tr class="odd">
<td style="text-align: left;">759</td>
<td style="text-align: left;">Wind</td>
<td style="text-align: left;">$94.70</td>
<td style="text-align: left;">39,269,073</td>
<td style="text-align: left;">New Mexico</td>
</tr>
<tr class="even">
<td style="text-align: left;">733</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$110.60</td>
<td style="text-align: left;">129,221,513</td>
<td style="text-align: left;">Georgia</td>
</tr>
<tr class="odd">
<td style="text-align: left;">727</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$114.70</td>
<td style="text-align: left;">139,435,010</td>
<td style="text-align: left;">Alabama</td>
</tr>
<tr class="even">
<td style="text-align: left;">715</td>
<td style="text-align: left;">Nuclear</td>
<td style="text-align: left;">$106.90</td>
<td style="text-align: left;">77,791,204</td>
<td style="text-align: left;">Tennessee</td>
</tr>
<tr class="odd">
<td style="text-align: left;">684</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$121.90</td>
<td style="text-align: left;">111,838,736</td>
<td style="text-align: left;">Arizona</td>
</tr>
<tr class="even">
<td style="text-align: left;">655</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$125.70</td>
<td style="text-align: left;">235,924,937</td>
<td style="text-align: left;">Pennsylvania</td>
</tr>
<tr class="odd">
<td style="text-align: left;">654</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$130.90</td>
<td style="text-align: left;">42,164,375</td>
<td style="text-align: left;">Nevada</td>
</tr>
<tr class="even">
<td style="text-align: left;">648</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$93.00</td>
<td style="text-align: left;">89,236,024</td>
<td style="text-align: left;">Oklahoma</td>
</tr>
<tr class="odd">
<td style="text-align: left;">639</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$106.10</td>
<td style="text-align: left;">126,553,394</td>
<td style="text-align: left;">North Carolina</td>
</tr>
<tr class="even">
<td style="text-align: left;">594</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$106.80</td>
<td style="text-align: left;">91,059,344</td>
<td style="text-align: left;">Virginia</td>
</tr>
<tr class="odd">
<td style="text-align: left;">576</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$242.40</td>
<td style="text-align: left;">40,666,418</td>
<td style="text-align: left;">Connecticut</td>
</tr>
<tr class="even">
<td style="text-align: left;">558</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$143.40</td>
<td style="text-align: left;">36,000,650</td>
<td style="text-align: left;">Maryland</td>
</tr>
<tr class="odd">
<td style="text-align: left;">558</td>
<td style="text-align: left;">Nuclear</td>
<td style="text-align: left;">$105.00</td>
<td style="text-align: left;">100,853,387</td>
<td style="text-align: left;">South Carolina</td>
</tr>
<tr class="even">
<td style="text-align: left;">522</td>
<td style="text-align: left;">Nuclear</td>
<td style="text-align: left;">$117.50</td>
<td style="text-align: left;">177,737,641</td>
<td style="text-align: left;">Illinois</td>
</tr>
<tr class="odd">
<td style="text-align: left;">522</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$182.80</td>
<td style="text-align: left;">124,039,988</td>
<td style="text-align: left;">New York</td>
</tr>
<tr class="even">
<td style="text-align: left;">518</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$152.70</td>
<td style="text-align: left;">64,228,924</td>
<td style="text-align: left;">New Jersey</td>
</tr>
<tr class="odd">
<td style="text-align: left;">440</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$248.70</td>
<td style="text-align: left;">216,628,794</td>
<td style="text-align: left;">California</td>
</tr>
<tr class="even">
<td style="text-align: left;">428</td>
<td style="text-align: left;">Natural gas</td>
<td style="text-align: left;">$208.40</td>
<td style="text-align: left;">12,512,181</td>
<td style="text-align: left;">Maine</td>
</tr>
<tr class="odd">
<td style="text-align: left;">370</td>
<td style="text-align: left;">Hydroelectric</td>
<td style="text-align: left;">$90.80</td>
<td style="text-align: left;">17,842,446</td>
<td style="text-align: left;">Idaho</td>
</tr>
<tr class="even">
<td style="text-align: left;">369</td>
<td style="text-align: left;">Wind</td>
<td style="text-align: left;">$104.90</td>
<td style="text-align: left;">17,436,158</td>
<td style="text-align: left;">South Dakota</td>
</tr>
<tr class="odd">
<td style="text-align: left;">344</td>
<td style="text-align: left;">Hydroelectric</td>
<td style="text-align: left;">$103.20</td>
<td style="text-align: left;">61,691,869</td>
<td style="text-align: left;">Oregon</td>
</tr>
<tr class="even">
<td style="text-align: left;">292</td>
<td style="text-align: left;">Hydroelectric</td>
<td style="text-align: left;">$95.80</td>
<td style="text-align: left;">102,960,605</td>
<td style="text-align: left;">Washington</td>
</tr>
<tr class="odd">
<td style="text-align: left;">269</td>
<td style="text-align: left;">Nuclear</td>
<td style="text-align: left;">$229.60</td>
<td style="text-align: left;">16,824,999</td>
<td style="text-align: left;">New Hampshire</td>
</tr>
<tr class="even">
<td style="text-align: left;">8</td>
<td style="text-align: left;">Hydroelectric</td>
<td style="text-align: left;">$175.30</td>
<td style="text-align: left;">2,480,199</td>
<td style="text-align: left;">Vermont</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>ğŸŒ Here, we have collected the effective emissions per MWh2âš¡ as well as price and total state-wide generation capacity. We will use this data to compare the emissions of different transit modalities. We next turn to the National Transit Database to get information on various public transit authorities. Before we do so, however, letâ€™s explore the SEP data a bit first.ğŸ”¬ğŸ“‰</p>
</section>
</section>
<section id="initial-analysis-of-sep-data" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="initial-analysis-of-sep-data"><span class="header-section-number">2.2</span> ğŸ” Initial Analysis of SEP Data âš–ï¸</h2>
<p>Letâ€™s answer some burning (fossil-free, we hope!) questions: ğŸš‡</p>
<section id="which-state-has-the-most-expensive-retail-electricity" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="which-state-has-the-most-expensive-retail-electricity"><span class="header-section-number">2.2.1</span> 1. Which state has the most expensive retail electricity? ğŸ’°âš¡</h3>
<p>Which state will make you cry when you get your electricity bill? ğŸ˜­ Letâ€™s find out!</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>EIA_SEP_REPORT <span class="sc">|&gt;</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(electricity_price_MWh)) <span class="sc">|&gt;</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, electricity_price_MWh) <span class="sc">|&gt;</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Most Expensive Retail Electricity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Most Expensive Retail Electricity</caption>
<thead>
<tr class="header">
<th style="text-align: left;">state</th>
<th style="text-align: right;">electricity_price_MWh</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Hawaii</td>
<td style="text-align: right;">386</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="which-state-has-the-dirtiest-electricity-mix" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="which-state-has-the-dirtiest-electricity-mix"><span class="header-section-number">2.2.2</span> 2. Which state has the â€˜dirtiestâ€™ electricity mix? â˜ ï¸ğŸŒ«ï¸</h3>
<p>Which stateâ€™s power plants are puffing out COâ‚‚ like an angry dragon? ğŸ‰ğŸ”¥ Stay tuned for some shocking revelations!</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>EIA_SEP_REPORT <span class="sc">|&gt;</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(CO2_MWh)) <span class="sc">|&gt;</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, CO2_MWh) <span class="sc">|&gt;</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Dirtiest electricity mix"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Dirtiest electricity mix</caption>
<thead>
<tr class="header">
<th style="text-align: left;">state</th>
<th style="text-align: right;">CO2_MWh</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">West Virginia</td>
<td style="text-align: right;">1925</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="on-average-how-many-pounds-of-co2-are-emitted-per-mwh-of-electricity-produced-in-the-us" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="on-average-how-many-pounds-of-co2-are-emitted-per-mwh-of-electricity-produced-in-the-us"><span class="header-section-number">2.2.3</span> 3. On average, how many pounds of CO2 are emitted per MWh of electricity produced in the US?ğŸ­</h3>
<p>Time for some serious math! ğŸ“Š Weâ€™ll calculate the national average COâ‚‚ emissions per MWh using a <strong>weighted average</strong> because we like our stats accurate.ğŸ¯</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate weighted average CO2 emissions</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>weighted_avg_CO2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(EIA_SEP_REPORT<span class="sc">$</span>CO2_MWh <span class="sc">*</span> EIA_SEP_REPORT<span class="sc">$</span>generation_MWh) <span class="sc">/</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(EIA_SEP_REPORT<span class="sc">$</span>generation_MWh)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">Weighted_Avg_CO2 =</span> weighted_avg_CO2) <span class="sc">|&gt;</span> </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Weighted Average CO2 Emissions (lbs/MWh)"</span>),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">"Weighted Average CO2 Emissions Across All States"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Weighted Average CO2 Emissions Across All States</caption>
<thead>
<tr class="header">
<th style="text-align: right;">Weighted Average CO2 Emissions (lbs/MWh)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">805.3703</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="what-is-the-rarest-primary-energy-source-in-the-us-what-is-the-associated-cost-of-electricity-and-where-is-it-used" class="level3" data-number="2.2.4">
<h3 data-number="2.2.4" class="anchored" data-anchor-id="what-is-the-rarest-primary-energy-source-in-the-us-what-is-the-associated-cost-of-electricity-and-where-is-it-used"><span class="header-section-number">2.2.4</span> 4. ğŸ¦„ What is the rarest primary energy source in the US? What is the associated cost of electricity and where is it used?ğŸ§</h3>
<p>Whatâ€™s the mythical unicorn of US energy sources? ğŸ¦„âœ¨ And where is it hiding? Letâ€™s track it down and see how much it costs! ğŸ’¸</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>EIA_SEP_REPORT <span class="sc">|&gt;</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(primary_source) <span class="sc">|&gt;</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(n) <span class="sc">|&gt;</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(EIA_SEP_REPORT, <span class="at">by =</span> <span class="st">"primary_source"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, primary_source, electricity_price_MWh) <span class="sc">|&gt;</span> </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Primary Energy Source with Lowest Occurrence"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Primary Energy Source with Lowest Occurrence</caption>
<thead>
<tr class="header">
<th style="text-align: left;">state</th>
<th style="text-align: left;">primary_source</th>
<th style="text-align: right;">electricity_price_MWh</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Hawaii</td>
<td style="text-align: left;">Petroleum</td>
<td style="text-align: right;">386</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="my-home-state-texas-has-a-reputation-as-being-the-home-of-dirty-fossil-fuels-while-ny-has-a-reputation-as-a-leader-in-clean-energy.-how-many-times-cleaner-is-nys-energy-mix-than-that-of-texas" class="level3" data-number="2.2.5">
<h3 data-number="2.2.5" class="anchored" data-anchor-id="my-home-state-texas-has-a-reputation-as-being-the-home-of-dirty-fossil-fuels-while-ny-has-a-reputation-as-a-leader-in-clean-energy.-how-many-times-cleaner-is-nys-energy-mix-than-that-of-texas"><span class="header-section-number">2.2.5</span> 5. My home state, Texas, has a reputation as being the home of â€œdirty fossil fuelsâ€ while NY has a reputation as a leader in clean energy. How many times cleaner is NYâ€™s energy mix than that of Texas?ğŸŒ±ğŸ”¥</h3>
<p>Is Texas really the king of fossil fuels? ğŸ‘‘ And does New York truly deserve its green halo? ğŸ˜‡ Letâ€™s compare their energy mixes and see <strong>how many times cleaner NY is compared to TX</strong>! ğŸ“Šâš–ï¸</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>NY_CO2 <span class="ot">&lt;-</span> EIA_SEP_REPORT <span class="sc">|&gt;</span> <span class="fu">filter</span>(state <span class="sc">==</span> <span class="st">"New York"</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(CO2_MWh)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>TX_CO2 <span class="ot">&lt;-</span> EIA_SEP_REPORT <span class="sc">|&gt;</span> <span class="fu">filter</span>(state <span class="sc">==</span> <span class="st">"Texas"</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(CO2_MWh)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>cleaner_ratio <span class="ot">&lt;-</span> TX_CO2 <span class="sc">/</span> NY_CO2</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">Metric =</span> <span class="st">"Cleaner Ratio (TX to NY)"</span>, <span class="at">Value =</span> cleaner_ratio) <span class="sc">|&gt;</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Texas vs. New York CO2 Emissions Ratio"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Texas vs.&nbsp;New York CO2 Emissions Ratio</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Metric</th>
<th style="text-align: right;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Cleaner Ratio (TX to NY)</td>
<td style="text-align: right;">1.637931</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Fun fact: New Yorkâ€™s energy mix is cleaner than Texasâ€™s by a factor of <strong>1.637931</strong>. Thatâ€™s right, the Lone Star State might want to take notes from the Big Apple! ğŸâš¡</p>
</section>
</section>
<section id="importing-2023-annual-database-energy-consumption-report" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="importing-2023-annual-database-energy-consumption-report"><span class="header-section-number">2.3</span> Importing 2023 Annual Database Energy Consumption Report âš¡ğŸ“Š</h2>
<p>To analyze the energy consumption data for public transit agencies, we first need to import the <strong>2023 Annual Database Energy Consumption</strong> report. This Dataset is provided in an <strong>Excel spreadsheet (.xlsx)</strong> format. We will use the readxl package in R to load it.</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(readxl)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 'data/mp02' directory if not already present</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>DATA_DIR <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(DATA_DIR, <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>NTD_ENERGY_FILE <span class="ot">&lt;-</span> <span class="fu">file.path</span>(DATA_DIR, <span class="st">"2023_ntd_energy.xlsx"</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(NTD_ENERGY_FILE)){</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    DS <span class="ot">&lt;-</span> <span class="fu">download.file</span>(<span class="st">"https://www.transit.dot.gov/sites/fta.dot.gov/files/2024-10/2023%20Energy%20Consumption.xlsx"</span>, </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">destfile=</span>NTD_ENERGY_FILE, </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method=</span><span class="st">"curl"</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(DS <span class="sc">|</span> (<span class="fu">file.info</span>(NTD_ENERGY_FILE)<span class="sc">$</span>size <span class="sc">==</span> <span class="dv">0</span>)){</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"I was unable to download the NTD Energy File. Please try again.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Download failed"</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>NTD_ENERGY_RAW <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(NTD_ENERGY_FILE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Data Cleaning ğŸ§¹</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(tidyr)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>to_numeric_fill_0 <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">if_else</span>(x <span class="sc">==</span> <span class="st">"-"</span>, <span class="cn">NA</span>, x)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">replace_na</span>(<span class="fu">as.numeric</span>(x), <span class="dv">0</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>NTD_ENERGY <span class="ot">&lt;-</span> NTD_ENERGY_RAW <span class="sc">|&gt;</span> </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">`</span><span class="at">Reporter Type</span><span class="st">`</span>, </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Reporting Module</span><span class="st">`</span>, </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Other Fuel</span><span class="st">`</span>, </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Other Fuel Description</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">`</span><span class="at">Agency Name</span><span class="st">`</span>, </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>                     <span class="st">`</span><span class="at">Mode</span><span class="st">`</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>                     <span class="st">`</span><span class="at">TOS</span><span class="st">`</span>), </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>                  to_numeric_fill_0)) <span class="sc">|&gt;</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="st">`</span><span class="at">NTD ID</span><span class="st">`</span>, <span class="st">`</span><span class="at">Mode</span><span class="st">`</span>, <span class="st">`</span><span class="at">Agency Name</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), sum), </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">.groups =</span> <span class="st">"keep"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ENERGY =</span> <span class="fu">sum</span>(<span class="fu">c_across</span>(<span class="fu">c</span>(<span class="fu">where</span>(is.numeric))))) <span class="sc">|&gt;</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(ENERGY <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>ENERGY) <span class="sc">|&gt;</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="the-wheel-of-randomness" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="the-wheel-of-randomness"><span class="header-section-number">2.3.1</span> <strong>ğŸ² The Wheel of Randomness! ğŸ°</strong></h3>
<p><strong>Ladies and gentlemen, itâ€™s time for the Random Transit Energy Lottery! ğŸ‰ğŸŸï¸ Weâ€™ll now select 10 lucky transit energy records at random! Who will make the cut? Who will be left behind? Letâ€™s spin the wheel! ğŸ”„âœ¨</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample 10 random rows and then pass them to kable()</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>NTD_ENERGY <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Random Sample of NTD_ENERGY Data"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Random Sample of NTD_ENERGY Data</caption>
<colgroup>
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 22%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 7%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">NTD ID</th>
<th style="text-align: left;">Mode</th>
<th style="text-align: left;">Agency Name</th>
<th style="text-align: right;">Bio-Diesel</th>
<th style="text-align: right;">Bunker Fuel</th>
<th style="text-align: right;">C Natural Gas</th>
<th style="text-align: right;">Diesel Fuel</th>
<th style="text-align: right;">Electric Battery</th>
<th style="text-align: right;">Electric Propulsion</th>
<th style="text-align: right;">Ethanol</th>
<th style="text-align: right;">Methonal</th>
<th style="text-align: right;">Gasoline</th>
<th style="text-align: right;">Hydrogen</th>
<th style="text-align: right;">Kerosene</th>
<th style="text-align: right;">Liquified Nat Gas</th>
<th style="text-align: right;">Liquified Petroleum Gas</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">60056</td>
<td style="text-align: left;">MB</td>
<td style="text-align: left;">Dallas Area Rapid Transit</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8811975</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">302999</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">MB</td>
<td style="text-align: left;">City of Yakima</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">154538</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">90009</td>
<td style="text-align: left;">DR</td>
<td style="text-align: left;">San Mateo County Transit District</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">232752</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">40022</td>
<td style="text-align: left;">HR</td>
<td style="text-align: left;">Metropolitan Atlanta Rapid Transit Authority</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">77059623</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">30026</td>
<td style="text-align: left;">DR</td>
<td style="text-align: left;">River Valley Transit Authority</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8893</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">20004</td>
<td style="text-align: left;">MB</td>
<td style="text-align: left;">Niagara Frontier Transportation Authority</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">968439</td>
<td style="text-align: right;">957405</td>
<td style="text-align: right;">9444</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20002</td>
<td style="text-align: left;">MB</td>
<td style="text-align: left;">Capital District Transportation Authority</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2070980</td>
<td style="text-align: right;">137732</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7360</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">40185</td>
<td style="text-align: left;">MB</td>
<td style="text-align: left;">Bay County Transportation Planning Organization</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">90870</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">60017</td>
<td style="text-align: left;">MB</td>
<td style="text-align: left;">Central Oklahoma Transportation and Parking Authority</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">594146</td>
<td style="text-align: right;">253820</td>
<td style="text-align: right;">56424</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">40035</td>
<td style="text-align: left;">RB</td>
<td style="text-align: left;">Central Florida Regional Transportation Authority</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10575</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="recoding-transit-modes" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="recoding-transit-modes"><span class="header-section-number">2.4</span> ğŸš‡ Recoding Transit Modes ğŸš‹ğŸ­</h2>
<p>ğŸš§ <strong>Warning: Mysterious Codes Ahead!</strong> ğŸš§</p>
<p>Before we can make sense of the <strong>Mode</strong> column, we need to crack the code! ğŸ•µï¸â€â™‚ï¸ First, letâ€™s uncover the unique <strong>Mode codes</strong> in our data using <code>distinct()</code>. Then, we consult the sacred texts (a.k.a. the NTD website ğŸ“œ) to decipher their meanings. ğŸ§</p>
<section id="time-for-a-makeover" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="time-for-a-makeover"><span class="header-section-number">2.4.1</span> ğŸ—ï¸ Time for a Makeover! ğŸ–Œï¸</h3>
<p>The <strong>Mode</strong> column needs a glow-up! âœ¨ Weâ€™re about to give those cryptic abbreviations some <strong>real names</strong> so theyâ€™re easier to work with. Ready? Letâ€™s do this! ğŸ¬</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>NTD_ENERGY <span class="ot">&lt;-</span> NTD_ENERGY <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Mode =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"HR"</span>  <span class="sc">~</span> <span class="st">"Heavy Rail"</span>, </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"LR"</span>  <span class="sc">~</span> <span class="st">"Light Rail"</span>, </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"CR"</span>  <span class="sc">~</span> <span class="st">"Commuter Rail"</span>, </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"MB"</span>  <span class="sc">~</span> <span class="st">"Motor Bus"</span>, </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"TB"</span>  <span class="sc">~</span> <span class="st">"Trolleybus"</span>, </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"TR"</span>  <span class="sc">~</span> <span class="st">"Heritage Streetcar"</span>, </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"SR"</span>  <span class="sc">~</span> <span class="st">"Modern Streetcar"</span>, </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"VP"</span>  <span class="sc">~</span> <span class="st">"Vanpool"</span>, </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"DR"</span>  <span class="sc">~</span> <span class="st">"Demand Response"</span>, </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"FB"</span>  <span class="sc">~</span> <span class="st">"Ferryboat"</span>, </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"MG"</span>  <span class="sc">~</span> <span class="st">"Monorail/Automated Guideway"</span>, </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"PB"</span>  <span class="sc">~</span> <span class="st">"Publico"</span>, </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"CB"</span>  <span class="sc">~</span> <span class="st">"Commuter Bus"</span>,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"RB"</span>  <span class="sc">~</span> <span class="st">"Rapid Bus"</span>,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"AR"</span>  <span class="sc">~</span> <span class="st">"Aerial Tramway"</span>,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"YR"</span>  <span class="sc">~</span> <span class="st">"Hybrid Rail"</span>,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"IP"</span>  <span class="sc">~</span> <span class="st">"Inclined Plane Railway"</span>,</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"CC"</span>  <span class="sc">~</span> <span class="st">"Cable Car"</span>,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span>          <span class="sc">~</span> <span class="st">"Unknown"</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>NTD_ENERGY <span class="sc">|&gt;</span> <span class="fu">distinct</span>(Mode) <span class="sc">|&gt;</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Distinct Modes of Transport"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Distinct Modes of Transport</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Mode</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Demand Response</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ferryboat</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Motor Bus</td>
</tr>
<tr class="even">
<td style="text-align: left;">Modern Streetcar</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Trolleybus</td>
</tr>
<tr class="even">
<td style="text-align: left;">Vanpool</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Commuter Bus</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rapid Bus</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Light Rail</td>
</tr>
<tr class="even">
<td style="text-align: left;">Monorail/Automated Guideway</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Commuter Rail</td>
</tr>
<tr class="even">
<td style="text-align: left;">Aerial Tramway</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Heritage Streetcar</td>
</tr>
<tr class="even">
<td style="text-align: left;">Heavy Rail</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hybrid Rail</td>
</tr>
<tr class="even">
<td style="text-align: left;">Inclined Plane Railway</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Publico</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cable Car</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="annual-database-service-by-agency" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="annual-database-service-by-agency"><span class="header-section-number">2.5</span> 2023 Annual Database Service by Agency ğŸ“ŠğŸš‡</h2>
<p>ğŸš¨ <strong>Breaking News!</strong> ğŸš¨ The latest <strong>2023 Service by Agency</strong> report has just dropped! ğŸ¤ğŸ“‰ Weâ€™re diving in to extract the juicy details about passenger trips across different transit services. ğŸš†ğŸšŒ</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>NTD_SERVICE_FILE <span class="ot">&lt;-</span> <span class="fu">file.path</span>(DATA_DIR, <span class="st">"2023_service.csv"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(NTD_SERVICE_FILE)){</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    DS <span class="ot">&lt;-</span> <span class="fu">download.file</span>(<span class="st">"https://data.transportation.gov/resource/6y83-7vuw.csv"</span>, </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">destfile=</span>NTD_SERVICE_FILE, </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method=</span><span class="st">"curl"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(DS <span class="sc">|</span> (<span class="fu">file.info</span>(NTD_SERVICE_FILE)<span class="sc">$</span>size <span class="sc">==</span> <span class="dv">0</span>)){</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"I was unable to download the NTD Service File. Please try again.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Download failed"</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>NTD_SERVICE_RAW <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(NTD_SERVICE_FILE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>ğŸ“¢ <strong>Will our dataset arrive safely, or will it ghost us? ğŸ‘»</strong> Only time (and a stable internet connection) will tell! â³</p>
</section>
<section id="clean-up-time" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="clean-up-time"><span class="header-section-number">2.6</span> Clean-Up Time! ğŸ§¹âœ¨</h2>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>NTD_SERVICE <span class="ot">&lt;-</span> NTD_SERVICE_RAW <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="st">`</span><span class="at">NTD ID</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">_5_digit_ntd_id</span><span class="st">`</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">Agency =</span> agency, </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">City   =</span> max_city, </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">State  =</span> max_state,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">UPT    =</span> sum_unlinked_passenger_trips_upt, </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">MILES  =</span> sum_passenger_miles) <span class="sc">|&gt;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"^[A-Z]"</span>, <span class="at">ignore.case=</span><span class="cn">FALSE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(MILES <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>ğŸ› ï¸ <strong>Boom! Now our dataset is sparkling clean!</strong> âœ¨ Itâ€™s time to put these numbers to work! ğŸ’ª</p>
</section>
<section id="exploring-ntd-service-data---lets-dive-in" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="exploring-ntd-service-data---lets-dive-in"><span class="header-section-number">2.7</span> ğŸ›¥ï¸ Exploring NTD Service Data - Letâ€™s Dive In!</h2>
<p>Alright, folks! Time to put on our data analyst hats and explore some seriously juicy transit numbers from the <strong>NTD_SERVICE</strong> Dataset. Weâ€™re going to answer some fun questions that might just reveal whoâ€™s cruising on the green lane of transit efficiency and whoâ€™s still stuck in the slow lane. Letâ€™s see how this data speeds up the fun! ğŸ˜</p>
<section id="which-transit-service-has-the-most-upt-annually" class="level3" data-number="2.7.1">
<h3 data-number="2.7.1" class="anchored" data-anchor-id="which-transit-service-has-the-most-upt-annually"><span class="header-section-number">2.7.1</span> 1. Which transit service has the most UPT annually? ğŸ†</h3>
<p>Which transit service is the busiest, with the most Unlinked Passenger Trips (UPT) annually? Spoiler alert: Itâ€™s probably not the one with the tiniest buses.ğŸšŒ</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>NTD_SERVICE <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(UPT)) <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(UPT)) <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Agency, UPT) <span class="sc">|&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Most UTP Annually"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Most UTP Annually</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Agency</th>
<th style="text-align: right;">UPT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">MTA New York City Transit</td>
<td style="text-align: right;">2632003044</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="what-is-the-average-trip-length-of-a-trip-on-mta-nyc" class="level3" data-number="2.7.2">
<h3 data-number="2.7.2" class="anchored" data-anchor-id="what-is-the-average-trip-length-of-a-trip-on-mta-nyc"><span class="header-section-number">2.7.2</span> 2. What is the average trip length of a trip on MTA NYC? ğŸ—½</h3>
<p>Time for some serious subway sleuthing! ğŸ•µï¸â€â™‚ï¸ How long is the average trip on the MTA NYC? Are New Yorkers making quick, subway sprints, or are they getting comfy for a longer ride? Weâ€™re on a mission to figure out just how far these trips stretch, so hop on board! ğŸš‡â³</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>NTD_SERVICE <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"MTA"</span>, Agency, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Average_Trip_Length =</span> <span class="fu">sum</span>(MILES, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sum</span>(UPT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Average Trip Length On MTA Nyc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Average Trip Length On MTA Nyc</caption>
<thead>
<tr class="header">
<th style="text-align: right;">Average_Trip_Length</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">4.562402</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="which-transit-service-in-nyc-has-the-longest-average-trip-length" class="level3" data-number="2.7.3">
<h3 data-number="2.7.3" class="anchored" data-anchor-id="which-transit-service-in-nyc-has-the-longest-average-trip-length"><span class="header-section-number">2.7.3</span> 3. Which transit service in NYC has the longest average trip length? ğŸš‹</h3>
<p>Which MTA service in New York City (including all five boroughs, yes, even Brooklyn ğŸ—½) has the longest average trip length? Letâ€™s just say, itâ€™s probably not the one where the subway rats are the most frequent passengers. ğŸ€</p>
<p>P.S. Youâ€™ll want to be extra careful with that City column; we wouldnâ€™t want to accidentally send our buses on a detour to Brooklyn when they should be cruising through Manhattan!</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>NYC_SERVICES <span class="ot">&lt;-</span> NTD_SERVICE <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(State <span class="sc">==</span> <span class="st">"NY"</span>, MILES <span class="sc">&gt;</span> <span class="dv">0</span>, UPT <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Average_Trip_Length =</span> MILES <span class="sc">/</span> UPT) <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Average_Trip_Length)) <span class="sc">|&gt;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Agency, City, Average_Trip_Length)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(NYC_SERVICES, <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"NYC Longest Average Trip Length"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>NYC Longest Average Trip Length</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Agency</th>
<th style="text-align: left;">City</th>
<th style="text-align: right;">Average_Trip_Length</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Hampton Jitney, Inc.</td>
<td style="text-align: left;">Calverton</td>
<td style="text-align: right;">92.4465</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="which-state-has-the-fewest-total-miles-travelled-by-public-transit" class="level3" data-number="2.7.4">
<h3 data-number="2.7.4" class="anchored" data-anchor-id="which-state-has-the-fewest-total-miles-travelled-by-public-transit"><span class="header-section-number">2.7.4</span> 4. Which state has the fewest total miles travelled by public transit? ğŸ¢</h3>
<p>Which state is the turtle in the race, with the fewest total miles travelled by public transit? ğŸ¢ Are some states just cruising along at a leisurely pace, or are they barely moving at all? Itâ€™s time to find out whoâ€™s not clocking up the miles! ğŸ›‘ğŸš—</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>NTD_SERVICE <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(State) <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total_Miles =</span> <span class="fu">sum</span>(MILES, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Total_Miles) <span class="sc">|&gt;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Fewest total miles Travelled By Public Transit"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Fewest total miles Travelled By Public Transit</caption>
<thead>
<tr class="header">
<th style="text-align: left;">State</th>
<th style="text-align: right;">Total_Miles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">NH</td>
<td style="text-align: right;">3749892</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="are-all-states-represented-in-this-data-if-no-which-ones-are-missing-the-state.name-and-state.abb-objects-we-used-above-may-be-useful-here." class="level3" data-number="2.7.5">
<h3 data-number="2.7.5" class="anchored" data-anchor-id="are-all-states-represented-in-this-data-if-no-which-ones-are-missing-the-state.name-and-state.abb-objects-we-used-above-may-be-useful-here."><span class="header-section-number">2.7.5</span> 5. Are all states represented in this data? If no, which ones are missing? The state.name and state.abb objects we used above may be useful here.ğŸšğŸ—ºï¸</h3>
<p>Now for a little mystery â€“ are all states in this data? Or did a few sneak out of the spotlight? ğŸ‘€ Letâ€™s use the state.name and state.abb to track down any states that may have taken the wrong exit. Looks like itâ€™s time for a little data detective work! ğŸ”ğŸ’¼</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>all_states <span class="ot">&lt;-</span> state.abb  <span class="co"># Vector of all US state abbreviations</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>present_states <span class="ot">&lt;-</span> <span class="fu">unique</span>(NTD_SERVICE<span class="sc">$</span>State)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>missing_states <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(all_states, present_states)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(missing_states, <span class="at">caption =</span> <span class="st">"Missing States"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Missing States</caption>
<thead>
<tr class="header">
<th style="text-align: left;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AZ</td>
</tr>
<tr class="even">
<td style="text-align: left;">AR</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CA</td>
</tr>
<tr class="even">
<td style="text-align: left;">CO</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HI</td>
</tr>
<tr class="even">
<td style="text-align: left;">IA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">KS</td>
</tr>
<tr class="even">
<td style="text-align: left;">LA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MO</td>
</tr>
<tr class="even">
<td style="text-align: left;">MT</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NE</td>
</tr>
<tr class="even">
<td style="text-align: left;">NV</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NM</td>
</tr>
<tr class="even">
<td style="text-align: left;">ND</td>
</tr>
<tr class="odd">
<td style="text-align: left;">OK</td>
</tr>
<tr class="even">
<td style="text-align: left;">SD</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TX</td>
</tr>
<tr class="even">
<td style="text-align: left;">UT</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WY</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="calculate-emissions-lets-crunch-some-carbon" class="level2" data-number="2.8">
<h2 data-number="2.8" class="anchored" data-anchor-id="calculate-emissions-lets-crunch-some-carbon"><span class="header-section-number">2.8</span> ğŸŒ Calculate Emissions â€“ Letâ€™s Crunch Some Carbon! ğŸ’¨</h2>
<p>Time to put on our environmental cap and get down to the nitty-gritty of CO2 emissions! Weâ€™re about to take a deep dive into some data to calculate the total emissions from different transit agencies and their modes. Spoiler alert: Weâ€™re going green â€“ but with a twist! ğŸŒ±ğŸ”¢</p>
<section id="join-the-three-tables-the-ultimate-data-party" class="level3" data-number="2.8.1">
<h3 data-number="2.8.1" class="anchored" data-anchor-id="join-the-three-tables-the-ultimate-data-party"><span class="header-section-number">2.8.1</span> Join the Three Tables â€“ The Ultimate Data Party ğŸ‰</h3>
<p>Hereâ€™s where we get our hands dirty (but in an eco-friendly way, of course!). Weâ€™ll join three tables together like the perfect data trio:</p>
<p><strong>NTD_SERVICE</strong> ğŸš â€“ It tells us the Agency and Mode (because, letâ€™s face it, transit is all about style, right?)</p>
<p><strong>NTD_ENERGY</strong> âš¡ â€“ This tableâ€™s going to give us the lowdown on all the fuel sources. Itâ€™s like fuelâ€™s Wikipedia page, but with more numbers.</p>
<p><strong>EIA_SEP_REPORT</strong> ğŸ“Š â€“ This is where the magic happens! It tells us the CO2 emissions per MWh. Time to add some climate-friendly math into the mix. Once weâ€™ve got these three tables chatting with each other, weâ€™re ready to roll!</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a mapping of state abbreviations to full names</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>state_abbrev_to_full <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AL"</span> <span class="ot">=</span> <span class="st">"Alabama"</span>, <span class="st">"AK"</span> <span class="ot">=</span> <span class="st">"Alaska"</span>, <span class="st">"AZ"</span> <span class="ot">=</span> <span class="st">"Arizona"</span>, <span class="st">"AR"</span> <span class="ot">=</span> <span class="st">"Arkansas"</span>, <span class="st">"CA"</span> <span class="ot">=</span> <span class="st">"California"</span>, <span class="st">"CO"</span> <span class="ot">=</span> <span class="st">"Colorado"</span>, </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CT"</span> <span class="ot">=</span> <span class="st">"Connecticut"</span>, <span class="st">"DE"</span> <span class="ot">=</span> <span class="st">"Delaware"</span>, <span class="st">"FL"</span> <span class="ot">=</span> <span class="st">"Florida"</span>, <span class="st">"GA"</span> <span class="ot">=</span> <span class="st">"Georgia"</span>, <span class="st">"HI"</span> <span class="ot">=</span> <span class="st">"Hawaii"</span>, <span class="st">"ID"</span> <span class="ot">=</span> <span class="st">"Idaho"</span>, </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IL"</span> <span class="ot">=</span> <span class="st">"Illinois"</span>, <span class="st">"IN"</span> <span class="ot">=</span> <span class="st">"Indiana"</span>, <span class="st">"IA"</span> <span class="ot">=</span> <span class="st">"Iowa"</span>, <span class="st">"KS"</span> <span class="ot">=</span> <span class="st">"Kansas"</span>, <span class="st">"KY"</span> <span class="ot">=</span> <span class="st">"Kentucky"</span>, <span class="st">"LA"</span> <span class="ot">=</span> <span class="st">"Louisiana"</span>, </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ME"</span> <span class="ot">=</span> <span class="st">"Maine"</span>, <span class="st">"MD"</span> <span class="ot">=</span> <span class="st">"Maryland"</span>, <span class="st">"MA"</span> <span class="ot">=</span> <span class="st">"Massachusetts"</span>, <span class="st">"MI"</span> <span class="ot">=</span> <span class="st">"Michigan"</span>, <span class="st">"MN"</span> <span class="ot">=</span> <span class="st">"Minnesota"</span>, <span class="st">"MS"</span> <span class="ot">=</span> <span class="st">"Mississippi"</span>, </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MO"</span> <span class="ot">=</span> <span class="st">"Missouri"</span>, <span class="st">"MT"</span> <span class="ot">=</span> <span class="st">"Montana"</span>, <span class="st">"NE"</span> <span class="ot">=</span> <span class="st">"Nebraska"</span>, <span class="st">"NV"</span> <span class="ot">=</span> <span class="st">"Nevada"</span>, <span class="st">"NH"</span> <span class="ot">=</span> <span class="st">"New Hampshire"</span>, <span class="st">"NJ"</span> <span class="ot">=</span> <span class="st">"New Jersey"</span>, </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NM"</span> <span class="ot">=</span> <span class="st">"New Mexico"</span>, <span class="st">"NY"</span> <span class="ot">=</span> <span class="st">"New York"</span>, <span class="st">"NC"</span> <span class="ot">=</span> <span class="st">"North Carolina"</span>, <span class="st">"ND"</span> <span class="ot">=</span> <span class="st">"North Dakota"</span>, <span class="st">"OH"</span> <span class="ot">=</span> <span class="st">"Ohio"</span>, <span class="st">"OK"</span> <span class="ot">=</span> <span class="st">"Oklahoma"</span>, </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"OR"</span> <span class="ot">=</span> <span class="st">"Oregon"</span>, <span class="st">"PA"</span> <span class="ot">=</span> <span class="st">"Pennsylvania"</span>, <span class="st">"RI"</span> <span class="ot">=</span> <span class="st">"Rhode Island"</span>, <span class="st">"SC"</span> <span class="ot">=</span> <span class="st">"South Carolina"</span>, <span class="st">"SD"</span> <span class="ot">=</span> <span class="st">"South Dakota"</span>, </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TN"</span> <span class="ot">=</span> <span class="st">"Tennessee"</span>, <span class="st">"TX"</span> <span class="ot">=</span> <span class="st">"Texas"</span>, <span class="st">"UT"</span> <span class="ot">=</span> <span class="st">"Utah"</span>, <span class="st">"VT"</span> <span class="ot">=</span> <span class="st">"Vermont"</span>, <span class="st">"VA"</span> <span class="ot">=</span> <span class="st">"Virginia"</span>, <span class="st">"WA"</span> <span class="ot">=</span> <span class="st">"Washington"</span>, </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"WV"</span> <span class="ot">=</span> <span class="st">"West Virginia"</span>, <span class="st">"WI"</span> <span class="ot">=</span> <span class="st">"Wisconsin"</span>, <span class="st">"WY"</span> <span class="ot">=</span> <span class="st">"Wyoming"</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix State Names in NTD_SERVICE before joining</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>NTD_SERVICE <span class="ot">&lt;-</span> NTD_SERVICE <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">State =</span> state_abbrev_to_full[State])</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Now perform the joins</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>NTD_EMISSIONS <span class="ot">&lt;-</span> NTD_SERVICE <span class="sc">|&gt;</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Agency, State, <span class="st">`</span><span class="at">NTD ID</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(NTD_ENERGY, <span class="at">by =</span> <span class="st">"NTD ID"</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(EIA_SEP_REPORT, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"State"</span> <span class="ot">=</span> <span class="st">"state"</span>))</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the join worked</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(NTD_EMISSIONS)  <span class="co"># Should no longer be (0, X)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 650  23</code></pre>
</div>
</div>
</section>
<section id="the-ultimate-emissions-table" class="level3" data-number="2.8.2">
<h3 data-number="2.8.2" class="anchored" data-anchor-id="the-ultimate-emissions-table"><span class="header-section-number">2.8.2</span> The Ultimate Emissions Table ğŸ§®</h3>
<p><strong>Weâ€™re going to create a super sleek table with all the goods:</strong></p>
<p><strong>Agency + Mode Pair â€“</strong> These are the dynamic duos of transit! ğŸšğŸš†</p>
<p><strong>State â€“ Every agency has a home</strong>, and weâ€™ll find out which state itâ€™s calling its turf! ğŸŒ</p>
<p><strong>Fuel Sources</strong> â€“ Because we need to know how those buses are powering through your city streets! ğŸš¨</p>
<p><strong>CO2 Emissions per MWh</strong> â€“ Letâ€™s see how much carbonâ€™s being emitted for every megawatt-hour of power. (The more we know, the greener we grow! ğŸŒ³)</p>
<p><strong>Now, letâ€™s clean up some fuel names and make sure everything aligns:</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>NTD_EMISSIONS <span class="ot">&lt;-</span> NTD_EMISSIONS <span class="sc">|&gt;</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Bio diesel"</span> <span class="ot">=</span> <span class="st">"Bio-Diesel"</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Natural Gas"</span> <span class="ot">=</span> <span class="st">"C Natural Gas"</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"LNG"</span> <span class="ot">=</span> <span class="st">"Liquified Nat Gas"</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"LPG"</span> <span class="ot">=</span> <span class="st">"Liquified Petroleum Gas"</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Battery Electric"</span> <span class="ot">=</span> <span class="st">"Electric Battery"</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Electric"</span> <span class="ot">=</span> <span class="st">"Electric Propulsion"</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="the-formula-its-math-but-make-it-eco" class="level3" data-number="2.8.3">
<h3 data-number="2.8.3" class="anchored" data-anchor-id="the-formula-its-math-but-make-it-eco"><span class="header-section-number">2.8.3</span> The Formula â€“ Itâ€™s Math, But Make It Eco! ğŸ§‘â€ğŸ«</h3>
<p>Now for the fun part â€“ the math! ğŸ’¡</p>
<p>Weâ€™re going to use a long-ish arithmetic formula (donâ€™t worry, itâ€™s just a couple of steps) inside a mutate function to compute the total emissions for each Agency + Mode Pair. Weâ€™ll need to convert combustion fuels to CO2 emissions â€“ but donâ€™t panic, weâ€™ve got conversion factors! ğŸ’ª You can hard code these bad boys in your script for simplicity:</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>fuel_emission_factors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Diesel Fuel"</span> <span class="ot">=</span> <span class="fl">10.19</span>,    <span class="co"># kg CO2 per gallon</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Gasoline"</span> <span class="ot">=</span> <span class="fl">8.89</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Natural Gas"</span> <span class="ot">=</span> <span class="fl">52.91</span>,    <span class="co"># kg CO2 per MMBtu</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LPG"</span> <span class="ot">=</span> <span class="fl">5.79</span>,  </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LNG"</span> <span class="ot">=</span> <span class="fl">4.29</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Kerosene"</span> <span class="ot">=</span> <span class="fl">9.96</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ethanol"</span> <span class="ot">=</span> <span class="fl">1.94</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Hydrogen"</span> <span class="ot">=</span> <span class="dv">0</span>,           <span class="co"># No emissions from hydrogen</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Battery Electric"</span> <span class="ot">=</span> <span class="dv">0</span>,   <span class="co"># Handled separately using CO2_MWh</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Electric"</span> <span class="ot">=</span> <span class="dv">0</span>            <span class="co"># Handled separately using CO2_MWh</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Then, apply the emissions calculation:</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>NTD_EMISSIONS <span class="ot">&lt;-</span> NTD_EMISSIONS <span class="sc">|&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Fuel_Emissions =</span> (<span class="st">`</span><span class="at">Diesel Fuel</span><span class="st">`</span> <span class="sc">*</span> fuel_emission_factors[<span class="st">"Diesel Fuel"</span>]) <span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>      (<span class="st">`</span><span class="at">Gasoline</span><span class="st">`</span> <span class="sc">*</span> fuel_emission_factors[<span class="st">"Gasoline"</span>]) <span class="sc">+</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>      (<span class="st">`</span><span class="at">Natural Gas</span><span class="st">`</span> <span class="sc">*</span> fuel_emission_factors[<span class="st">"Natural Gas"</span>]) <span class="sc">+</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>      (<span class="st">`</span><span class="at">LPG</span><span class="st">`</span> <span class="sc">*</span> fuel_emission_factors[<span class="st">"LPG"</span>]) <span class="sc">+</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>      (<span class="st">`</span><span class="at">LNG</span><span class="st">`</span> <span class="sc">*</span> fuel_emission_factors[<span class="st">"LNG"</span>]) <span class="sc">+</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>      (<span class="st">`</span><span class="at">Kerosene</span><span class="st">`</span> <span class="sc">*</span> fuel_emission_factors[<span class="st">"Kerosene"</span>]) <span class="sc">+</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>      (<span class="st">`</span><span class="at">Ethanol</span><span class="st">`</span> <span class="sc">*</span> fuel_emission_factors[<span class="st">"Ethanol"</span>]) <span class="sc">+</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>      (<span class="st">`</span><span class="at">Hydrogen</span><span class="st">`</span> <span class="sc">*</span> fuel_emission_factors[<span class="st">"Hydrogen"</span>])</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>NTD_EMISSIONS <span class="ot">&lt;-</span> NTD_EMISSIONS <span class="sc">|&gt;</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">Electricity_Emissions =</span> <span class="st">`</span><span class="at">Electric</span><span class="st">`</span> <span class="sc">*</span> CO2_MWh</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>NTD_EMISSIONS <span class="ot">&lt;-</span> NTD_EMISSIONS <span class="sc">|&gt;</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">Total_Emissions =</span> Fuel_Emissions <span class="sc">+</span> Electricity_Emissions</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>ğŸ’š Letâ€™s Save the Planet â€“ One Data Row at a Time! Now that our emissions data is ready, letâ€™s take a look at the final product! ğŸŒ</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>NTD_EMISSIONS <span class="sc">|&gt;</span> <span class="fu">select</span>(Agency, Mode, State, Fuel_Emissions, Electricity_Emissions, Total_Emissions) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(Total_Emissions))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 650 Ã— 6
   Agency       Mode  State Fuel_Emissions Electricity_Emissions Total_Emissions
   &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;          &lt;dbl&gt;                 &lt;dbl&gt;           &lt;dbl&gt;
 1 MTA New Yorâ€¦ Heavâ€¦ New â€¦             0           807152731200   807152731200 
 2 MTA Long Isâ€¦ Commâ€¦ New â€¦      72196486.          286155388800   286227585286.
 3 Metro-Northâ€¦ Commâ€¦ New â€¦      71313390.          211429086408   211500399798.
 4 New Jersey â€¦ Commâ€¦ New â€¦     143674231.          189542379222   189686053453.
 5 Chicago Traâ€¦ Heavâ€¦ Illiâ€¦             0           177353391510   177353391510 
 6 Southeasterâ€¦ Commâ€¦ Pennâ€¦             0           134209031675   134209031675 
 7 Massachusetâ€¦ Heavâ€¦ Massâ€¦             0           125346279760   125346279760 
 8 Southeasterâ€¦ Heavâ€¦ Pennâ€¦             0            75871258865    75871258865 
 9 Metropolitaâ€¦ Heavâ€¦ Georâ€¦             0            56484703659    56484703659 
10 Port Authorâ€¦ Heavâ€¦ New â€¦             0            51187752738    51187752738 
# â„¹ 640 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="normalize-emissions-to-transit-usage" class="level2" data-number="2.9">
<h2 data-number="2.9" class="anchored" data-anchor-id="normalize-emissions-to-transit-usage"><span class="header-section-number">2.9</span> Normalize Emissions to Transit Usage ğŸš†</h2>
<p>In this task, weâ€™re on a mission to normalize emissions (a fancy way of saying â€œmake fair comparisonsâ€) based on:</p>
<p><strong>Emissions per Unlinked Passenger Trip (UPT) ğŸšŒğŸ‘¥</strong></p>
<p><strong>Emissions per Passenger Mile ğŸš‹ğŸŒ±</strong></p>
<section id="normalize-emissions-leveling-the-playing-field" class="level3" data-number="2.9.1">
<h3 data-number="2.9.1" class="anchored" data-anchor-id="normalize-emissions-leveling-the-playing-field"><span class="header-section-number">2.9.1</span> Normalize Emissions â€“ Leveling the Playing Field! ğŸ¯</h3>
<p>Before we start handing out gold medals ğŸ… (or shameful side-eyes ğŸ‘€), we normalize emissions based on ridership. This ensures a fair fightâ€”because comparing a tiny rural bus route to New York Cityâ€™s subway isnâ€™t exactly fair, right? ğŸ˜†</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out agencies with extremely small values to avoid distortions</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>AGENCY_NORMALIZED <span class="ot">&lt;-</span> NTD_SERVICE <span class="sc">%&gt;%</span>   <span class="co"># Use your actual dataset</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(NTD_EMISSIONS, <span class="at">by =</span> <span class="st">"NTD ID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Total_Emissions))  <span class="co"># Ensure you have valid emission data</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out agencies with extremely small values to avoid distortions</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>AGENCY_NORMALIZED <span class="ot">&lt;-</span> AGENCY_NORMALIZED <span class="sc">%&gt;%</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(UPT <span class="sc">&gt;</span> <span class="dv">1000</span>, MILES <span class="sc">&gt;</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span>  <span class="co"># Adjust thresholds as needed</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Emissions_per_UPT =</span> <span class="fu">ifelse</span>(UPT <span class="sc">&gt;</span> <span class="dv">0</span>, Total_Emissions <span class="sc">/</span> UPT, <span class="cn">NA</span>),</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Emissions_per_Passenger_Mile =</span> <span class="fu">ifelse</span>(MILES <span class="sc">&gt;</span> <span class="dv">0</span>, Total_Emissions <span class="sc">/</span> MILES, <span class="cn">NA</span>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>ğŸš¦ Now, with that done, letâ€™s move on to <strong>finding our champions!</strong></p>
</section>
</section>
<section id="the-greenest-transit-agency-gta-iv-award-1" class="level2" data-number="2.10">
<h2 data-number="2.10" class="anchored" data-anchor-id="the-greenest-transit-agency-gta-iv-award-1"><span class="header-section-number">2.10</span> <strong>ğŸ¥‡ The Greenest Transit Agency (GTA IV Award #1) ğŸŒ±ğŸš†</strong></h2>
<p>Which agency has the <strong>lowest emissions per passenger trip</strong>? And which one produces the least pollution <strong>per mile traveled</strong>?</p>
<p>Letâ€™s <strong>roll out the green carpet</strong> and announce the winners! ğŸ¤ğŸ¥</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>AGENCY_NORMALIZED <span class="ot">&lt;-</span> AGENCY_NORMALIZED <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Size_Category =</span> <span class="fu">case_when</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    UPT <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">6</span> <span class="sc">~</span> <span class="st">"Small"</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    UPT <span class="sc">&gt;=</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">6</span> <span class="sc">&amp;</span> UPT <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">8</span> <span class="sc">~</span> <span class="st">"Medium"</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    UPT <span class="sc">&gt;=</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">8</span> <span class="sc">~</span> <span class="st">"Large"</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="find-the-greenest-transit-agency-by-lowest-emissions-per-upt" class="level3" data-number="2.10.1">
<h3 data-number="2.10.1" class="anchored" data-anchor-id="find-the-greenest-transit-agency-by-lowest-emissions-per-upt"><span class="header-section-number">2.10.1</span> Find the greenest transit agency by lowest emissions per UPT</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>AGENCY_NORMALIZED <span class="ot">&lt;-</span> AGENCY_NORMALIZED <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Agency =</span> Agency.x)  <span class="co"># Rename "Agency.x" to "Agency"</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>greenest_agency_UPT <span class="ot">&lt;-</span> AGENCY_NORMALIZED <span class="sc">%&gt;%</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Size_Category) <span class="sc">&amp;</span> Emissions_per_UPT <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Size_Category) <span class="sc">%&gt;%</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(Emissions_per_UPT, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Size_Category, Agency, Emissions_per_UPT)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(greenest_agency_UPT, <span class="at">caption =</span> <span class="st">"Greenest Agency By lowest Emissions Per UPT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Greenest Agency By lowest Emissions Per UPT</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Size_Category</th>
<th style="text-align: left;">Agency</th>
<th style="text-align: right;">Emissions_per_UPT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Large</td>
<td style="text-align: left;">New Jersey Transit Corporation</td>
<td style="text-align: right;">0.0024015</td>
</tr>
<tr class="even">
<td style="text-align: left;">Medium</td>
<td style="text-align: left;">King County, dba: King County Metro</td>
<td style="text-align: right;">0.0007222</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Small</td>
<td style="text-align: left;">Altoona Metro Transit, dba: AMTRAN</td>
<td style="text-align: right;">0.0056772</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="find-the-greenest-transit-agency-by-lowest-emissions-per-passenger-mile" class="level3" data-number="2.10.2">
<h3 data-number="2.10.2" class="anchored" data-anchor-id="find-the-greenest-transit-agency-by-lowest-emissions-per-passenger-mile"><span class="header-section-number">2.10.2</span> Find the greenest transit agency by lowest emissions per Passenger Mile</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>greenest_agency_mile <span class="ot">&lt;-</span> AGENCY_NORMALIZED <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Size_Category) <span class="sc">&amp;</span> Emissions_per_UPT <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Size_Category) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(Emissions_per_Passenger_Mile, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Size_Category, Agency, Emissions_per_Passenger_Mile)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(greenest_agency_mile, <span class="at">caption=</span> <span class="st">"Greenest Transit Agency By Lowest Emissions Per Passenger Mile"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Greenest Transit Agency By Lowest Emissions Per Passenger Mile</caption>
<colgroup>
<col style="width: 17%">
<col style="width: 45%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Size_Category</th>
<th style="text-align: left;">Agency</th>
<th style="text-align: right;">Emissions_per_Passenger_Mile</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Large</td>
<td style="text-align: left;">New Jersey Transit Corporation</td>
<td style="text-align: right;">0.0002061</td>
</tr>
<tr class="even">
<td style="text-align: left;">Medium</td>
<td style="text-align: left;">King County, dba: King County Metro</td>
<td style="text-align: right;">0.0001889</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Small</td>
<td style="text-align: left;">Altoona Metro Transit, dba: AMTRAN</td>
<td style="text-align: right;">0.0015636</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="total-emissions-avoided-gta-iv-award-2" class="level2" data-number="2.11">
<h2 data-number="2.11" class="anchored" data-anchor-id="total-emissions-avoided-gta-iv-award-2"><span class="header-section-number">2.11</span> <strong>Total Emissions Avoided (GTA IV Award #2) ğŸŒ±ğŸš†</strong></h2>
<p>Now, letâ€™s compute the <strong>total emissions avoided</strong> by public transit. Because without it, weâ€™d have <strong>millions of solo drivers</strong> making traffic even worse than it already is! ğŸ˜±ğŸš—ğŸš•ğŸš™</p>
<p>How do we do this?<br>
1ï¸âƒ£ <strong>Estimate emissions if all transit passengers drove cars instead.</strong><br>
2ï¸âƒ£ <strong>Use US CAFE fuel standards to convert miles to gasoline usage.</strong><br>
3ï¸âƒ£ <strong>Calculate emissions avoided by taking public transit instead of driving.</strong></p>
<p><strong>Used average CAFE standard of 24.7 mpg and CO2 emissions of 8.89 kg per gallon</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>AGENCY_NORMALIZED <span class="ot">&lt;-</span> AGENCY_NORMALIZED <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Gallons_of_fuel =</span> MILES <span class="sc">/</span> <span class="fl">24.7</span>,  <span class="co"># Convert miles to fuel gallons</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Emissions_from_driving =</span> Gallons_of_fuel <span class="sc">*</span> <span class="fl">8.89</span>,  <span class="co"># Convert gallons to CO2</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Emissions_avoided =</span> Emissions_from_driving <span class="sc">-</span> Total_Emissions  <span class="co"># Calculate CO2 saved</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="find-agency-with-most-emissions-avoided" class="level3" data-number="2.11.1">
<h3 data-number="2.11.1" class="anchored" data-anchor-id="find-agency-with-most-emissions-avoided"><span class="header-section-number">2.11.1</span> Find agency with most emissions avoided ğŸ†</h3>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>most_emissions_avoided_by_size <span class="ot">&lt;-</span> AGENCY_NORMALIZED <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Size_Category)) <span class="sc">%&gt;%</span>  <span class="co"># Ensure valid categories</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Size_Category) <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(Emissions_avoided, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Size_Category, Agency, Emissions_avoided)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(most_emissions_avoided_by_size, <span class="at">caption =</span> <span class="st">"Most Emissions Avoided"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Most Emissions Avoided</caption>
<colgroup>
<col style="width: 13%">
<col style="width: 68%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Size_Category</th>
<th style="text-align: left;">Agency</th>
<th style="text-align: right;">Emissions_avoided</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Large</td>
<td style="text-align: left;">MTA New York City Transit</td>
<td style="text-align: right;">3441010874</td>
</tr>
<tr class="even">
<td style="text-align: left;">Medium</td>
<td style="text-align: left;">Metro-North Commuter Railroad Company, dba: MTA Metro-North Railroad</td>
<td style="text-align: right;">413801729</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Small</td>
<td style="text-align: left;">Hampton Jitney, Inc.</td>
<td style="text-align: right;">13333018</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This agency has officially <strong>saved the planet</strong> more than your coworker with the reusable straw. ğŸŒ±ğŸ’šâ™»ï¸</p>
</section>
<section id="most-improved-green-agency-gta-iv-award-3" class="level3" data-number="2.11.2">
<h3 data-number="2.11.2" class="anchored" data-anchor-id="most-improved-green-agency-gta-iv-award-3"><span class="header-section-number">2.11.2</span> ğŸ†Most Improved Green Agency <strong>(GTA IV Award #3) ğŸš†</strong> ğŸ†</h3>
<p>This award recognizes the transit agency that has demonstrated the most significant improvement in environmental efficiency compared to its peers. Instead of using past-year data (which may not always be available), this award is given to the agency that has the largest improvement relative to the median emissions per passenger mile in its category (Large, Medium, or Small).</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>most_improved_agency <span class="ot">&lt;-</span> AGENCY_NORMALIZED <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Emissions_per_Passenger_Mile) <span class="sc">&amp;</span> Emissions_per_Passenger_Mile <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Size_Category) <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">median_emissions =</span> <span class="fu">median</span>(Emissions_per_Passenger_Mile, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">emissions_improvement =</span> median_emissions <span class="sc">-</span> Emissions_per_Passenger_Mile) <span class="sc">%&gt;%</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> emissions_improvement, <span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span>  <span class="co"># Select top in each category</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Agency, Size_Category, Emissions_per_Passenger_Mile, median_emissions, emissions_improvement)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(most_improved_agency, <span class="at">caption =</span> <span class="st">"Most Improved Agency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Most Improved Agency</caption>
<colgroup>
<col style="width: 30%">
<col style="width: 11%">
<col style="width: 24%">
<col style="width: 14%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Agency</th>
<th style="text-align: left;">Size_Category</th>
<th style="text-align: right;">Emissions_per_Passenger_Mile</th>
<th style="text-align: right;">median_emissions</th>
<th style="text-align: right;">emissions_improvement</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">New Jersey Transit Corporation</td>
<td style="text-align: left;">Large</td>
<td style="text-align: right;">0.0002061</td>
<td style="text-align: right;">0.1260740</td>
<td style="text-align: right;">0.1258680</td>
</tr>
<tr class="even">
<td style="text-align: left;">King County, dba: King County Metro</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">0.0001889</td>
<td style="text-align: right;">0.2200267</td>
<td style="text-align: right;">0.2198378</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Altoona Metro Transit, dba: AMTRAN</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">0.0015636</td>
<td style="text-align: right;">0.3648839</td>
<td style="text-align: right;">0.3633203</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="biggest-gas-guzzler-gta-iv-award-4" class="level3" data-number="2.11.3">
<h3 data-number="2.11.3" class="anchored" data-anchor-id="biggest-gas-guzzler-gta-iv-award-4"><span class="header-section-number">2.11.3</span> ğŸ’€Biggest Gas Guzzlerâ›½ <strong>(GTA IV Award #4) ğŸŒ±ğŸš†</strong></h3>
<p>This award highlights the least fuel-efficient transit agencies in each size category (Large, Medium, Small). The â€œBiggest Gas Guzzlerâ€ is the agency with the highest Emissions per Passenger Mile, indicating it produces the most pollution per mile traveled by a passenger. This award serves as a benchmark for identifying areas where fuel efficiency improvements and sustainability measures are most needed.</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>biggest_gas_guzzler_by_size <span class="ot">&lt;-</span> AGENCY_NORMALIZED <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Size_Category)) <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Size_Category) <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(Emissions_per_Passenger_Mile, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Size_Category, Agency, Emissions_per_Passenger_Mile)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(biggest_gas_guzzler_by_size, <span class="at">caption =</span><span class="st">"Biggest Gas Guzzler"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Biggest Gas Guzzler</caption>
<colgroup>
<col style="width: 14%">
<col style="width: 55%">
<col style="width: 29%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Size_Category</th>
<th style="text-align: left;">Agency</th>
<th style="text-align: right;">Emissions_per_Passenger_Mile</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Large</td>
<td style="text-align: left;">Chicago Transit Authority</td>
<td style="text-align: right;">162.6084</td>
</tr>
<tr class="even">
<td style="text-align: left;">Medium</td>
<td style="text-align: left;">West Virginia University, dba: Personal Rapid Transit</td>
<td style="text-align: right;">645.1318</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Small</td>
<td style="text-align: left;">Pennsylvania Department of Transportation</td>
<td style="text-align: right;">273.8586</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="visualizations" class="level2" data-number="2.12">
<h2 data-number="2.12" class="anchored" data-anchor-id="visualizations"><span class="header-section-number">2.12</span> ğŸ“ˆ Visualizations ğŸ¨</h2>
<section id="greenest-transit-agency---a-breath-of-fresh-air" class="level4" data-number="2.12.0.1">
<h4 data-number="2.12.0.1" class="anchored" data-anchor-id="greenest-transit-agency---a-breath-of-fresh-air"><span class="header-section-number">2.12.0.1</span> ğŸš Greenest Transit Agency - A Breath of Fresh Air! ğŸŒ</h4>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>greenest_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Agency =</span> <span class="fu">c</span>(<span class="st">"New Jersey Transit Corporation"</span>, <span class="st">"King County, dba: King County Metro"</span>, <span class="st">"Altoona Metro Transit, dba: AMTRAN"</span>),</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Size_Category =</span> <span class="fu">c</span>(<span class="st">"Large"</span>, <span class="st">"Medium"</span>, <span class="st">"Small"</span>),</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Emissions_per_UPT =</span> <span class="fu">c</span>(<span class="fl">0.0024014936</span>, <span class="fl">0.0007222026</span>, <span class="fl">0.0056772412</span>),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Emissions_per_Passenger_Mile =</span> <span class="fu">c</span>(<span class="fl">0.0002060647</span>, <span class="fl">0.0001889437</span>, <span class="fl">0.0015635784</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(Emissions_per_UPT, Emissions_per_Passenger_Mile), </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">names_to =</span> <span class="st">"Metric"</span>, <span class="at">values_to =</span> <span class="st">"Emissions"</span>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjusting graph to make sure bars are visible</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(greenest_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Agency, Emissions), <span class="at">y =</span> Emissions, <span class="at">fill =</span> Metric)) <span class="sc">+</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span>  <span class="co"># Increased bar width</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Size_Category), <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.7</span>), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span>  <span class="co"># Increased text size</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Greenest Transit Agency"</span>, <span class="at">y =</span> <span class="st">"Emissions (kg COâ‚‚)"</span>, <span class="at">fill =</span> <span class="st">"Metric"</span>) <span class="sc">+</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(greenest_data<span class="sc">$</span>Emissions) <span class="sc">+</span> <span class="fl">0.002</span>)) <span class="sc">+</span>  <span class="co"># Adjust y-axis to ensure bars are visible</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="MP02_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Talk about making a clean getaway! The MTA Bus Company and its smaller counterparts are taking the â€œgreenâ€ route. Weâ€™re not just talking about eco-friendly buses, but real reductions in emissions. A round of applause for the greenest of them all!</p>
</section>
<section id="most-emissions-avoided---the-green-warriors" class="level4" data-number="2.12.0.2">
<h4 data-number="2.12.0.2" class="anchored" data-anchor-id="most-emissions-avoided---the-green-warriors"><span class="header-section-number">2.12.0.2</span> ğŸŒ± Most Emissions Avoided - The Green Warriors ğŸ’¨</h4>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the emissions data</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>emissions_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Agency =</span> <span class="fu">c</span>(<span class="st">"MTA New York City Transit"</span>, <span class="st">"Metro-North Commuter Railroad Company"</span>, <span class="st">"Hampton Jitney, Inc."</span>),</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Emissions_Avoided =</span> <span class="fu">c</span>(<span class="dv">3441010874</span>, <span class="dv">413801729</span>, <span class="dv">13333018</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(emissions_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Agency, Emissions_Avoided), <span class="at">y =</span> Emissions_Avoided, <span class="at">fill =</span> Agency)) <span class="sc">+</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Most Emissions Avoided"</span>, <span class="at">y =</span> <span class="st">"COâ‚‚ Avoided (kg)"</span>, <span class="at">x =</span> <span class="st">"Agency"</span>) <span class="sc">+</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span>  <span class="co"># Apply logarithmic scale to the y-axis</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">comma</span>(Emissions_Avoided)), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">2</span>)  <span class="co"># Adjust text positioning and size</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="MP02_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>These agencies are saving the planet one ride at a time! Hudson Transit Lines and its pals are on a mission to leave the world with fewer emissions. Theyâ€™re all about that â€œlow-carbon footprintâ€ lifestyle!</p>
</section>
<section id="most-improved-green-agency---turning-green-around" class="level4" data-number="2.12.0.3">
<h4 data-number="2.12.0.3" class="anchored" data-anchor-id="most-improved-green-agency---turning-green-around"><span class="header-section-number">2.12.0.3</span> ğŸš€ Most Improved Green Agency - Turning Green Around! ğŸŒ¿</h4>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Most Improved Green Agency (Dumbbell Chart)</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggalt)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>improved_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Agency =</span> <span class="fu">c</span>(<span class="st">"MTA Bus Company"</span>, <span class="st">"Champaign-Urbana Mass Transit"</span>, <span class="st">"City of Decatur Transit"</span>),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Before =</span> <span class="fu">c</span>(<span class="fl">0.1260740</span>,<span class="fl">0.2200267</span>, <span class="fl">0.3648839</span>),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">After =</span> <span class="fu">c</span>(<span class="fl">0.0002060647</span>,<span class="fl">0.0001889437</span>, <span class="fl">0.0015635784</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(improved_data, <span class="fu">aes</span>(<span class="at">y =</span> Agency, <span class="at">x =</span> Before, <span class="at">xend =</span> After)) <span class="sc">+</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dumbbell</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">dot_guide =</span> <span class="cn">TRUE</span>, <span class="at">dot_guide_size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Most Improved Green Agency"</span>, <span class="at">x =</span> <span class="st">"Emissions per Mile (kg COâ‚‚)"</span>, <span class="at">y =</span> <span class="st">"Agency"</span>) <span class="sc">+</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="MP02_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>These agencies took the emissions â€œdownshiftâ€ seriously! The MTA Bus Company may have started off with high emissions, but itâ€™s now a model of green efficiency. Talk about a green makeover!</p>
</section>
<section id="biggest-gas-guzzler---oops-its-guzzling-more-than-gas" class="level4" data-number="2.12.0.4">
<h4 data-number="2.12.0.4" class="anchored" data-anchor-id="biggest-gas-guzzler---oops-its-guzzling-more-than-gas"><span class="header-section-number">2.12.0.4</span> ğŸ›¢ï¸ Biggest Gas Guzzler - Oops, Itâ€™s Guzzling More than Gas! ğŸƒ</h4>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>guzzler_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Agency =</span> <span class="fu">c</span>(<span class="st">"Chicago Transit Authority"</span>, <span class="st">"WVU Personal Rapid Transit"</span>, <span class="st">"Pennsylvania DOT"</span>),</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Emissions =</span> <span class="fu">c</span>(<span class="fl">162.6084</span>, <span class="fl">645.1</span>, <span class="fl">273.9</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(guzzler_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Agency, <span class="sc">-</span>Emissions), <span class="at">y =</span> Emissions, <span class="at">fill =</span> Emissions)) <span class="sc">+</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"yellow"</span>, <span class="at">high =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Biggest Gas Guzzler"</span>, <span class="at">y =</span> <span class="st">"Emissions per Mile (kg COâ‚‚)"</span>, <span class="at">x =</span> <span class="st">"Agency"</span>) <span class="sc">+</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="MP02_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Some agencies need to take a carbon diet! Looks like WVU Personal Rapid Transit took the term â€œgas guzzlerâ€ to the extreme. Maybe they should swap out those heavy engines for some electric vibes.</p>
<hr>
</section>
</section>
<section id="conclusion" class="level2" data-number="2.13">
<h2 data-number="2.13" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">2.13</span> ğŸ“¢ Conclusion</h2>
<p>ğŸš† Public transit plays a <em>huge</em> role in reducing emissions! Our analysis highlights the best (and worst) performers. Keep supporting clean transit choices! ğŸŒğŸ’š</p>
<hr>
</section>
<section id="references" class="level2" data-number="2.14">
<h2 data-number="2.14" class="anchored" data-anchor-id="references"><span class="header-section-number">2.14</span> ğŸ“š References</h2>
<ul>
<li>National Transit Database (NTD)</li>
<li>Energy Information Administration (EIA)</li>
<li>Environmental Protection Agency (EPA)</li>
</ul>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb38" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "ğŸ† The GTA IV Green Transit Awards 2025 ğŸ†"</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Shubh Goyal"</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> today</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Show Code"</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="co">    doctype: html</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="an">engine:</span><span class="co"> knitr </span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true  # Show code</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co">  eval: true  # Ensure code runs</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="an">markdown:</span><span class="co"> </span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="co">  wrap: 68</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="fu"># ğŸš The 2025 Clean Transit Awards</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>**Honoring the Green, the Lean, and the Gas-Guzzling Machines! ğŸŒ±ğŸ”¥**</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>New York, NY â€“ Public transit plays a crucial role in reducing carbon footprints, but not all agencies are created equal. Some transit systems have become champions of eco-efficiency, while othersâ€¦ well, letâ€™s just say they have room for improvement.</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>After analyzing emissions data from transit agencies nationwide, we proudly present the 2025 Clean Transit Awards, recognizing the best (and worst) in sustainable transit. These awards highlight Small, Medium, and Large agencies that have made a measurable impact on their carbon footprintâ€”or left tire marks on the environment.</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>So, without further ado, letâ€™s reveal the greenest, the most improved, and, of course, the biggest gas guzzlers!</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a><span class="fu">## ğŸ† Greenest Transit Agency â€“ The MVP (Most Valuable Pollution-Reducer) Award ğŸŒğŸ’¨</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>This prestigious award goes to the transit agencies that produce the least emissions per passenger trip and per mile traveled. In other words, these winners are basically the Tesla Model S of busesâ€”except way more affordable and accessible.</span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>**By Passenger Trips:**</span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>ğŸ¥‡**Large Agency Winner:** New Jersey Transit Corporation</span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>ğŸ¥‡**Medium Agency Winner:** King County, dba: King County Metro</span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>ğŸ¥‡**Small Agency Winner**: Small Altoona Metro Transit, dba: AMTRAN</span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>**By Passenger Mile:**</span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a>ğŸ¥‡**Large Agency Winner**:ğŸš†New Jersey Transit Corporation,</span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>ğŸ¥‡**Medium Agency Winner:** King County, dba: King County Metro**,**</span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>ğŸ¥‡**Small Agency Winner:** Small Altoona Metro Transit, dba: AMTRA**,**</span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a><span class="fu">## ğŸŒ Most Emissions Avoided â€“ The "Carbon Buster" Award ğŸš«ğŸ’¨</span></span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a>"If pollution had an arch-nemesis, it would be these guys."</span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a>Imagine a world where all transit riders suddenly switched to single-passenger cars. ğŸš—ğŸš—ğŸš— Yikes! The traffic jams would be longer than your uncleâ€™s conspiracy theories at Thanksgiving, and emissions would skyrocket.</span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a>This award goes to the transit agencies that saved us from the most pollution by preventing countless solo car trips.</span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a>ğŸ¥‡ **Large Agency Winner**: MTA New York City Transit 3441010874 avoided</span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a>ğŸ¥‡ **Medium Agency Winner**: Metro-North Commuter Railroad Company, dba: MTA Metro-North Railroad 413801729 avoided</span>
<span id="cb38-65"><a href="#cb38-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a>ğŸ¥‡ **Small Agency Winner**: Hampton Jitney, Inc. 1333301 avoided</span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a><span class="fu">## Most Improved Green Agency â€“ The "Comeback Kid" Award ğŸ”„ğŸ’š</span></span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a>"From gas-guzzler to eco-hustler!"</span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a>This award goes to the agency that has made the biggest leap toward sustainabilityâ€”not by comparing to past-year data, but by seeing who improved the most compared to their peers.</span>
<span id="cb38-73"><a href="#cb38-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-74"><a href="#cb38-74" aria-hidden="true" tabindex="-1"></a>ğŸ¥‡ **Large Agency Winner**: New Jersey Transit Corporation Reduced from 0.1260740 to 0.0002060647 per mile</span>
<span id="cb38-75"><a href="#cb38-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-76"><a href="#cb38-76" aria-hidden="true" tabindex="-1"></a>ğŸ¥‡ **Medium Agency Winner**: King County, dba: King County Metro Reduced from 0.2200267 to 0.0001889437 per mile</span>
<span id="cb38-77"><a href="#cb38-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-78"><a href="#cb38-78" aria-hidden="true" tabindex="-1"></a>ğŸ¥‡ **Small Agency Winner**: Altoona Metro Transit, dba: AMTRAN â€“ Reduced from 0.3648839 to 0.0015635784 per mile</span>
<span id="cb38-79"><a href="#cb38-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-80"><a href="#cb38-80" aria-hidden="true" tabindex="-1"></a><span class="fu">## â›½ Biggest Gas Guzzler â€“ The "Oh No, Fix That!" AwardğŸ’€</span></span>
<span id="cb38-81"><a href="#cb38-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-82"><a href="#cb38-82" aria-hidden="true" tabindex="-1"></a>"Not all heroes wear capes... and not all transit agencies are heroes."Not every agency can be a green machine. This award "honors" those transit agencies that burn through fuel like itâ€™s going out of style, producing the highest emissions per passenger mile. (Spoiler alert: This is NOT the award you want to win.)</span>
<span id="cb38-83"><a href="#cb38-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-84"><a href="#cb38-84" aria-hidden="true" tabindex="-1"></a>ğŸ¥‡ **Large Agency Winner**: Chicago Transit Authority 162.6084 kg COâ‚‚ per mile</span>
<span id="cb38-85"><a href="#cb38-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-86"><a href="#cb38-86" aria-hidden="true" tabindex="-1"></a>ğŸ¥‡ **Medium Agency Winner**: West Virginia University, dba: Personal Rapid Transit 645.1318 kg COâ‚‚ per mile</span>
<span id="cb38-87"><a href="#cb38-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-88"><a href="#cb38-88" aria-hidden="true" tabindex="-1"></a>ğŸ¥‡ **Small Agency Winner**: Pennsylvania Department of Transportation 273.8586 COâ‚‚ per mile</span>
<span id="cb38-89"><a href="#cb38-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-90"><a href="#cb38-90" aria-hidden="true" tabindex="-1"></a>While some agencies are already champions of green transit, others have some serious catching up to do. The 2025 Clean Transit Awards highlight the best in eco-friendly transportation while also shining a spotlight on areas that need improvement. ğŸš† The takeaway? Cities that invest in sustainable transit are making a real impact on emissions. Meanwhile, gas guzzlers (weâ€™re looking at you, WVU!) still have some work to do. For a full breakdown of the data, check out the Appendix in our official report. Spoiler alert: numbers donâ€™t lie, and neither do emissions reductions!</span>
<span id="cb38-91"><a href="#cb38-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-92"><a href="#cb38-92" aria-hidden="true" tabindex="-1"></a><span class="fu"># APPENDIX - METHODOLOGY AND ANALYSIS</span></span>
<span id="cb38-93"><a href="#cb38-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-94"><a href="#cb38-94" aria-hidden="true" tabindex="-1"></a><span class="fu">## ğŸ“Š Data Import</span></span>
<span id="cb38-95"><a href="#cb38-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-96"><a href="#cb38-96" aria-hidden="true" tabindex="-1"></a>We started by acquiring data from EIA State Electricity Profiles, which we will use to estimate the environmental impact of the electricity used to run certain transit systems. ğŸš—</span>
<span id="cb38-97"><a href="#cb38-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-98"><a href="#cb38-98" aria-hidden="true" tabindex="-1"></a><span class="fu">#### State Electricity Profiles ğŸ›ï¸</span></span>
<span id="cb38-99"><a href="#cb38-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-100"><a href="#cb38-100" aria-hidden="true" tabindex="-1"></a>For purposes of this analysis, we will assume that all electricity generation in a state is fungible. That is, we will assign the average generation emissions to all-electric transit in a state, even if the transit authority officially has a â€œgreen supplyâ€ agreement in place.</span>
<span id="cb38-101"><a href="#cb38-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-104"><a href="#cb38-104" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-105"><a href="#cb38-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb38-106"><a href="#cb38-106" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb38-107"><a href="#cb38-107" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb38-108"><a href="#cb38-108" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb38-109"><a href="#cb38-109" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb38-110"><a href="#cb38-110" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb38-111"><a href="#cb38-111" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb38-112"><a href="#cb38-112" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr) <span class="co"># Needed for str_replace_all()</span></span>
<span id="cb38-113"><a href="#cb38-113" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr) <span class="co"># Needed for map2()</span></span>
<span id="cb38-114"><a href="#cb38-114" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quarto) <span class="co"># Ensures Quarto execution works</span></span>
<span id="cb38-115"><a href="#cb38-115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-116"><a href="#cb38-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-119"><a href="#cb38-119" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-120"><a href="#cb38-120" aria-hidden="true" tabindex="-1"></a><span class="co"># Load libraries</span></span>
<span id="cb38-121"><a href="#cb38-121" aria-hidden="true" tabindex="-1"></a>ensure_package <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg){</span>
<span id="cb38-122"><a href="#cb38-122" aria-hidden="true" tabindex="-1"></a>    pkg <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(pkg))</span>
<span id="cb38-123"><a href="#cb38-123" aria-hidden="true" tabindex="-1"></a>    <span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>))</span>
<span id="cb38-124"><a href="#cb38-124" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>)) <span class="fu">install.packages</span>(pkg)</span>
<span id="cb38-125"><a href="#cb38-125" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>))</span>
<span id="cb38-126"><a href="#cb38-126" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-127"><a href="#cb38-127" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(stringr)  <span class="co"># Ensure it's installed</span></span>
<span id="cb38-128"><a href="#cb38-128" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(dplyr)</span>
<span id="cb38-129"><a href="#cb38-129" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(httr2)</span>
<span id="cb38-130"><a href="#cb38-130" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(rvest)</span>
<span id="cb38-131"><a href="#cb38-131" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(datasets)</span>
<span id="cb38-132"><a href="#cb38-132" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(purrr)</span>
<span id="cb38-133"><a href="#cb38-133" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(DT)</span>
<span id="cb38-134"><a href="#cb38-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-135"><a href="#cb38-135" aria-hidden="true" tabindex="-1"></a>get_eia_sep <span class="ot">&lt;-</span> <span class="cf">function</span>(state, abbr){</span>
<span id="cb38-136"><a href="#cb38-136" aria-hidden="true" tabindex="-1"></a>    state_formatted <span class="ot">&lt;-</span> <span class="fu">str_to_lower</span>(state) <span class="sc">|&gt;</span> <span class="fu">str_replace_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>, <span class="st">""</span>)</span>
<span id="cb38-137"><a href="#cb38-137" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-138"><a href="#cb38-138" aria-hidden="true" tabindex="-1"></a>    dir_name <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>)</span>
<span id="cb38-139"><a href="#cb38-139" aria-hidden="true" tabindex="-1"></a>    file_name <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_name, state_formatted)</span>
<span id="cb38-140"><a href="#cb38-140" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-141"><a href="#cb38-141" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(dir_name, <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb38-142"><a href="#cb38-142" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-143"><a href="#cb38-143" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(file_name)){</span>
<span id="cb38-144"><a href="#cb38-144" aria-hidden="true" tabindex="-1"></a>        BASE_URL <span class="ot">&lt;-</span> <span class="st">"https://www.eia.gov"</span></span>
<span id="cb38-145"><a href="#cb38-145" aria-hidden="true" tabindex="-1"></a>        REQUEST <span class="ot">&lt;-</span> <span class="fu">request</span>(BASE_URL) <span class="sc">|&gt;</span> </span>
<span id="cb38-146"><a href="#cb38-146" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_url_path</span>(<span class="st">"electricity"</span>, <span class="st">"state"</span>, state_formatted)</span>
<span id="cb38-147"><a href="#cb38-147" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-148"><a href="#cb38-148" aria-hidden="true" tabindex="-1"></a>        RESPONSE <span class="ot">&lt;-</span> <span class="fu">req_perform</span>(REQUEST)</span>
<span id="cb38-149"><a href="#cb38-149" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-150"><a href="#cb38-150" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resp_check_status</span>(RESPONSE)</span>
<span id="cb38-151"><a href="#cb38-151" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb38-152"><a href="#cb38-152" aria-hidden="true" tabindex="-1"></a>        <span class="fu">writeLines</span>(<span class="fu">resp_body_string</span>(RESPONSE), file_name)</span>
<span id="cb38-153"><a href="#cb38-153" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-154"><a href="#cb38-154" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-155"><a href="#cb38-155" aria-hidden="true" tabindex="-1"></a>    TABLE <span class="ot">&lt;-</span> <span class="fu">read_html</span>(file_name) <span class="sc">|&gt;</span> </span>
<span id="cb38-156"><a href="#cb38-156" aria-hidden="true" tabindex="-1"></a>        <span class="fu">html_element</span>(<span class="st">"table"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-157"><a href="#cb38-157" aria-hidden="true" tabindex="-1"></a>        <span class="fu">html_table</span>() <span class="sc">|&gt;</span></span>
<span id="cb38-158"><a href="#cb38-158" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">Item =</span> <span class="fu">str_to_lower</span>(Item))</span>
<span id="cb38-159"><a href="#cb38-159" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-160"><a href="#cb38-160" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="st">"U.S. rank"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(TABLE)){</span>
<span id="cb38-161"><a href="#cb38-161" aria-hidden="true" tabindex="-1"></a>        TABLE <span class="ot">&lt;-</span> TABLE <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">Rank =</span> <span class="st">`</span><span class="at">U.S. rank</span><span class="st">`</span>)</span>
<span id="cb38-162"><a href="#cb38-162" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-163"><a href="#cb38-163" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-164"><a href="#cb38-164" aria-hidden="true" tabindex="-1"></a>    CO2_MWh <span class="ot">&lt;-</span> TABLE <span class="sc">|&gt;</span> </span>
<span id="cb38-165"><a href="#cb38-165" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(Item <span class="sc">==</span> <span class="st">"carbon dioxide (lbs/mwh)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-166"><a href="#cb38-166" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(Value) <span class="sc">|&gt;</span> </span>
<span id="cb38-167"><a href="#cb38-167" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_replace_all</span>(<span class="st">","</span>, <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-168"><a href="#cb38-168" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.numeric</span>()</span>
<span id="cb38-169"><a href="#cb38-169" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-170"><a href="#cb38-170" aria-hidden="true" tabindex="-1"></a>    PRIMARY <span class="ot">&lt;-</span> TABLE <span class="sc">|&gt;</span> </span>
<span id="cb38-171"><a href="#cb38-171" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(Item <span class="sc">==</span> <span class="st">"primary energy source"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-172"><a href="#cb38-172" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(Rank)</span>
<span id="cb38-173"><a href="#cb38-173" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-174"><a href="#cb38-174" aria-hidden="true" tabindex="-1"></a>    RATE <span class="ot">&lt;-</span> TABLE <span class="sc">|&gt;</span></span>
<span id="cb38-175"><a href="#cb38-175" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(Item <span class="sc">==</span> <span class="st">"average retail price (cents/kwh)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-176"><a href="#cb38-176" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(Value) <span class="sc">|&gt;</span></span>
<span id="cb38-177"><a href="#cb38-177" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.numeric</span>()</span>
<span id="cb38-178"><a href="#cb38-178" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-179"><a href="#cb38-179" aria-hidden="true" tabindex="-1"></a>    GENERATION_MWh <span class="ot">&lt;-</span> TABLE <span class="sc">|&gt;</span></span>
<span id="cb38-180"><a href="#cb38-180" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(Item <span class="sc">==</span> <span class="st">"net generation (megawatthours)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-181"><a href="#cb38-181" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(Value) <span class="sc">|&gt;</span></span>
<span id="cb38-182"><a href="#cb38-182" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_replace_all</span>(<span class="st">","</span>, <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-183"><a href="#cb38-183" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.numeric</span>()</span>
<span id="cb38-184"><a href="#cb38-184" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-185"><a href="#cb38-185" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">CO2_MWh               =</span> CO2_MWh, </span>
<span id="cb38-186"><a href="#cb38-186" aria-hidden="true" tabindex="-1"></a>               <span class="at">primary_source        =</span> PRIMARY,</span>
<span id="cb38-187"><a href="#cb38-187" aria-hidden="true" tabindex="-1"></a>               <span class="at">electricity_price_MWh =</span> RATE <span class="sc">*</span> <span class="dv">10</span>, <span class="co"># / 100 cents to dollars &amp;</span></span>
<span id="cb38-188"><a href="#cb38-188" aria-hidden="true" tabindex="-1"></a>               <span class="co"># * 1000 kWh to MWH </span></span>
<span id="cb38-189"><a href="#cb38-189" aria-hidden="true" tabindex="-1"></a>               <span class="at">generation_MWh        =</span> GENERATION_MWh, </span>
<span id="cb38-190"><a href="#cb38-190" aria-hidden="true" tabindex="-1"></a>               <span class="at">state                 =</span> state, </span>
<span id="cb38-191"><a href="#cb38-191" aria-hidden="true" tabindex="-1"></a>               <span class="at">abbreviation          =</span> abbr</span>
<span id="cb38-192"><a href="#cb38-192" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-193"><a href="#cb38-193" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-194"><a href="#cb38-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-195"><a href="#cb38-195" aria-hidden="true" tabindex="-1"></a>EIA_SEP_REPORT <span class="ot">&lt;-</span> <span class="fu">map2</span>(state.name, state.abb, get_eia_sep) <span class="sc">|&gt;</span> <span class="fu">list_rbind</span>()</span>
<span id="cb38-196"><a href="#cb38-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-197"><a href="#cb38-197" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(scales)</span>
<span id="cb38-198"><a href="#cb38-198" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(DT)</span>
<span id="cb38-199"><a href="#cb38-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-200"><a href="#cb38-200" aria-hidden="true" tabindex="-1"></a>EIA_SEP_REPORT <span class="sc">|&gt;</span> </span>
<span id="cb38-201"><a href="#cb38-201" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>abbreviation) <span class="sc">|&gt;</span></span>
<span id="cb38-202"><a href="#cb38-202" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(CO2_MWh)) <span class="sc">|&gt;</span></span>
<span id="cb38-203"><a href="#cb38-203" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">CO2_MWh =</span> scales<span class="sc">::</span><span class="fu">number</span>(CO2_MWh, <span class="at">big.mark=</span><span class="st">","</span>), </span>
<span id="cb38-204"><a href="#cb38-204" aria-hidden="true" tabindex="-1"></a>           <span class="at">electricity_price_MWh =</span> scales<span class="sc">::</span><span class="fu">dollar</span>(electricity_price_MWh), </span>
<span id="cb38-205"><a href="#cb38-205" aria-hidden="true" tabindex="-1"></a>           <span class="at">generation_MWh =</span> scales<span class="sc">::</span><span class="fu">number</span>(generation_MWh, <span class="at">big.mark=</span><span class="st">","</span>)) <span class="sc">|&gt;</span></span>
<span id="cb38-206"><a href="#cb38-206" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">`</span><span class="at">Pounds of CO2 Emitted per MWh of Electricity Produced</span><span class="st">`</span><span class="ot">=</span>CO2_MWh, </span>
<span id="cb38-207"><a href="#cb38-207" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Primary Source of Electricity Generation</span><span class="st">`</span><span class="ot">=</span>primary_source, </span>
<span id="cb38-208"><a href="#cb38-208" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Average Retail Price for 1000 kWh</span><span class="st">`</span><span class="ot">=</span>electricity_price_MWh, </span>
<span id="cb38-209"><a href="#cb38-209" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Total Generation Capacity (MWh)</span><span class="st">`</span><span class="ot">=</span> generation_MWh, </span>
<span id="cb38-210"><a href="#cb38-210" aria-hidden="true" tabindex="-1"></a>           <span class="at">State=</span>state) <span class="sc">|&gt;</span></span>
<span id="cb38-211"><a href="#cb38-211" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"EIA State Electricity Profile Report"</span>)</span>
<span id="cb38-212"><a href="#cb38-212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-213"><a href="#cb38-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-214"><a href="#cb38-214" aria-hidden="true" tabindex="-1"></a>ğŸŒ Here, we have collected the effective emissions per MWh2âš¡ as well as price and total state-wide generation capacity. We will use this data to compare the emissions of different transit modalities. We next turn to the National Transit Database to get information on various public transit authorities. Before we do so, however, letâ€™s explore the SEP data a bit first.ğŸ”¬ğŸ“‰</span>
<span id="cb38-215"><a href="#cb38-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-216"><a href="#cb38-216" aria-hidden="true" tabindex="-1"></a><span class="fu">## ğŸ” Initial Analysis of SEP Data âš–ï¸</span></span>
<span id="cb38-217"><a href="#cb38-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-218"><a href="#cb38-218" aria-hidden="true" tabindex="-1"></a>Letâ€™s answer some burning (fossil-free, we hope!) questions: ğŸš‡</span>
<span id="cb38-219"><a href="#cb38-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-220"><a href="#cb38-220" aria-hidden="true" tabindex="-1"></a><span class="fu">### 1. Which state has the most expensive retail electricity? ğŸ’°âš¡</span></span>
<span id="cb38-221"><a href="#cb38-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-222"><a href="#cb38-222" aria-hidden="true" tabindex="-1"></a>Which state will make you cry when you get your electricity bill? ğŸ˜­ Let's find out!</span>
<span id="cb38-223"><a href="#cb38-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-226"><a href="#cb38-226" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-227"><a href="#cb38-227" aria-hidden="true" tabindex="-1"></a>EIA_SEP_REPORT <span class="sc">|&gt;</span> </span>
<span id="cb38-228"><a href="#cb38-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(electricity_price_MWh)) <span class="sc">|&gt;</span> </span>
<span id="cb38-229"><a href="#cb38-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, electricity_price_MWh) <span class="sc">|&gt;</span> </span>
<span id="cb38-230"><a href="#cb38-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-231"><a href="#cb38-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Most Expensive Retail Electricity"</span>)</span>
<span id="cb38-232"><a href="#cb38-232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-233"><a href="#cb38-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-234"><a href="#cb38-234" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2. Which state has the â€˜dirtiestâ€™ electricity mix? â˜ ï¸ğŸŒ«ï¸</span></span>
<span id="cb38-235"><a href="#cb38-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-236"><a href="#cb38-236" aria-hidden="true" tabindex="-1"></a>Which stateâ€™s power plants are puffing out COâ‚‚ like an angry dragon? ğŸ‰ğŸ”¥ Stay tuned for some shocking revelations!</span>
<span id="cb38-237"><a href="#cb38-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-240"><a href="#cb38-240" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-241"><a href="#cb38-241" aria-hidden="true" tabindex="-1"></a>EIA_SEP_REPORT <span class="sc">|&gt;</span> </span>
<span id="cb38-242"><a href="#cb38-242" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(CO2_MWh)) <span class="sc">|&gt;</span> </span>
<span id="cb38-243"><a href="#cb38-243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, CO2_MWh) <span class="sc">|&gt;</span> </span>
<span id="cb38-244"><a href="#cb38-244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-245"><a href="#cb38-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Dirtiest electricity mix"</span>)</span>
<span id="cb38-246"><a href="#cb38-246" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-247"><a href="#cb38-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-248"><a href="#cb38-248" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3. On average, how many pounds of CO2 are emitted per MWh of electricity produced in the US?ğŸ­</span></span>
<span id="cb38-249"><a href="#cb38-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-250"><a href="#cb38-250" aria-hidden="true" tabindex="-1"></a>Time for some serious math! ğŸ“Š Weâ€™ll calculate the national average COâ‚‚ emissions per MWh using a **weighted average** because we like our stats accurate.ğŸ¯</span>
<span id="cb38-251"><a href="#cb38-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-254"><a href="#cb38-254" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-255"><a href="#cb38-255" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate weighted average CO2 emissions</span></span>
<span id="cb38-256"><a href="#cb38-256" aria-hidden="true" tabindex="-1"></a>weighted_avg_CO2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(EIA_SEP_REPORT<span class="sc">$</span>CO2_MWh <span class="sc">*</span> EIA_SEP_REPORT<span class="sc">$</span>generation_MWh) <span class="sc">/</span> </span>
<span id="cb38-257"><a href="#cb38-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(EIA_SEP_REPORT<span class="sc">$</span>generation_MWh)</span>
<span id="cb38-258"><a href="#cb38-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-259"><a href="#cb38-259" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">Weighted_Avg_CO2 =</span> weighted_avg_CO2) <span class="sc">|&gt;</span> </span>
<span id="cb38-260"><a href="#cb38-260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Weighted Average CO2 Emissions (lbs/MWh)"</span>),</span>
<span id="cb38-261"><a href="#cb38-261" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">"Weighted Average CO2 Emissions Across All States"</span>)</span>
<span id="cb38-262"><a href="#cb38-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-263"><a href="#cb38-263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-264"><a href="#cb38-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-265"><a href="#cb38-265" aria-hidden="true" tabindex="-1"></a><span class="fu">### 4. ğŸ¦„ What is the rarest primary energy source in the US? What is the associated cost of electricity and where is it used?ğŸ§</span></span>
<span id="cb38-266"><a href="#cb38-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-267"><a href="#cb38-267" aria-hidden="true" tabindex="-1"></a>Whatâ€™s the mythical unicorn of US energy sources? ğŸ¦„âœ¨ And where is it hiding? Letâ€™s track it down and see how much it costs! ğŸ’¸</span>
<span id="cb38-268"><a href="#cb38-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-271"><a href="#cb38-271" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-272"><a href="#cb38-272" aria-hidden="true" tabindex="-1"></a>EIA_SEP_REPORT <span class="sc">|&gt;</span> </span>
<span id="cb38-273"><a href="#cb38-273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(primary_source) <span class="sc">|&gt;</span> </span>
<span id="cb38-274"><a href="#cb38-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(n) <span class="sc">|&gt;</span> </span>
<span id="cb38-275"><a href="#cb38-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-276"><a href="#cb38-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(EIA_SEP_REPORT, <span class="at">by =</span> <span class="st">"primary_source"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-277"><a href="#cb38-277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, primary_source, electricity_price_MWh) <span class="sc">|&gt;</span> </span>
<span id="cb38-278"><a href="#cb38-278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Primary Energy Source with Lowest Occurrence"</span>)</span>
<span id="cb38-279"><a href="#cb38-279" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-280"><a href="#cb38-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-281"><a href="#cb38-281" aria-hidden="true" tabindex="-1"></a><span class="fu">### 5. My home state, Texas, has a reputation as being the home of â€œdirty fossil fuelsâ€ while NY has a reputation as a leader in clean energy. How many times cleaner is NYâ€™s energy mix than that of Texas?ğŸŒ±ğŸ”¥</span></span>
<span id="cb38-282"><a href="#cb38-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-283"><a href="#cb38-283" aria-hidden="true" tabindex="-1"></a>Is Texas really the king of fossil fuels? ğŸ‘‘ And does New York truly deserve its green halo? ğŸ˜‡ Letâ€™s compare their energy mixes and see **how many times cleaner NY is compared to TX**! ğŸ“Šâš–ï¸</span>
<span id="cb38-284"><a href="#cb38-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-287"><a href="#cb38-287" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-288"><a href="#cb38-288" aria-hidden="true" tabindex="-1"></a>NY_CO2 <span class="ot">&lt;-</span> EIA_SEP_REPORT <span class="sc">|&gt;</span> <span class="fu">filter</span>(state <span class="sc">==</span> <span class="st">"New York"</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(CO2_MWh)</span>
<span id="cb38-289"><a href="#cb38-289" aria-hidden="true" tabindex="-1"></a>TX_CO2 <span class="ot">&lt;-</span> EIA_SEP_REPORT <span class="sc">|&gt;</span> <span class="fu">filter</span>(state <span class="sc">==</span> <span class="st">"Texas"</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(CO2_MWh)</span>
<span id="cb38-290"><a href="#cb38-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-291"><a href="#cb38-291" aria-hidden="true" tabindex="-1"></a>cleaner_ratio <span class="ot">&lt;-</span> TX_CO2 <span class="sc">/</span> NY_CO2</span>
<span id="cb38-292"><a href="#cb38-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-293"><a href="#cb38-293" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">Metric =</span> <span class="st">"Cleaner Ratio (TX to NY)"</span>, <span class="at">Value =</span> cleaner_ratio) <span class="sc">|&gt;</span> </span>
<span id="cb38-294"><a href="#cb38-294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Texas vs. New York CO2 Emissions Ratio"</span>)</span>
<span id="cb38-295"><a href="#cb38-295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-296"><a href="#cb38-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-297"><a href="#cb38-297" aria-hidden="true" tabindex="-1"></a>Fun fact: New Yorkâ€™s energy mix is cleaner than Texasâ€™s by a factor of **1.637931**. Thatâ€™s right, the Lone Star State might want to take notes from the Big Apple! ğŸâš¡</span>
<span id="cb38-298"><a href="#cb38-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-299"><a href="#cb38-299" aria-hidden="true" tabindex="-1"></a><span class="fu">## Importing 2023 Annual Database Energy Consumption Report âš¡ğŸ“Š</span></span>
<span id="cb38-300"><a href="#cb38-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-301"><a href="#cb38-301" aria-hidden="true" tabindex="-1"></a>To analyze the energy consumption data for public transit agencies, we first need to import the **2023 Annual Database Energy Consumption** report. This Dataset is provided in an **Excel spreadsheet (.xlsx)** format. We will use the readxl package in R to load it.</span>
<span id="cb38-302"><a href="#cb38-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-305"><a href="#cb38-305" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-306"><a href="#cb38-306" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(readxl)</span>
<span id="cb38-307"><a href="#cb38-307" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 'data/mp02' directory if not already present</span></span>
<span id="cb38-308"><a href="#cb38-308" aria-hidden="true" tabindex="-1"></a>DATA_DIR <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>)</span>
<span id="cb38-309"><a href="#cb38-309" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(DATA_DIR, <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb38-310"><a href="#cb38-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-311"><a href="#cb38-311" aria-hidden="true" tabindex="-1"></a>NTD_ENERGY_FILE <span class="ot">&lt;-</span> <span class="fu">file.path</span>(DATA_DIR, <span class="st">"2023_ntd_energy.xlsx"</span>)</span>
<span id="cb38-312"><a href="#cb38-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-313"><a href="#cb38-313" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(NTD_ENERGY_FILE)){</span>
<span id="cb38-314"><a href="#cb38-314" aria-hidden="true" tabindex="-1"></a>    DS <span class="ot">&lt;-</span> <span class="fu">download.file</span>(<span class="st">"https://www.transit.dot.gov/sites/fta.dot.gov/files/2024-10/2023%20Energy%20Consumption.xlsx"</span>, </span>
<span id="cb38-315"><a href="#cb38-315" aria-hidden="true" tabindex="-1"></a>                  <span class="at">destfile=</span>NTD_ENERGY_FILE, </span>
<span id="cb38-316"><a href="#cb38-316" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method=</span><span class="st">"curl"</span>)</span>
<span id="cb38-317"><a href="#cb38-317" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-318"><a href="#cb38-318" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(DS <span class="sc">|</span> (<span class="fu">file.info</span>(NTD_ENERGY_FILE)<span class="sc">$</span>size <span class="sc">==</span> <span class="dv">0</span>)){</span>
<span id="cb38-319"><a href="#cb38-319" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"I was unable to download the NTD Energy File. Please try again.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb38-320"><a href="#cb38-320" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Download failed"</span>)</span>
<span id="cb38-321"><a href="#cb38-321" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-322"><a href="#cb38-322" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-323"><a href="#cb38-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-324"><a href="#cb38-324" aria-hidden="true" tabindex="-1"></a>NTD_ENERGY_RAW <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(NTD_ENERGY_FILE)</span>
<span id="cb38-325"><a href="#cb38-325" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-326"><a href="#cb38-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-329"><a href="#cb38-329" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-330"><a href="#cb38-330" aria-hidden="true" tabindex="-1"></a><span class="do">### Data Cleaning ğŸ§¹</span></span>
<span id="cb38-331"><a href="#cb38-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-332"><a href="#cb38-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-333"><a href="#cb38-333" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(tidyr)</span>
<span id="cb38-334"><a href="#cb38-334" aria-hidden="true" tabindex="-1"></a>to_numeric_fill_0 <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb38-335"><a href="#cb38-335" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">if_else</span>(x <span class="sc">==</span> <span class="st">"-"</span>, <span class="cn">NA</span>, x)</span>
<span id="cb38-336"><a href="#cb38-336" aria-hidden="true" tabindex="-1"></a>    <span class="fu">replace_na</span>(<span class="fu">as.numeric</span>(x), <span class="dv">0</span>)</span>
<span id="cb38-337"><a href="#cb38-337" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-338"><a href="#cb38-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-339"><a href="#cb38-339" aria-hidden="true" tabindex="-1"></a>NTD_ENERGY <span class="ot">&lt;-</span> NTD_ENERGY_RAW <span class="sc">|&gt;</span> </span>
<span id="cb38-340"><a href="#cb38-340" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">`</span><span class="at">Reporter Type</span><span class="st">`</span>, </span>
<span id="cb38-341"><a href="#cb38-341" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Reporting Module</span><span class="st">`</span>, </span>
<span id="cb38-342"><a href="#cb38-342" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Other Fuel</span><span class="st">`</span>, </span>
<span id="cb38-343"><a href="#cb38-343" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Other Fuel Description</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb38-344"><a href="#cb38-344" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">`</span><span class="at">Agency Name</span><span class="st">`</span>, </span>
<span id="cb38-345"><a href="#cb38-345" aria-hidden="true" tabindex="-1"></a>                     <span class="st">`</span><span class="at">Mode</span><span class="st">`</span>,</span>
<span id="cb38-346"><a href="#cb38-346" aria-hidden="true" tabindex="-1"></a>                     <span class="st">`</span><span class="at">TOS</span><span class="st">`</span>), </span>
<span id="cb38-347"><a href="#cb38-347" aria-hidden="true" tabindex="-1"></a>                  to_numeric_fill_0)) <span class="sc">|&gt;</span></span>
<span id="cb38-348"><a href="#cb38-348" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="st">`</span><span class="at">NTD ID</span><span class="st">`</span>, <span class="st">`</span><span class="at">Mode</span><span class="st">`</span>, <span class="st">`</span><span class="at">Agency Name</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-349"><a href="#cb38-349" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), sum), </span>
<span id="cb38-350"><a href="#cb38-350" aria-hidden="true" tabindex="-1"></a>              <span class="at">.groups =</span> <span class="st">"keep"</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-351"><a href="#cb38-351" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ENERGY =</span> <span class="fu">sum</span>(<span class="fu">c_across</span>(<span class="fu">c</span>(<span class="fu">where</span>(is.numeric))))) <span class="sc">|&gt;</span></span>
<span id="cb38-352"><a href="#cb38-352" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(ENERGY <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-353"><a href="#cb38-353" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>ENERGY) <span class="sc">|&gt;</span></span>
<span id="cb38-354"><a href="#cb38-354" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb38-355"><a href="#cb38-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-356"><a href="#cb38-356" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-357"><a href="#cb38-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-358"><a href="#cb38-358" aria-hidden="true" tabindex="-1"></a><span class="fu">### **ğŸ² The Wheel of Randomness! ğŸ°**</span></span>
<span id="cb38-359"><a href="#cb38-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-360"><a href="#cb38-360" aria-hidden="true" tabindex="-1"></a>**Ladies and gentlemen, it's time for the Random Transit Energy Lottery! ğŸ‰ğŸŸï¸ Weâ€™ll now select 10 lucky transit energy records at random! Who will make the cut? Who will be left behind? Let's spin the wheel! ğŸ”„âœ¨**</span>
<span id="cb38-361"><a href="#cb38-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-364"><a href="#cb38-364" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-365"><a href="#cb38-365" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample 10 random rows and then pass them to kable()</span></span>
<span id="cb38-366"><a href="#cb38-366" aria-hidden="true" tabindex="-1"></a>NTD_ENERGY <span class="sc">|&gt;</span> </span>
<span id="cb38-367"><a href="#cb38-367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-368"><a href="#cb38-368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Random Sample of NTD_ENERGY Data"</span>)</span>
<span id="cb38-369"><a href="#cb38-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-370"><a href="#cb38-370" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-371"><a href="#cb38-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-372"><a href="#cb38-372" aria-hidden="true" tabindex="-1"></a><span class="fu">## ğŸš‡ Recoding Transit Modes ğŸš‹ğŸ­</span></span>
<span id="cb38-373"><a href="#cb38-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-374"><a href="#cb38-374" aria-hidden="true" tabindex="-1"></a>ğŸš§ **Warning: Mysterious Codes Ahead!** ğŸš§</span>
<span id="cb38-375"><a href="#cb38-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-376"><a href="#cb38-376" aria-hidden="true" tabindex="-1"></a>Before we can make sense of the **Mode** column, we need to crack the code! ğŸ•µï¸â€â™‚ï¸ First, let's uncover the unique **Mode codes** in our data using <span class="in">`distinct()`</span>. Then, we consult the sacred texts (a.k.a. the NTD website ğŸ“œ) to decipher their meanings. ğŸ§</span>
<span id="cb38-377"><a href="#cb38-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-378"><a href="#cb38-378" aria-hidden="true" tabindex="-1"></a><span class="fu">### ğŸ—ï¸ Time for a Makeover! ğŸ–Œï¸</span></span>
<span id="cb38-379"><a href="#cb38-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-380"><a href="#cb38-380" aria-hidden="true" tabindex="-1"></a>The **Mode** column needs a glow-up! âœ¨ Weâ€™re about to give those cryptic abbreviations some **real names** so theyâ€™re easier to work with. Ready? Letâ€™s do this! ğŸ¬</span>
<span id="cb38-381"><a href="#cb38-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-384"><a href="#cb38-384" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-385"><a href="#cb38-385" aria-hidden="true" tabindex="-1"></a>NTD_ENERGY <span class="ot">&lt;-</span> NTD_ENERGY <span class="sc">|&gt;</span></span>
<span id="cb38-386"><a href="#cb38-386" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Mode =</span> <span class="fu">case_when</span>(</span>
<span id="cb38-387"><a href="#cb38-387" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"HR"</span>  <span class="sc">~</span> <span class="st">"Heavy Rail"</span>, </span>
<span id="cb38-388"><a href="#cb38-388" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"LR"</span>  <span class="sc">~</span> <span class="st">"Light Rail"</span>, </span>
<span id="cb38-389"><a href="#cb38-389" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"CR"</span>  <span class="sc">~</span> <span class="st">"Commuter Rail"</span>, </span>
<span id="cb38-390"><a href="#cb38-390" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"MB"</span>  <span class="sc">~</span> <span class="st">"Motor Bus"</span>, </span>
<span id="cb38-391"><a href="#cb38-391" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"TB"</span>  <span class="sc">~</span> <span class="st">"Trolleybus"</span>, </span>
<span id="cb38-392"><a href="#cb38-392" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"TR"</span>  <span class="sc">~</span> <span class="st">"Heritage Streetcar"</span>, </span>
<span id="cb38-393"><a href="#cb38-393" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"SR"</span>  <span class="sc">~</span> <span class="st">"Modern Streetcar"</span>, </span>
<span id="cb38-394"><a href="#cb38-394" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"VP"</span>  <span class="sc">~</span> <span class="st">"Vanpool"</span>, </span>
<span id="cb38-395"><a href="#cb38-395" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"DR"</span>  <span class="sc">~</span> <span class="st">"Demand Response"</span>, </span>
<span id="cb38-396"><a href="#cb38-396" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"FB"</span>  <span class="sc">~</span> <span class="st">"Ferryboat"</span>, </span>
<span id="cb38-397"><a href="#cb38-397" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"MG"</span>  <span class="sc">~</span> <span class="st">"Monorail/Automated Guideway"</span>, </span>
<span id="cb38-398"><a href="#cb38-398" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"PB"</span>  <span class="sc">~</span> <span class="st">"Publico"</span>, </span>
<span id="cb38-399"><a href="#cb38-399" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"CB"</span>  <span class="sc">~</span> <span class="st">"Commuter Bus"</span>,</span>
<span id="cb38-400"><a href="#cb38-400" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"RB"</span>  <span class="sc">~</span> <span class="st">"Rapid Bus"</span>,</span>
<span id="cb38-401"><a href="#cb38-401" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"AR"</span>  <span class="sc">~</span> <span class="st">"Aerial Tramway"</span>,</span>
<span id="cb38-402"><a href="#cb38-402" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"YR"</span>  <span class="sc">~</span> <span class="st">"Hybrid Rail"</span>,</span>
<span id="cb38-403"><a href="#cb38-403" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"IP"</span>  <span class="sc">~</span> <span class="st">"Inclined Plane Railway"</span>,</span>
<span id="cb38-404"><a href="#cb38-404" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"CC"</span>  <span class="sc">~</span> <span class="st">"Cable Car"</span>,</span>
<span id="cb38-405"><a href="#cb38-405" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span>          <span class="sc">~</span> <span class="st">"Unknown"</span></span>
<span id="cb38-406"><a href="#cb38-406" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb38-407"><a href="#cb38-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-408"><a href="#cb38-408" aria-hidden="true" tabindex="-1"></a>NTD_ENERGY <span class="sc">|&gt;</span> <span class="fu">distinct</span>(Mode) <span class="sc">|&gt;</span></span>
<span id="cb38-409"><a href="#cb38-409" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Distinct Modes of Transport"</span>)</span>
<span id="cb38-410"><a href="#cb38-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-411"><a href="#cb38-411" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-412"><a href="#cb38-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-413"><a href="#cb38-413" aria-hidden="true" tabindex="-1"></a><span class="fu">## 2023 Annual Database Service by Agency ğŸ“ŠğŸš‡</span></span>
<span id="cb38-414"><a href="#cb38-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-415"><a href="#cb38-415" aria-hidden="true" tabindex="-1"></a>ğŸš¨ **Breaking News!** ğŸš¨ The latest **2023 Service by Agency** report has just dropped! ğŸ¤ğŸ“‰ Weâ€™re diving in to extract the juicy details about passenger trips across different transit services. ğŸš†ğŸšŒ</span>
<span id="cb38-416"><a href="#cb38-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-419"><a href="#cb38-419" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-420"><a href="#cb38-420" aria-hidden="true" tabindex="-1"></a>NTD_SERVICE_FILE <span class="ot">&lt;-</span> <span class="fu">file.path</span>(DATA_DIR, <span class="st">"2023_service.csv"</span>)</span>
<span id="cb38-421"><a href="#cb38-421" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(NTD_SERVICE_FILE)){</span>
<span id="cb38-422"><a href="#cb38-422" aria-hidden="true" tabindex="-1"></a>    DS <span class="ot">&lt;-</span> <span class="fu">download.file</span>(<span class="st">"https://data.transportation.gov/resource/6y83-7vuw.csv"</span>, </span>
<span id="cb38-423"><a href="#cb38-423" aria-hidden="true" tabindex="-1"></a>                  <span class="at">destfile=</span>NTD_SERVICE_FILE, </span>
<span id="cb38-424"><a href="#cb38-424" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method=</span><span class="st">"curl"</span>)</span>
<span id="cb38-425"><a href="#cb38-425" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-426"><a href="#cb38-426" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(DS <span class="sc">|</span> (<span class="fu">file.info</span>(NTD_SERVICE_FILE)<span class="sc">$</span>size <span class="sc">==</span> <span class="dv">0</span>)){</span>
<span id="cb38-427"><a href="#cb38-427" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"I was unable to download the NTD Service File. Please try again.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb38-428"><a href="#cb38-428" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Download failed"</span>)</span>
<span id="cb38-429"><a href="#cb38-429" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-430"><a href="#cb38-430" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-431"><a href="#cb38-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-432"><a href="#cb38-432" aria-hidden="true" tabindex="-1"></a>NTD_SERVICE_RAW <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(NTD_SERVICE_FILE)</span>
<span id="cb38-433"><a href="#cb38-433" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-434"><a href="#cb38-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-435"><a href="#cb38-435" aria-hidden="true" tabindex="-1"></a>ğŸ“¢ **Will our dataset arrive safely, or will it ghost us? ğŸ‘»** Only time (and a stable internet connection) will tell! â³</span>
<span id="cb38-436"><a href="#cb38-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-437"><a href="#cb38-437" aria-hidden="true" tabindex="-1"></a><span class="fu">## Clean-Up Time! ğŸ§¹âœ¨</span></span>
<span id="cb38-438"><a href="#cb38-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-441"><a href="#cb38-441" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-442"><a href="#cb38-442" aria-hidden="true" tabindex="-1"></a>NTD_SERVICE <span class="ot">&lt;-</span> NTD_SERVICE_RAW <span class="sc">|&gt;</span></span>
<span id="cb38-443"><a href="#cb38-443" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="st">`</span><span class="at">NTD ID</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">_5_digit_ntd_id</span><span class="st">`</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb38-444"><a href="#cb38-444" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">Agency =</span> agency, </span>
<span id="cb38-445"><a href="#cb38-445" aria-hidden="true" tabindex="-1"></a>           <span class="at">City   =</span> max_city, </span>
<span id="cb38-446"><a href="#cb38-446" aria-hidden="true" tabindex="-1"></a>           <span class="at">State  =</span> max_state,</span>
<span id="cb38-447"><a href="#cb38-447" aria-hidden="true" tabindex="-1"></a>           <span class="at">UPT    =</span> sum_unlinked_passenger_trips_upt, </span>
<span id="cb38-448"><a href="#cb38-448" aria-hidden="true" tabindex="-1"></a>           <span class="at">MILES  =</span> sum_passenger_miles) <span class="sc">|&gt;</span></span>
<span id="cb38-449"><a href="#cb38-449" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"^[A-Z]"</span>, <span class="at">ignore.case=</span><span class="cn">FALSE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb38-450"><a href="#cb38-450" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(MILES <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb38-451"><a href="#cb38-451" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-452"><a href="#cb38-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-453"><a href="#cb38-453" aria-hidden="true" tabindex="-1"></a>ğŸ› ï¸ **Boom! Now our dataset is sparkling clean!** âœ¨ Itâ€™s time to put these numbers to work! ğŸ’ª</span>
<span id="cb38-454"><a href="#cb38-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-455"><a href="#cb38-455" aria-hidden="true" tabindex="-1"></a><span class="fu">## ğŸ›¥ï¸ Exploring NTD Service Data - Letâ€™s Dive In!</span></span>
<span id="cb38-456"><a href="#cb38-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-457"><a href="#cb38-457" aria-hidden="true" tabindex="-1"></a>Alright, folks! Time to put on our data analyst hats and explore some seriously juicy transit numbers from the **NTD_SERVICE** Dataset. We're going to answer some fun questions that might just reveal whoâ€™s cruising on the green lane of transit efficiency and who's still stuck in the slow lane. Letâ€™s see how this data speeds up the fun! ğŸ˜</span>
<span id="cb38-458"><a href="#cb38-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-459"><a href="#cb38-459" aria-hidden="true" tabindex="-1"></a><span class="fu">### 1. Which transit service has the most UPT annually? ğŸ†</span></span>
<span id="cb38-460"><a href="#cb38-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-461"><a href="#cb38-461" aria-hidden="true" tabindex="-1"></a>Which transit service is the busiest, with the most Unlinked Passenger Trips (UPT) annually? Spoiler alert: Itâ€™s probably not the one with the tiniest buses.ğŸšŒ</span>
<span id="cb38-462"><a href="#cb38-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-465"><a href="#cb38-465" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-466"><a href="#cb38-466" aria-hidden="true" tabindex="-1"></a>NTD_SERVICE <span class="sc">|&gt;</span></span>
<span id="cb38-467"><a href="#cb38-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(UPT)) <span class="sc">|&gt;</span></span>
<span id="cb38-468"><a href="#cb38-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(UPT)) <span class="sc">|&gt;</span></span>
<span id="cb38-469"><a href="#cb38-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Agency, UPT) <span class="sc">|&gt;</span></span>
<span id="cb38-470"><a href="#cb38-470" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-471"><a href="#cb38-471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Most UTP Annually"</span>)</span>
<span id="cb38-472"><a href="#cb38-472" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-473"><a href="#cb38-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-474"><a href="#cb38-474" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2. What is the average trip length of a trip on MTA NYC? ğŸ—½</span></span>
<span id="cb38-475"><a href="#cb38-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-476"><a href="#cb38-476" aria-hidden="true" tabindex="-1"></a>Time for some serious subway sleuthing! ğŸ•µï¸â€â™‚ï¸ How long is the average trip on the MTA NYC? Are New Yorkers making quick, subway sprints, or are they getting comfy for a longer ride? Weâ€™re on a mission to figure out just how far these trips stretch, so hop on board! ğŸš‡â³</span>
<span id="cb38-477"><a href="#cb38-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-480"><a href="#cb38-480" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-481"><a href="#cb38-481" aria-hidden="true" tabindex="-1"></a>NTD_SERVICE <span class="sc">|&gt;</span></span>
<span id="cb38-482"><a href="#cb38-482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"MTA"</span>, Agency, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb38-483"><a href="#cb38-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Average_Trip_Length =</span> <span class="fu">sum</span>(MILES, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sum</span>(UPT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb38-484"><a href="#cb38-484" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Average Trip Length On MTA Nyc"</span>)</span>
<span id="cb38-485"><a href="#cb38-485" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-486"><a href="#cb38-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-487"><a href="#cb38-487" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3. Which transit service in NYC has the longest average trip length? ğŸš‹</span></span>
<span id="cb38-488"><a href="#cb38-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-489"><a href="#cb38-489" aria-hidden="true" tabindex="-1"></a>Which MTA service in New York City (including all five boroughs, yes, even Brooklyn ğŸ—½) has the longest average trip length? Letâ€™s just say, itâ€™s probably not the one where the subway rats are the most frequent passengers. ğŸ€</span>
<span id="cb38-490"><a href="#cb38-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-491"><a href="#cb38-491" aria-hidden="true" tabindex="-1"></a>P.S. Youâ€™ll want to be extra careful with that City column; we wouldnâ€™t want to accidentally send our buses on a detour to Brooklyn when they should be cruising through Manhattan!</span>
<span id="cb38-492"><a href="#cb38-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-495"><a href="#cb38-495" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-496"><a href="#cb38-496" aria-hidden="true" tabindex="-1"></a>NYC_SERVICES <span class="ot">&lt;-</span> NTD_SERVICE <span class="sc">|&gt;</span></span>
<span id="cb38-497"><a href="#cb38-497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(State <span class="sc">==</span> <span class="st">"NY"</span>, MILES <span class="sc">&gt;</span> <span class="dv">0</span>, UPT <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-498"><a href="#cb38-498" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Average_Trip_Length =</span> MILES <span class="sc">/</span> UPT) <span class="sc">|&gt;</span></span>
<span id="cb38-499"><a href="#cb38-499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Average_Trip_Length)) <span class="sc">|&gt;</span></span>
<span id="cb38-500"><a href="#cb38-500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Agency, City, Average_Trip_Length)</span>
<span id="cb38-501"><a href="#cb38-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-502"><a href="#cb38-502" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(NYC_SERVICES, <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-503"><a href="#cb38-503" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"NYC Longest Average Trip Length"</span>)</span>
<span id="cb38-504"><a href="#cb38-504" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-505"><a href="#cb38-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-506"><a href="#cb38-506" aria-hidden="true" tabindex="-1"></a><span class="fu">### 4. Which state has the fewest total miles travelled by public transit? ğŸ¢</span></span>
<span id="cb38-507"><a href="#cb38-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-508"><a href="#cb38-508" aria-hidden="true" tabindex="-1"></a>Which state is the turtle in the race, with the fewest total miles travelled by public transit? ğŸ¢ Are some states just cruising along at a leisurely pace, or are they barely moving at all? Itâ€™s time to find out whoâ€™s not clocking up the miles! ğŸ›‘ğŸš—</span>
<span id="cb38-509"><a href="#cb38-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-512"><a href="#cb38-512" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-513"><a href="#cb38-513" aria-hidden="true" tabindex="-1"></a>NTD_SERVICE <span class="sc">|&gt;</span></span>
<span id="cb38-514"><a href="#cb38-514" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(State) <span class="sc">|&gt;</span></span>
<span id="cb38-515"><a href="#cb38-515" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total_Miles =</span> <span class="fu">sum</span>(MILES, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb38-516"><a href="#cb38-516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Total_Miles) <span class="sc">|&gt;</span></span>
<span id="cb38-517"><a href="#cb38-517" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-518"><a href="#cb38-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Fewest total miles Travelled By Public Transit"</span>)</span>
<span id="cb38-519"><a href="#cb38-519" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-520"><a href="#cb38-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-521"><a href="#cb38-521" aria-hidden="true" tabindex="-1"></a><span class="fu">### 5. Are all states represented in this data? If no, which ones are missing? The state.name and state.abb objects we used above may be useful here.ğŸšğŸ—ºï¸</span></span>
<span id="cb38-522"><a href="#cb38-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-523"><a href="#cb38-523" aria-hidden="true" tabindex="-1"></a>Now for a little mystery â€“ are all states in this data? Or did a few sneak out of the spotlight? ğŸ‘€ Letâ€™s use the state.name and state.abb to track down any states that may have taken the wrong exit. Looks like itâ€™s time for a little data detective work! ğŸ”ğŸ’¼</span>
<span id="cb38-524"><a href="#cb38-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-527"><a href="#cb38-527" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-528"><a href="#cb38-528" aria-hidden="true" tabindex="-1"></a>all_states <span class="ot">&lt;-</span> state.abb  <span class="co"># Vector of all US state abbreviations</span></span>
<span id="cb38-529"><a href="#cb38-529" aria-hidden="true" tabindex="-1"></a>present_states <span class="ot">&lt;-</span> <span class="fu">unique</span>(NTD_SERVICE<span class="sc">$</span>State)</span>
<span id="cb38-530"><a href="#cb38-530" aria-hidden="true" tabindex="-1"></a>missing_states <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(all_states, present_states)</span>
<span id="cb38-531"><a href="#cb38-531" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(missing_states, <span class="at">caption =</span> <span class="st">"Missing States"</span>)</span>
<span id="cb38-532"><a href="#cb38-532" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-533"><a href="#cb38-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-534"><a href="#cb38-534" aria-hidden="true" tabindex="-1"></a><span class="fu">## ğŸŒ Calculate Emissions â€“ Letâ€™s Crunch Some Carbon! ğŸ’¨</span></span>
<span id="cb38-535"><a href="#cb38-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-536"><a href="#cb38-536" aria-hidden="true" tabindex="-1"></a>Time to put on our environmental cap and get down to the nitty-gritty of CO2 emissions! We're about to take a deep dive into some data to calculate the total emissions from different transit agencies and their modes. Spoiler alert: Weâ€™re going green â€“ but with a twist! ğŸŒ±ğŸ”¢</span>
<span id="cb38-537"><a href="#cb38-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-538"><a href="#cb38-538" aria-hidden="true" tabindex="-1"></a><span class="fu">### Join the Three Tables â€“ The Ultimate Data Party ğŸ‰</span></span>
<span id="cb38-539"><a href="#cb38-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-540"><a href="#cb38-540" aria-hidden="true" tabindex="-1"></a>Hereâ€™s where we get our hands dirty (but in an eco-friendly way, of course!). Weâ€™ll join three tables together like the perfect data trio:</span>
<span id="cb38-541"><a href="#cb38-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-542"><a href="#cb38-542" aria-hidden="true" tabindex="-1"></a>**NTD_SERVICE** ğŸš â€“ It tells us the Agency and Mode (because, letâ€™s face it, transit is all about style, right?)</span>
<span id="cb38-543"><a href="#cb38-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-544"><a href="#cb38-544" aria-hidden="true" tabindex="-1"></a>**NTD_ENERGY** âš¡ â€“ This tableâ€™s going to give us the lowdown on all the fuel sources. Itâ€™s like fuelâ€™s Wikipedia page, but with more numbers.</span>
<span id="cb38-545"><a href="#cb38-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-546"><a href="#cb38-546" aria-hidden="true" tabindex="-1"></a>**EIA_SEP_REPORT** ğŸ“Š â€“ This is where the magic happens! It tells us the CO2 emissions per MWh. Time to add some climate-friendly math into the mix. Once weâ€™ve got these three tables chatting with each other, weâ€™re ready to roll!</span>
<span id="cb38-547"><a href="#cb38-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-550"><a href="#cb38-550" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-551"><a href="#cb38-551" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a mapping of state abbreviations to full names</span></span>
<span id="cb38-552"><a href="#cb38-552" aria-hidden="true" tabindex="-1"></a>state_abbrev_to_full <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb38-553"><a href="#cb38-553" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AL"</span> <span class="ot">=</span> <span class="st">"Alabama"</span>, <span class="st">"AK"</span> <span class="ot">=</span> <span class="st">"Alaska"</span>, <span class="st">"AZ"</span> <span class="ot">=</span> <span class="st">"Arizona"</span>, <span class="st">"AR"</span> <span class="ot">=</span> <span class="st">"Arkansas"</span>, <span class="st">"CA"</span> <span class="ot">=</span> <span class="st">"California"</span>, <span class="st">"CO"</span> <span class="ot">=</span> <span class="st">"Colorado"</span>, </span>
<span id="cb38-554"><a href="#cb38-554" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CT"</span> <span class="ot">=</span> <span class="st">"Connecticut"</span>, <span class="st">"DE"</span> <span class="ot">=</span> <span class="st">"Delaware"</span>, <span class="st">"FL"</span> <span class="ot">=</span> <span class="st">"Florida"</span>, <span class="st">"GA"</span> <span class="ot">=</span> <span class="st">"Georgia"</span>, <span class="st">"HI"</span> <span class="ot">=</span> <span class="st">"Hawaii"</span>, <span class="st">"ID"</span> <span class="ot">=</span> <span class="st">"Idaho"</span>, </span>
<span id="cb38-555"><a href="#cb38-555" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IL"</span> <span class="ot">=</span> <span class="st">"Illinois"</span>, <span class="st">"IN"</span> <span class="ot">=</span> <span class="st">"Indiana"</span>, <span class="st">"IA"</span> <span class="ot">=</span> <span class="st">"Iowa"</span>, <span class="st">"KS"</span> <span class="ot">=</span> <span class="st">"Kansas"</span>, <span class="st">"KY"</span> <span class="ot">=</span> <span class="st">"Kentucky"</span>, <span class="st">"LA"</span> <span class="ot">=</span> <span class="st">"Louisiana"</span>, </span>
<span id="cb38-556"><a href="#cb38-556" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ME"</span> <span class="ot">=</span> <span class="st">"Maine"</span>, <span class="st">"MD"</span> <span class="ot">=</span> <span class="st">"Maryland"</span>, <span class="st">"MA"</span> <span class="ot">=</span> <span class="st">"Massachusetts"</span>, <span class="st">"MI"</span> <span class="ot">=</span> <span class="st">"Michigan"</span>, <span class="st">"MN"</span> <span class="ot">=</span> <span class="st">"Minnesota"</span>, <span class="st">"MS"</span> <span class="ot">=</span> <span class="st">"Mississippi"</span>, </span>
<span id="cb38-557"><a href="#cb38-557" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MO"</span> <span class="ot">=</span> <span class="st">"Missouri"</span>, <span class="st">"MT"</span> <span class="ot">=</span> <span class="st">"Montana"</span>, <span class="st">"NE"</span> <span class="ot">=</span> <span class="st">"Nebraska"</span>, <span class="st">"NV"</span> <span class="ot">=</span> <span class="st">"Nevada"</span>, <span class="st">"NH"</span> <span class="ot">=</span> <span class="st">"New Hampshire"</span>, <span class="st">"NJ"</span> <span class="ot">=</span> <span class="st">"New Jersey"</span>, </span>
<span id="cb38-558"><a href="#cb38-558" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NM"</span> <span class="ot">=</span> <span class="st">"New Mexico"</span>, <span class="st">"NY"</span> <span class="ot">=</span> <span class="st">"New York"</span>, <span class="st">"NC"</span> <span class="ot">=</span> <span class="st">"North Carolina"</span>, <span class="st">"ND"</span> <span class="ot">=</span> <span class="st">"North Dakota"</span>, <span class="st">"OH"</span> <span class="ot">=</span> <span class="st">"Ohio"</span>, <span class="st">"OK"</span> <span class="ot">=</span> <span class="st">"Oklahoma"</span>, </span>
<span id="cb38-559"><a href="#cb38-559" aria-hidden="true" tabindex="-1"></a>  <span class="st">"OR"</span> <span class="ot">=</span> <span class="st">"Oregon"</span>, <span class="st">"PA"</span> <span class="ot">=</span> <span class="st">"Pennsylvania"</span>, <span class="st">"RI"</span> <span class="ot">=</span> <span class="st">"Rhode Island"</span>, <span class="st">"SC"</span> <span class="ot">=</span> <span class="st">"South Carolina"</span>, <span class="st">"SD"</span> <span class="ot">=</span> <span class="st">"South Dakota"</span>, </span>
<span id="cb38-560"><a href="#cb38-560" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TN"</span> <span class="ot">=</span> <span class="st">"Tennessee"</span>, <span class="st">"TX"</span> <span class="ot">=</span> <span class="st">"Texas"</span>, <span class="st">"UT"</span> <span class="ot">=</span> <span class="st">"Utah"</span>, <span class="st">"VT"</span> <span class="ot">=</span> <span class="st">"Vermont"</span>, <span class="st">"VA"</span> <span class="ot">=</span> <span class="st">"Virginia"</span>, <span class="st">"WA"</span> <span class="ot">=</span> <span class="st">"Washington"</span>, </span>
<span id="cb38-561"><a href="#cb38-561" aria-hidden="true" tabindex="-1"></a>  <span class="st">"WV"</span> <span class="ot">=</span> <span class="st">"West Virginia"</span>, <span class="st">"WI"</span> <span class="ot">=</span> <span class="st">"Wisconsin"</span>, <span class="st">"WY"</span> <span class="ot">=</span> <span class="st">"Wyoming"</span></span>
<span id="cb38-562"><a href="#cb38-562" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-563"><a href="#cb38-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-564"><a href="#cb38-564" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix State Names in NTD_SERVICE before joining</span></span>
<span id="cb38-565"><a href="#cb38-565" aria-hidden="true" tabindex="-1"></a>NTD_SERVICE <span class="ot">&lt;-</span> NTD_SERVICE <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">State =</span> state_abbrev_to_full[State])</span>
<span id="cb38-566"><a href="#cb38-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-567"><a href="#cb38-567" aria-hidden="true" tabindex="-1"></a><span class="co"># Now perform the joins</span></span>
<span id="cb38-568"><a href="#cb38-568" aria-hidden="true" tabindex="-1"></a>NTD_EMISSIONS <span class="ot">&lt;-</span> NTD_SERVICE <span class="sc">|&gt;</span></span>
<span id="cb38-569"><a href="#cb38-569" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Agency, State, <span class="st">`</span><span class="at">NTD ID</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-570"><a href="#cb38-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(NTD_ENERGY, <span class="at">by =</span> <span class="st">"NTD ID"</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-571"><a href="#cb38-571" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(EIA_SEP_REPORT, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"State"</span> <span class="ot">=</span> <span class="st">"state"</span>))</span>
<span id="cb38-572"><a href="#cb38-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-573"><a href="#cb38-573" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the join worked</span></span>
<span id="cb38-574"><a href="#cb38-574" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(NTD_EMISSIONS)  <span class="co"># Should no longer be (0, X)</span></span>
<span id="cb38-575"><a href="#cb38-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-576"><a href="#cb38-576" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-577"><a href="#cb38-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-578"><a href="#cb38-578" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Ultimate Emissions Table ğŸ§®</span></span>
<span id="cb38-579"><a href="#cb38-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-580"><a href="#cb38-580" aria-hidden="true" tabindex="-1"></a>**Weâ€™re going to create a super sleek table with all the goods:**</span>
<span id="cb38-581"><a href="#cb38-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-582"><a href="#cb38-582" aria-hidden="true" tabindex="-1"></a>**Agency + Mode Pair â€“** These are the dynamic duos of transit! ğŸšğŸš†</span>
<span id="cb38-583"><a href="#cb38-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-584"><a href="#cb38-584" aria-hidden="true" tabindex="-1"></a>**State â€“ Every agency has a home**, and weâ€™ll find out which state itâ€™s calling its turf! ğŸŒ</span>
<span id="cb38-585"><a href="#cb38-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-586"><a href="#cb38-586" aria-hidden="true" tabindex="-1"></a>**Fuel Sources** â€“ Because we need to know how those buses are powering through your city streets! ğŸš¨</span>
<span id="cb38-587"><a href="#cb38-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-588"><a href="#cb38-588" aria-hidden="true" tabindex="-1"></a>**CO2 Emissions per MWh** â€“ Letâ€™s see how much carbonâ€™s being emitted for every megawatt-hour of power. (The more we know, the greener we grow! ğŸŒ³)</span>
<span id="cb38-589"><a href="#cb38-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-590"><a href="#cb38-590" aria-hidden="true" tabindex="-1"></a>**Now, letâ€™s clean up some fuel names and make sure everything aligns:**</span>
<span id="cb38-591"><a href="#cb38-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-594"><a href="#cb38-594" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-595"><a href="#cb38-595" aria-hidden="true" tabindex="-1"></a>NTD_EMISSIONS <span class="ot">&lt;-</span> NTD_EMISSIONS <span class="sc">|&gt;</span> </span>
<span id="cb38-596"><a href="#cb38-596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb38-597"><a href="#cb38-597" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Bio diesel"</span> <span class="ot">=</span> <span class="st">"Bio-Diesel"</span>,</span>
<span id="cb38-598"><a href="#cb38-598" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Natural Gas"</span> <span class="ot">=</span> <span class="st">"C Natural Gas"</span>,</span>
<span id="cb38-599"><a href="#cb38-599" aria-hidden="true" tabindex="-1"></a>    <span class="st">"LNG"</span> <span class="ot">=</span> <span class="st">"Liquified Nat Gas"</span>,</span>
<span id="cb38-600"><a href="#cb38-600" aria-hidden="true" tabindex="-1"></a>    <span class="st">"LPG"</span> <span class="ot">=</span> <span class="st">"Liquified Petroleum Gas"</span>,</span>
<span id="cb38-601"><a href="#cb38-601" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Battery Electric"</span> <span class="ot">=</span> <span class="st">"Electric Battery"</span>,</span>
<span id="cb38-602"><a href="#cb38-602" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Electric"</span> <span class="ot">=</span> <span class="st">"Electric Propulsion"</span></span>
<span id="cb38-603"><a href="#cb38-603" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-604"><a href="#cb38-604" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-605"><a href="#cb38-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-606"><a href="#cb38-606" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Formula â€“ Itâ€™s Math, But Make It Eco! ğŸ§‘â€ğŸ«</span></span>
<span id="cb38-607"><a href="#cb38-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-608"><a href="#cb38-608" aria-hidden="true" tabindex="-1"></a>Now for the fun part â€“ the math! ğŸ’¡</span>
<span id="cb38-609"><a href="#cb38-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-610"><a href="#cb38-610" aria-hidden="true" tabindex="-1"></a>Weâ€™re going to use a long-ish arithmetic formula (donâ€™t worry, itâ€™s just a couple of steps) inside a mutate function to compute the total emissions for each Agency + Mode Pair. Weâ€™ll need to convert combustion fuels to CO2 emissions â€“ but donâ€™t panic, weâ€™ve got conversion factors! ğŸ’ª You can hard code these bad boys in your script for simplicity:</span>
<span id="cb38-611"><a href="#cb38-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-614"><a href="#cb38-614" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-615"><a href="#cb38-615" aria-hidden="true" tabindex="-1"></a>fuel_emission_factors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb38-616"><a href="#cb38-616" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Diesel Fuel"</span> <span class="ot">=</span> <span class="fl">10.19</span>,    <span class="co"># kg CO2 per gallon</span></span>
<span id="cb38-617"><a href="#cb38-617" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Gasoline"</span> <span class="ot">=</span> <span class="fl">8.89</span>,</span>
<span id="cb38-618"><a href="#cb38-618" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Natural Gas"</span> <span class="ot">=</span> <span class="fl">52.91</span>,    <span class="co"># kg CO2 per MMBtu</span></span>
<span id="cb38-619"><a href="#cb38-619" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LPG"</span> <span class="ot">=</span> <span class="fl">5.79</span>,  </span>
<span id="cb38-620"><a href="#cb38-620" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LNG"</span> <span class="ot">=</span> <span class="fl">4.29</span>,</span>
<span id="cb38-621"><a href="#cb38-621" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Kerosene"</span> <span class="ot">=</span> <span class="fl">9.96</span>,</span>
<span id="cb38-622"><a href="#cb38-622" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ethanol"</span> <span class="ot">=</span> <span class="fl">1.94</span>,</span>
<span id="cb38-623"><a href="#cb38-623" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Hydrogen"</span> <span class="ot">=</span> <span class="dv">0</span>,           <span class="co"># No emissions from hydrogen</span></span>
<span id="cb38-624"><a href="#cb38-624" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Battery Electric"</span> <span class="ot">=</span> <span class="dv">0</span>,   <span class="co"># Handled separately using CO2_MWh</span></span>
<span id="cb38-625"><a href="#cb38-625" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Electric"</span> <span class="ot">=</span> <span class="dv">0</span>            <span class="co"># Handled separately using CO2_MWh</span></span>
<span id="cb38-626"><a href="#cb38-626" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-627"><a href="#cb38-627" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-628"><a href="#cb38-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-629"><a href="#cb38-629" aria-hidden="true" tabindex="-1"></a>**Then, apply the emissions calculation:**</span>
<span id="cb38-630"><a href="#cb38-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-633"><a href="#cb38-633" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-634"><a href="#cb38-634" aria-hidden="true" tabindex="-1"></a>NTD_EMISSIONS <span class="ot">&lt;-</span> NTD_EMISSIONS <span class="sc">|&gt;</span></span>
<span id="cb38-635"><a href="#cb38-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-636"><a href="#cb38-636" aria-hidden="true" tabindex="-1"></a>    <span class="at">Fuel_Emissions =</span> (<span class="st">`</span><span class="at">Diesel Fuel</span><span class="st">`</span> <span class="sc">*</span> fuel_emission_factors[<span class="st">"Diesel Fuel"</span>]) <span class="sc">+</span></span>
<span id="cb38-637"><a href="#cb38-637" aria-hidden="true" tabindex="-1"></a>      (<span class="st">`</span><span class="at">Gasoline</span><span class="st">`</span> <span class="sc">*</span> fuel_emission_factors[<span class="st">"Gasoline"</span>]) <span class="sc">+</span></span>
<span id="cb38-638"><a href="#cb38-638" aria-hidden="true" tabindex="-1"></a>      (<span class="st">`</span><span class="at">Natural Gas</span><span class="st">`</span> <span class="sc">*</span> fuel_emission_factors[<span class="st">"Natural Gas"</span>]) <span class="sc">+</span></span>
<span id="cb38-639"><a href="#cb38-639" aria-hidden="true" tabindex="-1"></a>      (<span class="st">`</span><span class="at">LPG</span><span class="st">`</span> <span class="sc">*</span> fuel_emission_factors[<span class="st">"LPG"</span>]) <span class="sc">+</span></span>
<span id="cb38-640"><a href="#cb38-640" aria-hidden="true" tabindex="-1"></a>      (<span class="st">`</span><span class="at">LNG</span><span class="st">`</span> <span class="sc">*</span> fuel_emission_factors[<span class="st">"LNG"</span>]) <span class="sc">+</span></span>
<span id="cb38-641"><a href="#cb38-641" aria-hidden="true" tabindex="-1"></a>      (<span class="st">`</span><span class="at">Kerosene</span><span class="st">`</span> <span class="sc">*</span> fuel_emission_factors[<span class="st">"Kerosene"</span>]) <span class="sc">+</span></span>
<span id="cb38-642"><a href="#cb38-642" aria-hidden="true" tabindex="-1"></a>      (<span class="st">`</span><span class="at">Ethanol</span><span class="st">`</span> <span class="sc">*</span> fuel_emission_factors[<span class="st">"Ethanol"</span>]) <span class="sc">+</span></span>
<span id="cb38-643"><a href="#cb38-643" aria-hidden="true" tabindex="-1"></a>      (<span class="st">`</span><span class="at">Hydrogen</span><span class="st">`</span> <span class="sc">*</span> fuel_emission_factors[<span class="st">"Hydrogen"</span>])</span>
<span id="cb38-644"><a href="#cb38-644" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-645"><a href="#cb38-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-646"><a href="#cb38-646" aria-hidden="true" tabindex="-1"></a>NTD_EMISSIONS <span class="ot">&lt;-</span> NTD_EMISSIONS <span class="sc">|&gt;</span></span>
<span id="cb38-647"><a href="#cb38-647" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-648"><a href="#cb38-648" aria-hidden="true" tabindex="-1"></a>    <span class="at">Electricity_Emissions =</span> <span class="st">`</span><span class="at">Electric</span><span class="st">`</span> <span class="sc">*</span> CO2_MWh</span>
<span id="cb38-649"><a href="#cb38-649" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-650"><a href="#cb38-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-651"><a href="#cb38-651" aria-hidden="true" tabindex="-1"></a>NTD_EMISSIONS <span class="ot">&lt;-</span> NTD_EMISSIONS <span class="sc">|&gt;</span></span>
<span id="cb38-652"><a href="#cb38-652" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-653"><a href="#cb38-653" aria-hidden="true" tabindex="-1"></a>    <span class="at">Total_Emissions =</span> Fuel_Emissions <span class="sc">+</span> Electricity_Emissions</span>
<span id="cb38-654"><a href="#cb38-654" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-655"><a href="#cb38-655" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-656"><a href="#cb38-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-657"><a href="#cb38-657" aria-hidden="true" tabindex="-1"></a>**ğŸ’š Letâ€™s Save the Planet â€“ One Data Row at a Time! Now that our emissions data is ready, let's take a look at the final product! ğŸŒ**</span>
<span id="cb38-658"><a href="#cb38-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-661"><a href="#cb38-661" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-662"><a href="#cb38-662" aria-hidden="true" tabindex="-1"></a>NTD_EMISSIONS <span class="sc">|&gt;</span> <span class="fu">select</span>(Agency, Mode, State, Fuel_Emissions, Electricity_Emissions, Total_Emissions) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(Total_Emissions))</span>
<span id="cb38-663"><a href="#cb38-663" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-664"><a href="#cb38-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-665"><a href="#cb38-665" aria-hidden="true" tabindex="-1"></a><span class="fu">## Normalize Emissions to Transit Usage ğŸš†</span></span>
<span id="cb38-666"><a href="#cb38-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-667"><a href="#cb38-667" aria-hidden="true" tabindex="-1"></a>In this task, weâ€™re on a mission to normalize emissions (a fancy way of saying "make fair comparisons") based on:</span>
<span id="cb38-668"><a href="#cb38-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-669"><a href="#cb38-669" aria-hidden="true" tabindex="-1"></a>**Emissions per Unlinked Passenger Trip (UPT) ğŸšŒğŸ‘¥**</span>
<span id="cb38-670"><a href="#cb38-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-671"><a href="#cb38-671" aria-hidden="true" tabindex="-1"></a>**Emissions per Passenger Mile ğŸš‹ğŸŒ±**</span>
<span id="cb38-672"><a href="#cb38-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-673"><a href="#cb38-673" aria-hidden="true" tabindex="-1"></a><span class="fu">### Normalize Emissions â€“ Leveling the Playing Field! ğŸ¯</span></span>
<span id="cb38-674"><a href="#cb38-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-675"><a href="#cb38-675" aria-hidden="true" tabindex="-1"></a>Before we start handing out gold medals ğŸ… (or shameful side-eyes ğŸ‘€), we normalize emissions based on ridership. This ensures a fair fightâ€”because comparing a tiny rural bus route to New York Cityâ€™s subway isnâ€™t exactly fair, right? ğŸ˜†</span>
<span id="cb38-676"><a href="#cb38-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-679"><a href="#cb38-679" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-680"><a href="#cb38-680" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out agencies with extremely small values to avoid distortions</span></span>
<span id="cb38-681"><a href="#cb38-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-682"><a href="#cb38-682" aria-hidden="true" tabindex="-1"></a>AGENCY_NORMALIZED <span class="ot">&lt;-</span> NTD_SERVICE <span class="sc">%&gt;%</span>   <span class="co"># Use your actual dataset</span></span>
<span id="cb38-683"><a href="#cb38-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(NTD_EMISSIONS, <span class="at">by =</span> <span class="st">"NTD ID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-684"><a href="#cb38-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Total_Emissions))  <span class="co"># Ensure you have valid emission data</span></span>
<span id="cb38-685"><a href="#cb38-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-686"><a href="#cb38-686" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out agencies with extremely small values to avoid distortions</span></span>
<span id="cb38-687"><a href="#cb38-687" aria-hidden="true" tabindex="-1"></a>AGENCY_NORMALIZED <span class="ot">&lt;-</span> AGENCY_NORMALIZED <span class="sc">%&gt;%</span></span>
<span id="cb38-688"><a href="#cb38-688" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(UPT <span class="sc">&gt;</span> <span class="dv">1000</span>, MILES <span class="sc">&gt;</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span>  <span class="co"># Adjust thresholds as needed</span></span>
<span id="cb38-689"><a href="#cb38-689" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-690"><a href="#cb38-690" aria-hidden="true" tabindex="-1"></a>    <span class="at">Emissions_per_UPT =</span> <span class="fu">ifelse</span>(UPT <span class="sc">&gt;</span> <span class="dv">0</span>, Total_Emissions <span class="sc">/</span> UPT, <span class="cn">NA</span>),</span>
<span id="cb38-691"><a href="#cb38-691" aria-hidden="true" tabindex="-1"></a>    <span class="at">Emissions_per_Passenger_Mile =</span> <span class="fu">ifelse</span>(MILES <span class="sc">&gt;</span> <span class="dv">0</span>, Total_Emissions <span class="sc">/</span> MILES, <span class="cn">NA</span>)</span>
<span id="cb38-692"><a href="#cb38-692" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-693"><a href="#cb38-693" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-694"><a href="#cb38-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-695"><a href="#cb38-695" aria-hidden="true" tabindex="-1"></a>ğŸš¦ Now, with that done, letâ€™s move on to **finding our champions!**</span>
<span id="cb38-696"><a href="#cb38-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-697"><a href="#cb38-697" aria-hidden="true" tabindex="-1"></a><span class="fu">## **ğŸ¥‡ The Greenest Transit Agency (GTA IV Award #1) ğŸŒ±ğŸš†**</span></span>
<span id="cb38-698"><a href="#cb38-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-699"><a href="#cb38-699" aria-hidden="true" tabindex="-1"></a>Which agency has the **lowest emissions per passenger trip**? And which one produces the least pollution **per mile traveled**?</span>
<span id="cb38-700"><a href="#cb38-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-701"><a href="#cb38-701" aria-hidden="true" tabindex="-1"></a>Let's **roll out the green carpet** and announce the winners! ğŸ¤ğŸ¥</span>
<span id="cb38-702"><a href="#cb38-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-705"><a href="#cb38-705" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-706"><a href="#cb38-706" aria-hidden="true" tabindex="-1"></a>AGENCY_NORMALIZED <span class="ot">&lt;-</span> AGENCY_NORMALIZED <span class="sc">%&gt;%</span></span>
<span id="cb38-707"><a href="#cb38-707" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Size_Category =</span> <span class="fu">case_when</span>(</span>
<span id="cb38-708"><a href="#cb38-708" aria-hidden="true" tabindex="-1"></a>    UPT <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">6</span> <span class="sc">~</span> <span class="st">"Small"</span>,</span>
<span id="cb38-709"><a href="#cb38-709" aria-hidden="true" tabindex="-1"></a>    UPT <span class="sc">&gt;=</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">6</span> <span class="sc">&amp;</span> UPT <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">8</span> <span class="sc">~</span> <span class="st">"Medium"</span>,</span>
<span id="cb38-710"><a href="#cb38-710" aria-hidden="true" tabindex="-1"></a>    UPT <span class="sc">&gt;=</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">8</span> <span class="sc">~</span> <span class="st">"Large"</span></span>
<span id="cb38-711"><a href="#cb38-711" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb38-712"><a href="#cb38-712" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-713"><a href="#cb38-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-714"><a href="#cb38-714" aria-hidden="true" tabindex="-1"></a><span class="fu">### Find the greenest transit agency by lowest emissions per UPT</span></span>
<span id="cb38-715"><a href="#cb38-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-718"><a href="#cb38-718" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-719"><a href="#cb38-719" aria-hidden="true" tabindex="-1"></a>AGENCY_NORMALIZED <span class="ot">&lt;-</span> AGENCY_NORMALIZED <span class="sc">%&gt;%</span></span>
<span id="cb38-720"><a href="#cb38-720" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Agency =</span> Agency.x)  <span class="co"># Rename "Agency.x" to "Agency"</span></span>
<span id="cb38-721"><a href="#cb38-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-722"><a href="#cb38-722" aria-hidden="true" tabindex="-1"></a>greenest_agency_UPT <span class="ot">&lt;-</span> AGENCY_NORMALIZED <span class="sc">%&gt;%</span></span>
<span id="cb38-723"><a href="#cb38-723" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Size_Category) <span class="sc">&amp;</span> Emissions_per_UPT <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-724"><a href="#cb38-724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Size_Category) <span class="sc">%&gt;%</span></span>
<span id="cb38-725"><a href="#cb38-725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(Emissions_per_UPT, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-726"><a href="#cb38-726" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Size_Category, Agency, Emissions_per_UPT)</span>
<span id="cb38-727"><a href="#cb38-727" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(greenest_agency_UPT, <span class="at">caption =</span> <span class="st">"Greenest Agency By lowest Emissions Per UPT"</span>)</span>
<span id="cb38-728"><a href="#cb38-728" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-729"><a href="#cb38-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-730"><a href="#cb38-730" aria-hidden="true" tabindex="-1"></a><span class="fu">### Find the greenest transit agency by lowest emissions per Passenger Mile</span></span>
<span id="cb38-731"><a href="#cb38-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-734"><a href="#cb38-734" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-735"><a href="#cb38-735" aria-hidden="true" tabindex="-1"></a>greenest_agency_mile <span class="ot">&lt;-</span> AGENCY_NORMALIZED <span class="sc">%&gt;%</span></span>
<span id="cb38-736"><a href="#cb38-736" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Size_Category) <span class="sc">&amp;</span> Emissions_per_UPT <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-737"><a href="#cb38-737" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Size_Category) <span class="sc">%&gt;%</span></span>
<span id="cb38-738"><a href="#cb38-738" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(Emissions_per_Passenger_Mile, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-739"><a href="#cb38-739" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Size_Category, Agency, Emissions_per_Passenger_Mile)</span>
<span id="cb38-740"><a href="#cb38-740" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(greenest_agency_mile, <span class="at">caption=</span> <span class="st">"Greenest Transit Agency By Lowest Emissions Per Passenger Mile"</span>)</span>
<span id="cb38-741"><a href="#cb38-741" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-742"><a href="#cb38-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-743"><a href="#cb38-743" aria-hidden="true" tabindex="-1"></a><span class="fu">## **Total Emissions Avoided (GTA IV Award #2) ğŸŒ±ğŸš†**</span></span>
<span id="cb38-744"><a href="#cb38-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-745"><a href="#cb38-745" aria-hidden="true" tabindex="-1"></a>Now, letâ€™s compute the **total emissions avoided** by public transit. Because without it, we'd have **millions of solo drivers** making traffic even worse than it already is! ğŸ˜±ğŸš—ğŸš•ğŸš™</span>
<span id="cb38-746"><a href="#cb38-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-747"><a href="#cb38-747" aria-hidden="true" tabindex="-1"></a>How do we do this?\</span>
<span id="cb38-748"><a href="#cb38-748" aria-hidden="true" tabindex="-1"></a>1ï¸âƒ£ **Estimate emissions if all transit passengers drove cars instead.**\</span>
<span id="cb38-749"><a href="#cb38-749" aria-hidden="true" tabindex="-1"></a>2ï¸âƒ£ **Use US CAFE fuel standards to convert miles to gasoline usage.**\</span>
<span id="cb38-750"><a href="#cb38-750" aria-hidden="true" tabindex="-1"></a>3ï¸âƒ£ **Calculate emissions avoided by taking public transit instead of driving.**</span>
<span id="cb38-751"><a href="#cb38-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-752"><a href="#cb38-752" aria-hidden="true" tabindex="-1"></a>**Used average CAFE standard of 24.7 mpg and CO2 emissions of 8.89 kg per gallon**</span>
<span id="cb38-753"><a href="#cb38-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-756"><a href="#cb38-756" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-757"><a href="#cb38-757" aria-hidden="true" tabindex="-1"></a>AGENCY_NORMALIZED <span class="ot">&lt;-</span> AGENCY_NORMALIZED <span class="sc">%&gt;%</span></span>
<span id="cb38-758"><a href="#cb38-758" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-759"><a href="#cb38-759" aria-hidden="true" tabindex="-1"></a>    <span class="at">Gallons_of_fuel =</span> MILES <span class="sc">/</span> <span class="fl">24.7</span>,  <span class="co"># Convert miles to fuel gallons</span></span>
<span id="cb38-760"><a href="#cb38-760" aria-hidden="true" tabindex="-1"></a>    <span class="at">Emissions_from_driving =</span> Gallons_of_fuel <span class="sc">*</span> <span class="fl">8.89</span>,  <span class="co"># Convert gallons to CO2</span></span>
<span id="cb38-761"><a href="#cb38-761" aria-hidden="true" tabindex="-1"></a>    <span class="at">Emissions_avoided =</span> Emissions_from_driving <span class="sc">-</span> Total_Emissions  <span class="co"># Calculate CO2 saved</span></span>
<span id="cb38-762"><a href="#cb38-762" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-763"><a href="#cb38-763" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-764"><a href="#cb38-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-765"><a href="#cb38-765" aria-hidden="true" tabindex="-1"></a><span class="fu">### Find agency with most emissions avoided ğŸ†</span></span>
<span id="cb38-766"><a href="#cb38-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-769"><a href="#cb38-769" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-770"><a href="#cb38-770" aria-hidden="true" tabindex="-1"></a>most_emissions_avoided_by_size <span class="ot">&lt;-</span> AGENCY_NORMALIZED <span class="sc">%&gt;%</span></span>
<span id="cb38-771"><a href="#cb38-771" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Size_Category)) <span class="sc">%&gt;%</span>  <span class="co"># Ensure valid categories</span></span>
<span id="cb38-772"><a href="#cb38-772" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Size_Category) <span class="sc">%&gt;%</span></span>
<span id="cb38-773"><a href="#cb38-773" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(Emissions_avoided, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-774"><a href="#cb38-774" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Size_Category, Agency, Emissions_avoided)</span>
<span id="cb38-775"><a href="#cb38-775" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(most_emissions_avoided_by_size, <span class="at">caption =</span> <span class="st">"Most Emissions Avoided"</span>)</span>
<span id="cb38-776"><a href="#cb38-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-777"><a href="#cb38-777" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-778"><a href="#cb38-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-779"><a href="#cb38-779" aria-hidden="true" tabindex="-1"></a>This agency has officially **saved the planet** more than your coworker with the reusable straw. ğŸŒ±ğŸ’šâ™»ï¸</span>
<span id="cb38-780"><a href="#cb38-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-781"><a href="#cb38-781" aria-hidden="true" tabindex="-1"></a><span class="fu">### ğŸ†Most Improved Green Agency **(GTA IV Award #3) ğŸš†** ğŸ†</span></span>
<span id="cb38-782"><a href="#cb38-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-783"><a href="#cb38-783" aria-hidden="true" tabindex="-1"></a>This award recognizes the transit agency that has demonstrated the most significant improvement in environmental efficiency compared to its peers. Instead of using past-year data (which may not always be available), this award is given to the agency that has the largest improvement relative to the median emissions per passenger mile in its category (Large, Medium, or Small).</span>
<span id="cb38-784"><a href="#cb38-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-787"><a href="#cb38-787" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-788"><a href="#cb38-788" aria-hidden="true" tabindex="-1"></a>most_improved_agency <span class="ot">&lt;-</span> AGENCY_NORMALIZED <span class="sc">%&gt;%</span></span>
<span id="cb38-789"><a href="#cb38-789" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Emissions_per_Passenger_Mile) <span class="sc">&amp;</span> Emissions_per_Passenger_Mile <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-790"><a href="#cb38-790" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Size_Category) <span class="sc">%&gt;%</span></span>
<span id="cb38-791"><a href="#cb38-791" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">median_emissions =</span> <span class="fu">median</span>(Emissions_per_Passenger_Mile, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb38-792"><a href="#cb38-792" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">emissions_improvement =</span> median_emissions <span class="sc">-</span> Emissions_per_Passenger_Mile) <span class="sc">%&gt;%</span></span>
<span id="cb38-793"><a href="#cb38-793" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> emissions_improvement, <span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span>  <span class="co"># Select top in each category</span></span>
<span id="cb38-794"><a href="#cb38-794" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-795"><a href="#cb38-795" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Agency, Size_Category, Emissions_per_Passenger_Mile, median_emissions, emissions_improvement)</span>
<span id="cb38-796"><a href="#cb38-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-797"><a href="#cb38-797" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(most_improved_agency, <span class="at">caption =</span> <span class="st">"Most Improved Agency"</span>)</span>
<span id="cb38-798"><a href="#cb38-798" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-799"><a href="#cb38-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-800"><a href="#cb38-800" aria-hidden="true" tabindex="-1"></a><span class="fu">### ğŸ’€Biggest Gas Guzzlerâ›½ **(GTA IV Award #4) ğŸŒ±ğŸš†**</span></span>
<span id="cb38-801"><a href="#cb38-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-802"><a href="#cb38-802" aria-hidden="true" tabindex="-1"></a>This award highlights the least fuel-efficient transit agencies in each size category (Large, Medium, Small). The "Biggest Gas Guzzler" is the agency with the highest Emissions per Passenger Mile, indicating it produces the most pollution per mile traveled by a passenger. This award serves as a benchmark for identifying areas where fuel efficiency improvements and sustainability measures are most needed.</span>
<span id="cb38-803"><a href="#cb38-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-806"><a href="#cb38-806" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-807"><a href="#cb38-807" aria-hidden="true" tabindex="-1"></a>biggest_gas_guzzler_by_size <span class="ot">&lt;-</span> AGENCY_NORMALIZED <span class="sc">%&gt;%</span></span>
<span id="cb38-808"><a href="#cb38-808" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Size_Category)) <span class="sc">%&gt;%</span></span>
<span id="cb38-809"><a href="#cb38-809" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Size_Category) <span class="sc">%&gt;%</span></span>
<span id="cb38-810"><a href="#cb38-810" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(Emissions_per_Passenger_Mile, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-811"><a href="#cb38-811" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Size_Category, Agency, Emissions_per_Passenger_Mile)</span>
<span id="cb38-812"><a href="#cb38-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-813"><a href="#cb38-813" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(biggest_gas_guzzler_by_size, <span class="at">caption =</span><span class="st">"Biggest Gas Guzzler"</span>)</span>
<span id="cb38-814"><a href="#cb38-814" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-815"><a href="#cb38-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-816"><a href="#cb38-816" aria-hidden="true" tabindex="-1"></a><span class="fu">## ğŸ“ˆ Visualizations ğŸ¨</span></span>
<span id="cb38-817"><a href="#cb38-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-818"><a href="#cb38-818" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ğŸš Greenest Transit Agency - A Breath of Fresh Air! ğŸŒ</span></span>
<span id="cb38-819"><a href="#cb38-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-822"><a href="#cb38-822" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-823"><a href="#cb38-823" aria-hidden="true" tabindex="-1"></a>greenest_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb38-824"><a href="#cb38-824" aria-hidden="true" tabindex="-1"></a>  <span class="at">Agency =</span> <span class="fu">c</span>(<span class="st">"New Jersey Transit Corporation"</span>, <span class="st">"King County, dba: King County Metro"</span>, <span class="st">"Altoona Metro Transit, dba: AMTRAN"</span>),</span>
<span id="cb38-825"><a href="#cb38-825" aria-hidden="true" tabindex="-1"></a>  <span class="at">Size_Category =</span> <span class="fu">c</span>(<span class="st">"Large"</span>, <span class="st">"Medium"</span>, <span class="st">"Small"</span>),</span>
<span id="cb38-826"><a href="#cb38-826" aria-hidden="true" tabindex="-1"></a>  <span class="at">Emissions_per_UPT =</span> <span class="fu">c</span>(<span class="fl">0.0024014936</span>, <span class="fl">0.0007222026</span>, <span class="fl">0.0056772412</span>),</span>
<span id="cb38-827"><a href="#cb38-827" aria-hidden="true" tabindex="-1"></a>  <span class="at">Emissions_per_Passenger_Mile =</span> <span class="fu">c</span>(<span class="fl">0.0002060647</span>, <span class="fl">0.0001889437</span>, <span class="fl">0.0015635784</span>)</span>
<span id="cb38-828"><a href="#cb38-828" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(Emissions_per_UPT, Emissions_per_Passenger_Mile), </span>
<span id="cb38-829"><a href="#cb38-829" aria-hidden="true" tabindex="-1"></a>                    <span class="at">names_to =</span> <span class="st">"Metric"</span>, <span class="at">values_to =</span> <span class="st">"Emissions"</span>)</span>
<span id="cb38-830"><a href="#cb38-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-831"><a href="#cb38-831" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjusting graph to make sure bars are visible</span></span>
<span id="cb38-832"><a href="#cb38-832" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(greenest_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Agency, Emissions), <span class="at">y =</span> Emissions, <span class="at">fill =</span> Metric)) <span class="sc">+</span></span>
<span id="cb38-833"><a href="#cb38-833" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span>  <span class="co"># Increased bar width</span></span>
<span id="cb38-834"><a href="#cb38-834" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Size_Category), <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.7</span>), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span>  <span class="co"># Increased text size</span></span>
<span id="cb38-835"><a href="#cb38-835" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Greenest Transit Agency"</span>, <span class="at">y =</span> <span class="st">"Emissions (kg COâ‚‚)"</span>, <span class="at">fill =</span> <span class="st">"Metric"</span>) <span class="sc">+</span></span>
<span id="cb38-836"><a href="#cb38-836" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(greenest_data<span class="sc">$</span>Emissions) <span class="sc">+</span> <span class="fl">0.002</span>)) <span class="sc">+</span>  <span class="co"># Adjust y-axis to ensure bars are visible</span></span>
<span id="cb38-837"><a href="#cb38-837" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb38-838"><a href="#cb38-838" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb38-839"><a href="#cb38-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-840"><a href="#cb38-840" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-841"><a href="#cb38-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-842"><a href="#cb38-842" aria-hidden="true" tabindex="-1"></a>Talk about making a clean getaway! The MTA Bus Company and its smaller counterparts are taking the "green" route. We're not just talking about eco-friendly buses, but real reductions in emissions. A round of applause for the greenest of them all!</span>
<span id="cb38-843"><a href="#cb38-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-844"><a href="#cb38-844" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ğŸŒ± Most Emissions Avoided - The Green Warriors ğŸ’¨</span></span>
<span id="cb38-845"><a href="#cb38-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-848"><a href="#cb38-848" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-849"><a href="#cb38-849" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the emissions data</span></span>
<span id="cb38-850"><a href="#cb38-850" aria-hidden="true" tabindex="-1"></a>emissions_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb38-851"><a href="#cb38-851" aria-hidden="true" tabindex="-1"></a>  <span class="at">Agency =</span> <span class="fu">c</span>(<span class="st">"MTA New York City Transit"</span>, <span class="st">"Metro-North Commuter Railroad Company"</span>, <span class="st">"Hampton Jitney, Inc."</span>),</span>
<span id="cb38-852"><a href="#cb38-852" aria-hidden="true" tabindex="-1"></a>  <span class="at">Emissions_Avoided =</span> <span class="fu">c</span>(<span class="dv">3441010874</span>, <span class="dv">413801729</span>, <span class="dv">13333018</span>)</span>
<span id="cb38-853"><a href="#cb38-853" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-854"><a href="#cb38-854" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot</span></span>
<span id="cb38-855"><a href="#cb38-855" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(emissions_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Agency, Emissions_Avoided), <span class="at">y =</span> Emissions_Avoided, <span class="at">fill =</span> Agency)) <span class="sc">+</span></span>
<span id="cb38-856"><a href="#cb38-856" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb38-857"><a href="#cb38-857" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb38-858"><a href="#cb38-858" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Most Emissions Avoided"</span>, <span class="at">y =</span> <span class="st">"COâ‚‚ Avoided (kg)"</span>, <span class="at">x =</span> <span class="st">"Agency"</span>) <span class="sc">+</span></span>
<span id="cb38-859"><a href="#cb38-859" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb38-860"><a href="#cb38-860" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span>  <span class="co"># Apply logarithmic scale to the y-axis</span></span>
<span id="cb38-861"><a href="#cb38-861" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">comma</span>(Emissions_Avoided)), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">2</span>)  <span class="co"># Adjust text positioning and size</span></span>
<span id="cb38-862"><a href="#cb38-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-863"><a href="#cb38-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-864"><a href="#cb38-864" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-865"><a href="#cb38-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-866"><a href="#cb38-866" aria-hidden="true" tabindex="-1"></a>These agencies are saving the planet one ride at a time! Hudson Transit Lines and its pals are on a mission to leave the world with fewer emissions. They're all about that "low-carbon footprint" lifestyle!</span>
<span id="cb38-867"><a href="#cb38-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-868"><a href="#cb38-868" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ğŸš€ Most Improved Green Agency - Turning Green Around! ğŸŒ¿</span></span>
<span id="cb38-869"><a href="#cb38-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-872"><a href="#cb38-872" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-873"><a href="#cb38-873" aria-hidden="true" tabindex="-1"></a><span class="do">## Most Improved Green Agency (Dumbbell Chart)</span></span>
<span id="cb38-874"><a href="#cb38-874" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggalt)</span>
<span id="cb38-875"><a href="#cb38-875" aria-hidden="true" tabindex="-1"></a>improved_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb38-876"><a href="#cb38-876" aria-hidden="true" tabindex="-1"></a>  <span class="at">Agency =</span> <span class="fu">c</span>(<span class="st">"MTA Bus Company"</span>, <span class="st">"Champaign-Urbana Mass Transit"</span>, <span class="st">"City of Decatur Transit"</span>),</span>
<span id="cb38-877"><a href="#cb38-877" aria-hidden="true" tabindex="-1"></a>  <span class="at">Before =</span> <span class="fu">c</span>(<span class="fl">0.1260740</span>,<span class="fl">0.2200267</span>, <span class="fl">0.3648839</span>),</span>
<span id="cb38-878"><a href="#cb38-878" aria-hidden="true" tabindex="-1"></a>  <span class="at">After =</span> <span class="fu">c</span>(<span class="fl">0.0002060647</span>,<span class="fl">0.0001889437</span>, <span class="fl">0.0015635784</span>)</span>
<span id="cb38-879"><a href="#cb38-879" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-880"><a href="#cb38-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-881"><a href="#cb38-881" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(improved_data, <span class="fu">aes</span>(<span class="at">y =</span> Agency, <span class="at">x =</span> Before, <span class="at">xend =</span> After)) <span class="sc">+</span></span>
<span id="cb38-882"><a href="#cb38-882" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dumbbell</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">dot_guide =</span> <span class="cn">TRUE</span>, <span class="at">dot_guide_size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb38-883"><a href="#cb38-883" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Most Improved Green Agency"</span>, <span class="at">x =</span> <span class="st">"Emissions per Mile (kg COâ‚‚)"</span>, <span class="at">y =</span> <span class="st">"Agency"</span>) <span class="sc">+</span></span>
<span id="cb38-884"><a href="#cb38-884" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb38-885"><a href="#cb38-885" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-886"><a href="#cb38-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-887"><a href="#cb38-887" aria-hidden="true" tabindex="-1"></a>These agencies took the emissions "downshift" seriously! The MTA Bus Company may have started off with high emissions, but itâ€™s now a model of green efficiency. Talk about a green makeover!</span>
<span id="cb38-888"><a href="#cb38-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-889"><a href="#cb38-889" aria-hidden="true" tabindex="-1"></a><span class="fu">#### ğŸ›¢ï¸ Biggest Gas Guzzler - Oops, Itâ€™s Guzzling More than Gas! ğŸƒ</span></span>
<span id="cb38-890"><a href="#cb38-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-893"><a href="#cb38-893" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb38-894"><a href="#cb38-894" aria-hidden="true" tabindex="-1"></a>guzzler_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb38-895"><a href="#cb38-895" aria-hidden="true" tabindex="-1"></a>  <span class="at">Agency =</span> <span class="fu">c</span>(<span class="st">"Chicago Transit Authority"</span>, <span class="st">"WVU Personal Rapid Transit"</span>, <span class="st">"Pennsylvania DOT"</span>),</span>
<span id="cb38-896"><a href="#cb38-896" aria-hidden="true" tabindex="-1"></a>  <span class="at">Emissions =</span> <span class="fu">c</span>(<span class="fl">162.6084</span>, <span class="fl">645.1</span>, <span class="fl">273.9</span>)</span>
<span id="cb38-897"><a href="#cb38-897" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-898"><a href="#cb38-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-899"><a href="#cb38-899" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(guzzler_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Agency, <span class="sc">-</span>Emissions), <span class="at">y =</span> Emissions, <span class="at">fill =</span> Emissions)) <span class="sc">+</span></span>
<span id="cb38-900"><a href="#cb38-900" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb38-901"><a href="#cb38-901" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"yellow"</span>, <span class="at">high =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb38-902"><a href="#cb38-902" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Biggest Gas Guzzler"</span>, <span class="at">y =</span> <span class="st">"Emissions per Mile (kg COâ‚‚)"</span>, <span class="at">x =</span> <span class="st">"Agency"</span>) <span class="sc">+</span></span>
<span id="cb38-903"><a href="#cb38-903" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb38-904"><a href="#cb38-904" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-905"><a href="#cb38-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-906"><a href="#cb38-906" aria-hidden="true" tabindex="-1"></a>Some agencies need to take a carbon diet! Looks like WVU Personal Rapid Transit took the term "gas guzzler" to the extreme. Maybe they should swap out those heavy engines for some electric vibes.</span>
<span id="cb38-907"><a href="#cb38-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-908"><a href="#cb38-908" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb38-909"><a href="#cb38-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-910"><a href="#cb38-910" aria-hidden="true" tabindex="-1"></a><span class="fu">## ğŸ“¢ Conclusion</span></span>
<span id="cb38-911"><a href="#cb38-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-912"><a href="#cb38-912" aria-hidden="true" tabindex="-1"></a>ğŸš† Public transit plays a *huge* role in reducing emissions! Our analysis highlights the best (and worst) performers. Keep supporting clean transit choices! ğŸŒğŸ’š</span>
<span id="cb38-913"><a href="#cb38-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-914"><a href="#cb38-914" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb38-915"><a href="#cb38-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-916"><a href="#cb38-916" aria-hidden="true" tabindex="-1"></a><span class="fu">## ğŸ“š References</span></span>
<span id="cb38-917"><a href="#cb38-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-918"><a href="#cb38-918" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>National Transit Database (NTD)</span>
<span id="cb38-919"><a href="#cb38-919" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Energy Information Administration (EIA)</span>
<span id="cb38-920"><a href="#cb38-920" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Environmental Protection Agency (EPA)</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>